{% extends 'c-word.html' %}

{% block title %} file descriptor - computer | software | os | linux {% endblock title %}

{% block point1 %}
<article contenteditable="true">
  <p>Category: computer | software | os | linux | file descriptor</p>
  <h1 id="blogTitle0">file descriptor</h1><h2>概述</h2><h3>定义</h3><div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向<a target="_blank" href="https://baike.baidu.com/item/%E5%86%85%E6%A0%B8" style="color: rgb(19, 110, 194); text-decoration-line: none;">内核</a>为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于<a target="_blank" href="https://baike.baidu.com/item/UNIX" style="color: rgb(19, 110, 194); text-decoration-line: none;">UNIX</a>、<a target="_blank" href="https://baike.baidu.com/item/Linux" style="color: rgb(19, 110, 194); text-decoration-line: none;">Linux</a>这样的操作系统。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">习惯上，标准输入（standard input）的文件描述符是 0，标准输出（standard output）是 1，标准错误（standard error）是 2。尽管这种习惯并非&nbsp;<a target="_blank" href="https://baike.baidu.com/item/Unix" style="color: rgb(19, 110, 194); text-decoration-line: none;">Unix</a>&nbsp;内核的特性，但是因为一些 shell 和很多应用程序都使用这种习惯，因此，如果内核不遵循这种习惯的话，很多应用程序将不能使用。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">POSIX 定义了 STDIN_FILENO、STDOUT_FILENO 和 STDERR_FILENO 来代替 0、1、2。这三个<a target="_blank" href="https://baike.baidu.com/item/%E7%AC%A6%E5%8F%B7%E5%B8%B8%E9%87%8F" style="color: rgb(19, 110, 194); text-decoration-line: none;">符号常量</a>的定义位于头文件 unistd.h。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符的有效范围是 0 到 OPEN_MAX。一般来说，每个进程最多可以打开 64 个文件（0 — 63）。对于 FreeBSD 5.2.1、Mac OS X 10.3 和 Solaris 9 来说，每个进程最多可以打开文件的多少取决于<a target="_blank" href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AD%98" style="color: rgb(19, 110, 194); text-decoration-line: none;">系统内存</a>的大小，int 的大小，以及系统管理员设定的限制。Linux 2.4.22 强制规定最多不能超过 1,048,576 。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符是由<a target="_blank" href="https://baike.baidu.com/item/%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B4%E6%95%B0" style="color: rgb(19, 110, 194); text-decoration-line: none;">无符号整数</a>表示的句柄，进程使用它来标识打开的文件。文件描述符与包括相关信息（如文件的打开模式、文件的位置类型、文件的初始类型等）的文件对象相关联，这些信息被称作文件的上下文。</div></div><h3>用途</h3><div><div class="lemma-summary" label-module="lemmaSummary" style="clear: both; font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);"><div class="para" label-module="para" style="overflow-wrap: break-word; margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1;"><a target="_blank" href="https://baike.baidu.com/item/%E5%86%85%E6%A0%B8/108410" data-lemmaid="108410" style="color: rgb(19, 110, 194); text-decoration-line: none;">内核</a>（kernel）利用文件描述符（file descriptor）来访问文件。文件描述符是非负整数。打开现存文件或新建文件时，内核会返回一个文件描述符。读写文件也需要使用文件描述符来指定待读写的文件。</div></div></div><div><br></div><h3>特点<br></h3><h4>优点</h4><div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符的好处主要有两个：</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);"><ul><li>基于文件描述符的 I/O 操作兼容&nbsp;<a target="_blank" href="https://baike.baidu.com/item/POSIX" style="text-indent: 2em; color: rgb(19, 110, 194); text-decoration-line: none;">POSIX</a><span style="text-indent: 2em;">&nbsp;</span><span style="text-indent: 2em;">标准</span><br></li><ul><li>在&nbsp;<a target="_blank" href="https://baike.baidu.com/item/UNIX" style="text-indent: 2em; color: rgb(19, 110, 194); text-decoration-line: none;">UNIX</a><span style="text-indent: 2em;">、</span><a target="_blank" href="https://baike.baidu.com/item/Linux" style="text-indent: 2em; color: rgb(19, 110, 194); text-decoration-line: none;">Linux</a><span style="text-indent: 2em;">&nbsp;</span><span style="text-indent: 2em;">的</span><a target="_blank" href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8" style="text-indent: 2em; color: rgb(19, 110, 194); text-decoration-line: none;">系统调用</a><span style="text-indent: 2em;">中，大量的系统调用都是依赖于文件描述符。</span></li></ul><li>此外，在Linux系列的操作系统上，由于Linux的设计思想便是把一切设备都视作文件。因此，文件描述符为在该系列平台上进行设备相关的编程实际上提供了一个统一的方法。<br></li></ul></div></div><h4>缺点<br></h4><div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符的概念存在两大缺点:</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);"><ul><li>在非 UNIX/<a target="_blank" href="https://baike.baidu.com/item/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" style="text-indent: 2em; color: rgb(19, 110, 194); text-decoration-line: none;">Linux 操作系统</a><span style="text-indent: 2em;">上(如Windows NT)，无法基于这一概念进行编程。</span><br></li><li>由于文件描述符在形式上不过是个整数，当代码量增大时，会使编程者难以分清哪些整数意味着数据，哪些意味着文件描述符。因此，完成的代码可读性也就会变得很差。<br></li></ul></div></div><h3>如何创建文件描述符<br></h3><div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">进程获取文件描述符最常见的方法是通过本机<a target="_blank" href="https://baike.baidu.com/item/%E5%AD%90%E4%BE%8B%E7%A8%8B" style="color: rgb(19, 110, 194); text-decoration-line: none;">子例程</a>&nbsp;open 或 create 获取或者通过从<a target="_blank" href="https://baike.baidu.com/item/%E7%88%B6%E8%BF%9B%E7%A8%8B" style="color: rgb(19, 110, 194); text-decoration-line: none;">父进程</a>继承。后一种方法允许子进程同样能够访问由父进程使用的文件。文件描述符对于每个进程一般是唯一的。当用 fork 子例程创建某个子进程时，该子进程会获得其父进程所有文件描述符的副本，这些文件描述符在执行 fork 时打开。在由fcntl、dup和<a target="_blank" href="https://baike.baidu.com/item/dup2" style="color: rgb(19, 110, 194); text-decoration-line: none;">dup2</a>子例程复制或拷贝某个进程时，会发生同样的复制过程。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">对于每个进程，操作系统<a target="_blank" href="https://baike.baidu.com/item/%E5%86%85%E6%A0%B8" style="color: rgb(19, 110, 194); text-decoration-line: none;">内核</a>在 u_block 结构中维护文件描述符表，所有的文件描述符都在该表中建立索引。</div></div><div><br></div><div><br></div><h3>文件描述符与文件指针的区别</h3><div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件描述符：在 linux 系统中打开文件就会获得文件描述符，它是个很小的非负整数。每个进程在 PCB（Process Control Block）中保存着一份文件描述符表，文件描述符就是这个表的索引，每个表项都有一个指向已打开文件的指针。</div><div class="para" label-module="para" style="font-size: 14px; overflow-wrap: break-word; color: rgb(51, 51, 51); margin-bottom: 15px; text-indent: 2em; line-height: 24px; zoom: 1; font-family: arial, 宋体, sans-serif; background-color: rgb(255, 255, 255);">文件指针：C 语言中使用文件指针做为 I/O 的句柄。文件指针指向进程用户区中的一个被称为 FILE 结构的数据结构。FILE 结构包括一个缓冲区和一个文件描述符。而文件描述符是文件描述符表的一个索引，因此从某种意义上说文件指针就是句柄的句柄（在Windows系统上，文件描述符被称作文件句柄）。</div></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div>
</article>
{% endblock point1 %}
