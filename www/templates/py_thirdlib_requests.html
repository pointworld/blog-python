{% extends 'c-word.html' %}

{% block title %} requests - computer | software | language | python | Internet Protocols and Support | third lib {% endblock title %}

{% block point1 %}
<article contenteditable="true">
  <p>Category: computer | software | language | python | Internet Protocols and Support | third lib | requests</p>
  <h1 id="blogTitle0">requests</h1><h2 id="blogTitle1">概述</h2><h3 id="blogTitle2">定义</h3><div>一个 Python HTTP 库</div><div><br></div><h3 id="blogTitle3">组成</h3><div><br></div><h3 id="blogTitle4">开发哲学</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 是以&nbsp;<span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0020" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><strong>PEP 20</strong></a>&nbsp;的箴言为中心开发的</p><ol class="arabic simple" style="margin: 10px 0px 10px 30px; padding: 0px; list-style-position: initial; list-style-image: initial; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; line-height: 1.4em;">Beautiful is better than ugly.(美丽优于丑陋)</li><li style="hyphens: auto; line-height: 1.4em;">Explicit is better than implicit.(直白优于含蓄)</li><li style="hyphens: auto; line-height: 1.4em;">Simple is better than complex.(简单优于复杂)</li><li style="hyphens: auto; line-height: 1.4em;">Complex is better than complicated.(复杂优于繁琐)</li><li style="hyphens: auto; line-height: 1.4em;">Readability counts.(可读性很重要)</li></ol><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">对于 Requests 所有的贡献都应牢记这些重要的准则。</p></div><div><br></div><div><br></div><h3 id="blogTitle5">功能</h3><div><h4 id="blogTitle6">Keep-Alive &amp; 连接池</h4><h4 id="blogTitle7">国际化域名和 URL</h4><h4 id="blogTitle8">带持久 Cookie 的会话</h4><h4 id="blogTitle9">浏览器式的 SSL 认证</h4><h4 id="blogTitle10">自动内容解码</h4><h4 id="blogTitle11">基本/摘要式的身份认证</h4><h4 id="blogTitle12">优雅的 key/value Cookie</h4><h4 id="blogTitle13">自动解压</h4><h4 id="blogTitle14">Unicode 响应体</h4><h4 id="blogTitle15">HTTP(S) 代理支持</h4><h4 id="blogTitle16">文件分块上传</h4><h4 id="blogTitle17">流下载</h4><h4 id="blogTitle18">连接超时</h4><h4 id="blogTitle19">分块请求</h4><h4 id="blogTitle20">支持 .netrc&nbsp;</h4></div><h3 id="blogTitle21">用途</h3><pre><h2 id="blogTitle22">Help on package requests:</h2>
<h3 id="blogTitle23">NAME</h3>    requests

<h3 id="blogTitle24">DESCRIPTION</h3>    Requests HTTP Library
    ~~~~~~~~~~~~~~~~~~~~~

    Requests is an HTTP library, written in Python, for human beings. Basic GET
    usage:

       &gt;&gt;&gt; import requests
       &gt;&gt;&gt; r = requests.get('https://www.python.org')
       &gt;&gt;&gt; r.status_code
       200
       &gt;&gt;&gt; 'Python is a programming language' in r.content
       True

    ... or POST:

       &gt;&gt;&gt; payload = dict(key1='value1', key2='value2')
       &gt;&gt;&gt; r = requests.post('https://httpbin.org/post', data=payload)
       &gt;&gt;&gt; print(r.text)
       {
         ...
         "form": {
           "key2": "value2",
           "key1": "value1"
         },
         ...
       }

    The other HTTP methods are supported - see `requests.api`. Full documentation
    is at &lt;http://python-requests.org&gt;.

    :copyright: (c) 2017 by Kenneth Reitz.
    :license: Apache 2.0, see LICENSE for more details.

<h3 id="blogTitle25">PACKAGE CONTENTS</h3>    __version__
    _internal_utils
    adapters
    api
    auth
    certs
    compat
    cookies
    exceptions
    help
    hooks
    models
    packages
    sessions
    status_codes
    structures
    utils

<h3 id="blogTitle26">FUNCTIONS</h3>    check_compatibility(urllib3_version, chardet_version)

<h3 id="blogTitle27">DATA</h3>    __author_email__ = 'me@kennethreitz.org'
    __build__ = 139520
    __cake__ = '&lt;E2&gt;&lt;9C&gt;&lt;A8&gt; &lt;F0&gt;&lt;9F&gt;&lt;8D&gt;&lt;B0&gt; &lt;E2&gt;&lt;9C&gt;&lt;A8&gt;'
    __copyright__ = 'Copyright 2018 Kenneth Reitz'
    __description__ = 'Python HTTP for Humans.'
    __license__ = 'Apache 2.0'
    __title__ = 'requests'
    __url__ = 'http://python-requests.org'
    codes = &lt;lookup 'status_codes'&gt;

<h3 id="blogTitle28">VERSION</h3>    2.21.0

<h3 id="blogTitle29">AUTHOR</h3>    Kenneth Reitz

<h3 id="blogTitle30">FILE</h3>    /usr/local/python3/lib/python3.7/site-packages/requests/__init__.py<br></pre><div><br></div><div><h2 id="blogTitle31">快速上手</h2><h3 id="blogTitle32">发送请求使用 Requests 发送网络请求非常简单。</h3><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">一开始要导入 Requests 模块：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">然后，尝试获取某个网页。本例子中，我们来获取 Github 的公共时间线：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/events'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">现在，我们有一个名为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r</span></code>&nbsp;的&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response" title="requests.Response" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response</span></code></a>&nbsp;对象。我们可以从这个对象中获取所有我们想要的信息。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 简便的 API 意味着所有 HTTP 请求类型都是显而易见的。例如，你可以这样发送一个 HTTP POST 请求：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'key'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span><span class="s1" style="color: rgb(78, 154, 6);">'value'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">漂亮，对吧？那么其他 HTTP 请求类型：PUT，DELETE，HEAD 以及 OPTIONS 又是如何的呢？都是一样的简单：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">put</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/put'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'key'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span><span class="s1" style="color: rgb(78, 154, 6);">'value'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">delete</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/delete'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">head</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">options</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">都很不错吧，但这也仅是 Requests 的冰山一角呢。</p><h3 id="blogTitle33">传递 URL 参数</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你也许经常想为 URL 的查询字符串(query string)传递某种数据。如果你是手工构建 URL，那么数据会以键/值对的形式置于 URL 中，跟在一个问号的后面。例如，&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">httpbin.org/get?key=val</span></code>。 Requests 允许你使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">params</span></code>&nbsp;关键字参数，以一个字符串字典来提供这些参数。举例来说，如果你想传递<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">key1=value1</span></code>&nbsp;和&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">key2=value2</span></code>&nbsp;到&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">httpbin.org/get</span></code>&nbsp;，那么你可以使用如下代码：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'key1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'value1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'key2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'value2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s2" style="color: rgb(78, 154, 6);">"http://httpbin.org/get"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">params</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">通过打印输出该 URL，你能看到 URL 已被正确编码：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">http://httpbin.org/get?key2=value2&amp;key1=value1</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">注意字典里值为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;的键都不会被添加到 URL 的查询字符串里。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你还可以将一个列表作为值传入：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'key1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'value1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'key2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'value2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'value3'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">params</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">http://httpbin.org/get?key1=value1&amp;key2=value2&amp;key2=value3</span></pre></div></div></div><h3 id="blogTitle34">响应内容</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们能读取服务器响应的内容。再次以 GitHub 时间线为例：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/events'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">u'[{"repository":{"open_issues":0,"url":"https://github.com/...</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">请求发出后，Requests 会基于 HTTP 头部对响应的编码作出有根据的推测。当你访问&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.text</span></code>&nbsp;之时，Requests 会使用其推测的文本编码。你可以找出 Requests 使用了什么编码，并且能够使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.encoding</span></code>属性来改变它：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">encoding</span>
<span class="go" style="color: rgb(136, 136, 136);">'utf-8'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">encoding</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'ISO-8859-1'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你改变了编码，每当你访问&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.text</span></code>&nbsp;，Request 都将会使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.encoding</span></code>&nbsp;的新值。你可能希望在使用特殊逻辑计算出文本的编码的情况下来修改编码。比如 HTTP 和 XML 自身可以指定编码。这样的话，你应该使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.content</span></code>&nbsp;来找到编码，然后设置&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.encoding</span></code>&nbsp;为相应的编码。这样就能使用正确的编码解析&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.text</span></code>&nbsp;了。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">在你需要的情况下，Requests 也可以使用定制的编码。如果你创建了自己的编码，并使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">codecs</span></code>&nbsp;模块进行注册，你就可以轻松地使用这个解码器名称作为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.encoding</span></code>&nbsp;的值， 然后由 Requests 来为你处理编码。</p></div><div><br></div><h3 id="blogTitle35">二进制响应内容</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你也能以字节的方式访问请求响应体，对于非文本请求：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">content</span>
<span class="go" style="color: rgb(136, 136, 136);">b'[{"repository":{"open_issues":0,"url":"https://github.com/...</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 会自动为你解码&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">gzip</span></code>&nbsp;和&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">deflate</span></code>&nbsp;传输编码的响应数据。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">例如，以请求返回的二进制数据创建一张图片，你可以使用如下代码：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">PIL</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">Image</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">io</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">BytesIO</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">i</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">Image</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">open</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">BytesIO</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">content</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span></pre></div></div></div><div><br></div><h3 id="blogTitle36">JSON 响应内容</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 中也有一个内置的 JSON 解码器，助你处理 JSON 数据：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/events'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="go" style="color: rgb(136, 136, 136);">[{u'repository': {u'open_issues': 0, u'url': 'https://github.com/...</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果 JSON 解码失败，&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.json()</span></code>&nbsp;就会抛出一个异常。例如，响应内容是 401 (Unauthorized)，尝试访问&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.json()</span></code>&nbsp;将会抛出&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">ValueError:</span>&nbsp;<span class="pre" style="hyphens: none;">No</span>&nbsp;<span class="pre" style="hyphens: none;">JSON</span>&nbsp;<span class="pre" style="hyphens: none;">object</span>&nbsp;<span class="pre" style="hyphens: none;">could</span>&nbsp;<span class="pre" style="hyphens: none;">be</span>&nbsp;<span class="pre" style="hyphens: none;">decoded</span></code>&nbsp;异常。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">需要注意的是，成功调用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.json()</span></code>&nbsp;并**不**意味着响应的成功。有的服务器会在失败的响应中包含一个 JSON 对象（比如 HTTP 500 的错误细节）。这种 JSON 会被解码返回。要检查请求是否成功，请使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.raise_for_status()</span></code>&nbsp;或者检查&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.status_code</span></code>&nbsp;是否和你的期望相同。</p></div><div><br></div><h3 id="blogTitle37">原始响应内容</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">在罕见的情况下，你可能想获取来自服务器的原始套接字响应，那么你可以访问&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.raw</span></code>。 如果你确实想这么干，那请你确保在初始请求中设置了&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream=True</span></code>。具体你可以这么做：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/events'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">raw</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;requests.packages.urllib3.response.HTTPResponse object at 0x101194810&gt;</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">raw</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">read</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="mi" style="color: rgb(153, 0, 0);">10</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">'\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">但一般情况下，你应该以下面的模式将文本流保存到文件：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">with</span> <span class="nb" style="color: rgb(0, 68, 97);">open</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">filename</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'wb'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">as</span> <span class="n" style="color: rgb(0, 0, 0);">fd</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">for</span> <span class="n" style="color: rgb(0, 0, 0);">chunk</span> <span class="ow" style="color: rgb(0, 68, 97); font-weight: bold;">in</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">iter_content</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">chunk_size</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
        <span class="n" style="color: rgb(0, 0, 0);">fd</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">write</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">chunk</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Response.iter_content</span></code>&nbsp;将会处理大量你直接使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Response.raw</span></code>&nbsp;不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 Note that&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">chunk_size</span></code>&nbsp;can be freely adjusted to a number that may better fit your use cases.</p></div><div><br></div><h3 id="blogTitle38">定制请求头</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你想为请求添加 HTTP 头部，只要简单地传递一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">dict</span></code>&nbsp;给&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">headers</span></code>&nbsp;参数就可以了。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">例如，在前一个示例中我们没有指定 content-type:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/some/endpoint'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">headers</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'user-agent'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'my-app/0.0.1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">注意: 定制 header 的优先级低于某些特定的信息源，例如：</p><ul class="simple" style="margin: 10px 0px; padding: 0px; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; line-height: 1.4em;">如果在&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">.netrc</span></code>&nbsp;中设置了用户认证信息，使用&nbsp;<cite>headers=</cite>&nbsp;设置的授权就不会生效。而如果设置了&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">auth=</span></code>参数，``.netrc`` 的设置就无效了。</li><li style="hyphens: auto; line-height: 1.4em;">如果被重定向到别的主机，授权 header 就会被删除。</li><li style="hyphens: auto; line-height: 1.4em;">代理授权 header 会被 URL 中提供的代理身份覆盖掉。</li><li style="hyphens: auto; line-height: 1.4em;">在我们能判断内容长度的情况下，header 的 Content-Length 会被改写。</li></ul><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">更进一步讲，Requests 不会基于定制 header 的具体情况改变自己的行为。只不过在最后的请求中，所有的 header 信息都会被传递进去。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">注意: 所有的 header 值必须是&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">string</span></code>、bytestring 或者 unicode。尽管传递 unicode header 也是允许的，但不建议这样做。</p></div><div><br></div><div><br></div><h3 id="blogTitle39">更加复杂的 POST 请求</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">通常，你想要发送一些编码为表单形式的数据——非常像一个 HTML 表单。要实现这个，只需简单地传递一个字典给&nbsp;<cite>data</cite>&nbsp;参数。你的数据字典在发出请求时会自动编码为表单形式：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'key1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'value1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'key2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'value2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s2" style="color: rgb(78, 154, 6);">"http://httpbin.org/post"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  "form": {</span>
<span class="go" style="color: rgb(136, 136, 136);">    "key2": "value2",</span>
<span class="go" style="color: rgb(136, 136, 136);">    "key1": "value1"</span>
<span class="go" style="color: rgb(136, 136, 136);">  },</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你还可以为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">data</span></code>&nbsp;参数传入一个元组列表。在表单中多个元素使用同一 key 的时候，这种方式尤其有效：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">((</span><span class="s1" style="color: rgb(78, 154, 6);">'key1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'value1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">),</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'key1'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'value2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  "form": {</span>
<span class="go" style="color: rgb(136, 136, 136);">    "key1": [</span>
<span class="go" style="color: rgb(136, 136, 136);">      "value1",</span>
<span class="go" style="color: rgb(136, 136, 136);">      "value2"</span>
<span class="go" style="color: rgb(136, 136, 136);">    ]</span>
<span class="go" style="color: rgb(136, 136, 136);">  },</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">string</span></code>&nbsp;而不是一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">dict</span></code>，那么数据会被直接发布出去。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">例如，Github API v3 接受编码为 JSON 的 POST/PATCH 数据：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">json</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/some/endpoint'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'some'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'data'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">dumps</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">此处除了可以自行对&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">dict</span></code>&nbsp;进行编码，你还可以使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">json</span></code>&nbsp;参数直接传递，然后它就会被自动编码。这是 2.4.2 版的新加功能：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/some/endpoint'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">payload</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'some'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'data'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">payload</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span></pre></div></div></div><div><br></div><div><br></div><h3 id="blogTitle40">POST 一个多部分编码(Multipart-Encoded)的文件</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 使得上传多部分编码文件变得很简单：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">files</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'file'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="nb" style="color: rgb(0, 68, 97);">open</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'report.xls'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'rb'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">files</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">files</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  "files": {</span>
<span class="go" style="color: rgb(136, 136, 136);">    "file": "&lt;censored...binary...data&gt;"</span>
<span class="go" style="color: rgb(136, 136, 136);">  },</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以显式地设置文件名，文件类型和请求头：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">files</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'file'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'report.xls'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="nb" style="color: rgb(0, 68, 97);">open</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'report.xls'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'rb'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">),</span> <span class="s1" style="color: rgb(78, 154, 6);">'application/vnd.ms-excel'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'Expires'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'0'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">files</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">files</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  "files": {</span>
<span class="go" style="color: rgb(136, 136, 136);">    "file": "&lt;censored...binary...data&gt;"</span>
<span class="go" style="color: rgb(136, 136, 136);">  },</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你想，你也可以发送作为文件来接收的字符串：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">files</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'file'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'report.csv'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'some,data,to,send</span><span class="se" style="color: rgb(78, 154, 6);">\n</span><span class="s1" style="color: rgb(78, 154, 6);">another,row,to,send</span><span class="se" style="color: rgb(78, 154, 6);">\n</span><span class="s1" style="color: rgb(78, 154, 6);">'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">files</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">files</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  "files": {</span>
<span class="go" style="color: rgb(136, 136, 136);">    "file": "some,data,to,send\\nanother,row,to,send\\n"</span>
<span class="go" style="color: rgb(136, 136, 136);">  },</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你发送一个非常大的文件作为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">multipart/form-data</span></code>&nbsp;请求，你可能希望将请求做成数据流。默认下&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests</span></code>&nbsp;不支持, 但有个第三方包&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests-toolbelt</span></code>&nbsp;是支持的。你可以阅读&nbsp;<a class="reference external" href="https://toolbelt.rtfd.org/" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">toolbelt 文档</a>&nbsp;来了解使用方法。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">在一个请求中发送多文件参考&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/user/advanced.html#advanced" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><span class="std std-ref">高级用法</span></a>&nbsp;一节。</p><div class="admonition- admonition" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">警告</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">我们强烈建议你用二进制模式(<a class="reference external" href="https://docs.python.org/2/tutorial/inputoutput.html#reading-and-writing-files" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">binary mode</a>)打开文件。这是因为 Requests 可能会试图为你提供&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Content-Length</span></code>&nbsp;header，在它这样做的时候，这个值会被设为文件的字节数（<em>bytes</em>）。如果用文本模式(text mode)打开文件，就可能会发生错误。</p></div></div><div><br></div><h3 id="blogTitle41">响应状态码</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们可以检测响应状态码：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">为方便引用，Requests还附带了一个内置的状态码查询对象：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span> <span class="o" style="color: rgb(88, 40, 0);">==</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">codes</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">ok</span>
<span class="go" style="color: rgb(136, 136, 136);">True</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果发送了一个错误请求(一个 4XX 客户端错误，或者 5XX 服务器错误响应)，我们可以通过<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.raise_for_status" title="requests.Response.raise_for_status" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.raise_for_status()</span></code></a>&nbsp;来抛出异常：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">bad_r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/status/404'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">bad_r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">404</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">bad_r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">raise_for_status</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="gt" style="color: rgb(164, 0, 0); font-weight: bold;">Traceback (most recent call last):</span>
  File <span class="nb" style="color: rgb(0, 68, 97);">"requests/models.py"</span>, line <span class="m" style="color: rgb(153, 0, 0);">832</span>, in <span class="n" style="color: rgb(0, 0, 0);">raise_for_status</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">raise</span> <span class="n" style="color: rgb(0, 0, 0);">http_error</span>
<span class="gr" style="color: rgb(239, 41, 41);">requests.exceptions.HTTPError</span>: <span class="n" style="color: rgb(0, 0, 0);">404 Client Error</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">但是，由于我们的例子中&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r</span></code>&nbsp;的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">status_code</span></code>&nbsp;是&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">200</span></code>&nbsp;，当我们调用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">raise_for_status()</span></code>&nbsp;时，得到的是：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">raise_for_status</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="go" style="color: rgb(136, 136, 136);">None</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">一切都挺和谐哈。</p></div><div><br></div><h3 id="blogTitle42">响应头</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们可以查看以一个 Python 字典形式展示的服务器响应头：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">    'content-encoding': 'gzip',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'transfer-encoding': 'chunked',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'connection': 'close',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'server': 'nginx/1.0.4',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'x-runtime': '148ms',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'etag': '"e1ca502697e5c9317743dc078f67693f"',</span>
<span class="go" style="color: rgb(136, 136, 136);">    'content-type': 'application/json'</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">但是这个字典比较特殊：它是仅为 HTTP 头部而生的。根据&nbsp;<a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">RFC 2616</a>， HTTP 头部是大小写不敏感的。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">因此，我们可以使用任意大写形式来访问这些响应头字段：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'Content-Type'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">'application/json'</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'content-type'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">'application/json'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">它还有一个特殊点，那就是服务器可以多次接受同一 header，每次都使用不同的值。但 Requests 会将它们合并，这样它们就可以用一个映射来表示出来，参见&nbsp;<a class="reference external" href="http://tools.ietf.org/html/rfc7230#section-3.2" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">RFC 7230</a>:</p><blockquote style="margin: 0px 0px 0px 30px; padding: 0px; hyphens: auto; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><p style="hyphens: auto; line-height: 1.4em;">A recipient MAY combine multiple header fields with the same field name into one "field-name: field-value" pair, without changing the semantics of the message, by appending each subsequent field value to the combined field value in order, separated by a comma.</p><p style="hyphens: auto; line-height: 1.4em;">接收者可以合并多个相同名称的 header 栏位，把它们合为一个 "field-name: field-value" 配对，将每个后续的栏位值依次追加到合并的栏位值中，用逗号隔开即可，这样做不会改变信息的语义。</p></blockquote></div><div><br></div><h3 id="blogTitle43">Cookie</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果某个响应中包含一些 cookie，你可以快速访问它们：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://example.com/some/cookie/setting/url'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'example_cookie_name'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">'example_cookie_value'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">要想发送你的cookies到服务器，可以使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">cookies</span></code>&nbsp;参数：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">cookies</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="nb" style="color: rgb(0, 68, 97);">dict</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">cookies_are</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'working'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">'{"cookies": {"cookies_are": "working"}}'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Cookie 的返回对象为&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.cookies.RequestsCookieJar" title="requests.cookies.RequestsCookieJar" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">RequestsCookieJar</span></code></a>，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。你还可以把 Cookie Jar 传到 Requests 中：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">jar</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">RequestsCookieJar</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">jar</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">set</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'tasty_cookie'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'yum'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">domain</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'httpbin.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">path</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'/cookies'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">jar</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">set</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'gross_cookie'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'blech'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">domain</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'httpbin.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">path</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'/elsewhere'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">jar</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">'{"cookies": {"tasty_cookie": "yum"}}'</span></pre></div></div></div><div><br></div><h3 id="blogTitle44">重定向与请求历史</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">默认情况下，除了 HEAD, Requests 会自动处理所有重定向。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">可以使用响应对象的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">history</span></code>&nbsp;方法来追踪重定向。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.history" title="requests.Response.history" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.history</span></code></a>&nbsp;是一个&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response" title="requests.Response" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response</span></code></a>&nbsp;对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">例如，Github 将所有的 HTTP 请求重定向到 HTTPS：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span>
<span class="go" style="color: rgb(136, 136, 136);">'https://github.com/'</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">history</span>
<span class="go" style="color: rgb(136, 136, 136);">[&lt;Response [301]&gt;]</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你使用的是GET、OPTIONS、POST、PUT、PATCH 或者 DELETE，那么你可以通过&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">allow_redirects</span></code>&nbsp;参数禁用重定向处理：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">allow_redirects</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">False</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">301</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">history</span>
<span class="go" style="color: rgb(136, 136, 136);">[]</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你使用了 HEAD，你也可以启用重定向：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">head</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">allow_redirects</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span>
<span class="go" style="color: rgb(136, 136, 136);">'https://github.com/'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">history</span>
<span class="go" style="color: rgb(136, 136, 136);">[&lt;Response [301]&gt;]</span></pre></div></div></div><div><br></div><h3 id="blogTitle45">超时</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以告诉 requests 在经过以&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">timeout</span></code>&nbsp;参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="mf" style="color: rgb(153, 0, 0);">0.001</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gt" style="color: rgb(164, 0, 0); font-weight: bold;">Traceback (most recent call last):</span>
  File <span class="nb" style="color: rgb(0, 68, 97);">"&lt;stdin&gt;"</span>, line <span class="m" style="color: rgb(153, 0, 0);">1</span>, in <span class="n" style="color: rgb(0, 0, 0);">&lt;module&gt;</span>
<span class="gr" style="color: rgb(239, 41, 41);">requests.exceptions.Timeout</span>: <span class="n" style="color: rgb(0, 0, 0);">HTTPConnectionPool(host='github.com', port=80): Request timed out. (timeout=0.001)</span>
</pre></div></div><div class="admonition- admonition" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">注意</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;"><code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">timeout</span></code>&nbsp;仅对连接过程有效，与响应体的下载无关。&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">timeout</span></code>&nbsp;并不是整个下载响应的时间限制，而是如果服务器在&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">timeout</span></code>&nbsp;秒内没有应答，将会引发一个异常（更精确地说，是在<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">timeout</span></code>&nbsp;秒内没有从基础套接字上接收到任何字节的数据时）If no timeout is specified explicitly, requests do not time out.</p></div></div><div><br></div><h3 id="blogTitle46">错误与异常&nbsp;</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">遇到网络问题（如：DNS 查询失败、拒绝连接等）时，Requests 会抛出一个&nbsp;<code class="xref py py-exc docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">ConnectionError</span></code>&nbsp;异常。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果 HTTP 请求返回了不成功的状态码，&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.raise_for_status" title="requests.Response.raise_for_status" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.raise_for_status()</span></code></a>&nbsp;会抛出一个&nbsp;<code class="xref py py-exc docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">HTTPError</span></code>&nbsp;异常。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">若请求超时，则抛出一个&nbsp;<code class="xref py py-exc docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Timeout</span></code>&nbsp;异常。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">若请求超过了设定的最大重定向次数，则会抛出一个&nbsp;<code class="xref py py-exc docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">TooManyRedirects</span></code>&nbsp;异常。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">所有Requests显式抛出的异常都继承自&nbsp;<code class="xref py py-exc docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">requests.exceptions.RequestException</span></code>&nbsp;。</p></div><h2 id="blogTitle47">高级用法</h2><h3 id="blogTitle48">会话对象</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">会话对象让你能够跨请求保持某些参数。它也会在同一个 Session 实例发出的所有请求之间保持 cookie， 期间使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">urllib3</span></code>&nbsp;的&nbsp;<a class="reference external" href="http://urllib3.readthedocs.io/en/latest/reference/index.html#module-urllib3.connectionpool" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">connection pooling</a>&nbsp;功能。所以如果你向同一主机发送多个请求，底层的 TCP 连接将会被重用，从而带来显著的性能提升。 (参见&nbsp;<a class="reference external" href="https://en.wikipedia.org/wiki/HTTP_persistent_connection" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">HTTP persistent connection</a>).</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">会话对象具有主要的 Requests API 的所有方法。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们来跨请求保持一些 cookie:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>

<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s2" style="color: rgb(78, 154, 6);">"http://httpbin.org/cookies"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># '{"cookies": {"sessioncookie": "123456789"}}'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">auth</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'pass'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">update</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">({</span><span class="s1" style="color: rgb(78, 154, 6);">'x-test'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'true'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>

<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># both 'x-test' and 'x-test2' are sent</span>
<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/headers'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'x-test2'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'true'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">不过需要注意，就算使用了会话，方法级别的参数也不会被跨请求保持。下面的例子只会和第一个请求发送 cookie ，而非第二个：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>

<span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">cookies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'from-my'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'browser'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
<span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># '{"cookies": {"from-my": "browser"}}'</span>

<span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># '{"cookies": {}}'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你要手动为会话添加 cookie，就使用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#api-cookies" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><span class="std std-ref">Cookie utility 函数</span></a>&nbsp;来操纵&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session.cookies" title="requests.Session.cookies" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session.cookies</span></code></a>。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">会话还可以用作前后文管理器：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">with</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">as</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">这样就能确保&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">with</span></code>&nbsp;区块退出后会话能被关闭，即使发生了异常也一样。</p><div class="admonition- admonition" style="margin: 20px 0px; padding: 10px 30px; border: 1px solid rgb(204, 204, 204); background-color: rgb(238, 238, 238); font-size: 17px; font-family: Georgia, serif; color: rgb(62, 67, 73);"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">从字典参数中移除一个值</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;，那个键就会被自动省略掉。</p></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">包含在一个会话中的所有数据你都可以直接使用。学习更多细节请阅读&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#sessionapi" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><span class="std std-ref">会话 API 文档</span></a>。</p></div><div><br></div><h3 id="blogTitle49">请求与响应对象</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">任何时候进行了类似 requests.get() 的调用，你都在做两件主要的事情。其一，你在构建一个&nbsp;<cite>Request</cite>对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests</span></code>&nbsp;得到一个从服务器返回的响应就会产生一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Response</span></code>&nbsp;对象。该响应对象包含服务器返回的所有信息，也包含你原来创建的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Request</span></code>&nbsp;对象。如下是一个简单的请求，从 Wikipedia 的服务器得到一些非常重要的信息：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://en.wikipedia.org/wiki/Monty_Python'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果想访问服务器返回给我们的响应头部信息，可以这样做：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span>
<span class="go" style="color: rgb(136, 136, 136);">{'content-length': '56170', 'x-content-type-options': 'nosniff', 'x-cache':</span>
<span class="go" style="color: rgb(136, 136, 136);">'HIT from cp1006.eqiad.wmnet, MISS from cp1010.eqiad.wmnet', 'content-encoding':</span>
<span class="go" style="color: rgb(136, 136, 136);">'gzip', 'age': '3080', 'content-language': 'en', 'vary': 'Accept-Encoding,Cookie',</span>
<span class="go" style="color: rgb(136, 136, 136);">'server': 'Apache', 'last-modified': 'Wed, 13 Jun 2012 01:33:50 GMT',</span>
<span class="go" style="color: rgb(136, 136, 136);">'connection': 'close', 'cache-control': 'private, s-maxage=0, max-age=0,</span>
<span class="go" style="color: rgb(136, 136, 136);">must-revalidate', 'date': 'Thu, 14 Jun 2012 12:59:39 GMT', 'content-type':</span>
<span class="go" style="color: rgb(136, 136, 136);">'text/html; charset=UTF-8', 'x-cache-lookup': 'HIT from cp1006.eqiad.wmnet:3128,</span>
<span class="go" style="color: rgb(136, 136, 136);">MISS from cp1010.eqiad.wmnet:80'}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">request</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span>
<span class="go" style="color: rgb(136, 136, 136);">{'Accept-Encoding': 'identity, deflate, compress, gzip',</span>
<span class="go" style="color: rgb(136, 136, 136);">'Accept': '*/*', 'User-Agent': 'python-requests/0.13.1'}</span></pre></div></div></div><div><br></div><h3 id="blogTitle50">准备的请求 （Prepared Request）</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">当你从 API 或者会话调用中收到一个&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response" title="requests.Response" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response</span></code></a>&nbsp;对象时，<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">request</span></code>&nbsp;属性其实是使用了&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">PreparedRequest</span></code>。有时在发送请求之前，你需要对 body 或者 header （或者别的什么东西）做一些额外处理，下面演示了一个简单的做法：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">Request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">Session</span>

<span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="n" style="color: rgb(0, 0, 0);">req</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">Request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'GET'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">data</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">header</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="n" style="color: rgb(0, 0, 0);">prepped</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">req</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">prepare</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>

<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># do something with prepped.body</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># do something with prepped.headers</span>

<span class="n" style="color: rgb(0, 0, 0);">resp</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">send</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">prepped</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">timeout</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">resp</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">由于你没有对&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Request</span></code>&nbsp;对象做什么特殊事情，你立即准备和修改了&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">PreparedRequest</span></code>&nbsp;对象，然后把它和别的参数一起发送到&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests.*</span></code>&nbsp;或者&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Session.*</span></code>。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">然而，上述代码会失去 Requests&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session" title="requests.Session" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>&nbsp;对象的一些优势， 尤其&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session" title="requests.Session" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>&nbsp;级别的状态，例如 cookie 就不会被应用到你的请求上去。要获取一个带有状态的&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.PreparedRequest" title="requests.PreparedRequest" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">PreparedRequest</span></code></a>， 请用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session.prepare_request" title="requests.Session.prepare_request" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session.prepare_request()</span></code></a>&nbsp;取代&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Request.prepare" title="requests.Request.prepare" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Request.prepare()</span></code></a>&nbsp;的调用，如下所示：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">Request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">Session</span>

<span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="n" style="color: rgb(0, 0, 0);">req</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">Request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'GET'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>  <span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">data</span>
    <span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">headers</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="n" style="color: rgb(0, 0, 0);">prepped</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">prepare_request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">req</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># do something with prepped.body</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># do something with prepped.headers</span>

<span class="n" style="color: rgb(0, 0, 0);">resp</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">send</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">prepped</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">timeout</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">resp</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span></pre></div></div></div><div><br></div><h3 id="blogTitle51">SSL 证书验证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 可以为 HTTPS 请求验证 SSL 证书，就像 web 浏览器一样。SSL 验证默认是开启的，如果证书验证失败，Requests 会抛出 SSLError:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://requestb.in'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">requests.exceptions.SSLError: hostname 'requestb.in' doesn't match either of '*.herokuapp.com', 'herokuapp.com'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">在该域名上我没有设置 SSL，所以失败了。但 Github 设置了 SSL:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>&nbsp;传入 CA_BUNDLE 文件的路径，或者包含可信任 CA 证书文件的文件夹路径：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'/path/to/certfile'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">或者将其保持在会话中：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">verify</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'/path/to/certfile'</span>
</pre></div></div><div class="admonition note" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">注解</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">如果&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>&nbsp;设为文件夹路径，文件夹必须通过 OpenSSL 提供的 c_rehash 工具处理。</p></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你还可以通过&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">REQUESTS_CA_BUNDLE</span></code>&nbsp;环境变量定义可信任 CA 列表。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你将&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>&nbsp;设置为 False，Requests 也能忽略对 SSL 证书的验证。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://kennethreitz.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">verify</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">False</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">默认情况下，&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>&nbsp;是设置为 True 的。选项&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>&nbsp;仅应用于主机证书。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"># 对于私有证书，你也可以传递一个 CA_BUNDLE 文件的路径给&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">verify</span></code>。你也可以设置 #&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">REQUEST_CA_BUNDLE</span></code>&nbsp;环境变量。</p></div><div><br></div><h3 id="blogTitle52">客户端证书</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你也可以指定一个本地证书用作客户端证书，可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://kennethreitz.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'/path/client.cert'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'/path/client.key'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">或者保持在会话中：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">cert</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'/path/client.cert'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你指定了一个错误路径或一个无效的证书:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://kennethreitz.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">cert</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s1" style="color: rgb(78, 154, 6);">'/wrong_path/client.pem'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">SSLError: [Errno 336265225] _ssl.c:347: error:140B0009:SSL routines:SSL_CTX_use_PrivateKey_file:PEM lib</span>
</pre></div></div><div class="admonition warning" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(255, 204, 204); border: 1px solid rgb(255, 170, 170); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">警告</p><p style="hyphens: auto; line-height: 1.4em;">警告</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">本地证书的私有 key 必须是解密状态。目前，Requests 不支持使用加密的 key。</p></div></div><div><br></div><h3 id="blogTitle53">CA 证书</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 默认附带了一套它信任的根证书，来自于&nbsp;<a class="reference external" href="https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins/certdata.txt" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Mozilla trust store</a>。然而它们在每次 Requests 更新时才会更新。这意味着如果你固定使用某一版本的 Requests，你的证书有可能已经 太旧了。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">从 Requests 2.4.0 版之后，如果系统中装了&nbsp;<a class="reference external" href="http://certifi.io/" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">certifi</a>&nbsp;包，Requests 会试图使用它里边的 证书。这样用户就可以在不修改代码的情况下更新他们的可信任证书。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">为了安全起见，我们建议你经常更新 certifi！</p></div><div><br></div><h3 id="blogTitle54">响应体内容工作流</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">默认情况下，当你进行网络请求后，响应体会立即被下载。你可以通过&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream</span></code>&nbsp;参数覆盖这个行为，推迟下载响应体直到访问&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.content" title="requests.Response.content" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.content</span></code></a>&nbsp;属性：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">tarball_url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://github.com/kennethreitz/requests/tarball/master'</span>
<span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">tarball_url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">此时仅有响应头被下载下来了，连接保持打开状态，因此允许我们根据条件获取内容：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">if</span> <span class="nb" style="color: rgb(0, 68, 97);">int</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'content-length'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">])</span> <span class="o" style="color: rgb(88, 40, 0);">&lt;</span> <span class="n" style="color: rgb(0, 0, 0);">TOO_LONG</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
  <span class="n" style="color: rgb(0, 0, 0);">content</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">content</span>
  <span class="o" style="color: rgb(88, 40, 0);">...</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以进一步使用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_content" title="requests.Response.iter_content" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_content</span></code></a>&nbsp;和&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" title="requests.Response.iter_lines" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_lines</span></code></a>&nbsp;方法来控制工作流，或者以&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.raw" title="requests.Response.raw" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.raw</span></code></a>&nbsp;从底层 urllib3 的&nbsp;<code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">urllib3.HTTPResponse</span>&nbsp;<span class="pre" style="hyphens: none;">&lt;urllib3.response.HTTPResponse</span></code>&nbsp;读取未解码的响应体。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你在请求中把&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream</span></code>&nbsp;设为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">True</span></code>，Requests 无法将连接释放回连接池，除非你 消耗了所有的数据，或者调用了&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.close" title="requests.Response.close" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.close</span></code></a>。 这样会带来连接效率低下的问题。如果你发现你在使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream=True</span></code>&nbsp;的同时还在部分读取请求的 body（或者完全没有读取 body），那么你就应该考虑使用 with 语句发送请求，这样可以保证请求一定会被关闭：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">with</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">as</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># 在此处理响应。</span></pre></div></div></div><div><br></div><h3 id="blogTitle55">保持活动状态（持久连接）</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">好消息——归功于 urllib3，同一会话内的持久连接是完全自动处理的！同一会话内你发出的任何请求都会自动复用恰当的连接！</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">注意：只有所有的响应体数据被读取完毕连接才会被释放为连接池；所以确保将&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream</span></code>&nbsp;设置为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">False</span></code>或读取&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Response</span></code>&nbsp;对象的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">content</span></code>&nbsp;属性。</p></div><h3 id="blogTitle56">流式上传</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">with</span> <span class="nb" style="color: rgb(0, 68, 97);">open</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'massive-body'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">as</span> <span class="n" style="color: rgb(0, 0, 0);">f</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://some.url/streamed'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">f</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><div class="admonition warning" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(255, 204, 204); border: 1px solid rgb(255, 170, 170); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">警告</p><p style="hyphens: auto; line-height: 1.4em;">警告</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">我们强烈建议你用二进制模式（<a class="reference external" href="https://docs.python.org/2/tutorial/inputoutput.html#reading-and-writing-files" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">binary mode</a>）打开文件。这是因为 requests 可能会为你提供 header 中的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Content-Length</span></code>，在这种情况下该值会被设为文件的<strong>字节数</strong>。如果你用<strong>文本模式</strong>打开文件，就可能碰到错误。</p></div></div><div><br></div><h3 id="blogTitle57">块编码请求</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">对于出去和进来的请求，Requests 也支持分块传输编码。要发送一个块编码的请求，仅需为你的请求体提供一个生成器（或任意没有具体长度的迭代器）：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">def</span> <span class="nf" style="color: rgb(0, 0, 0);">gen</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">():</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">yield</span> <span class="s1" style="color: rgb(78, 154, 6);">'hi'</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">yield</span> <span class="s1" style="color: rgb(78, 154, 6);">'there'</span>

<span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://some.url/chunked'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">gen</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">())</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">对于分块的编码请求，我们最好使用&nbsp;<code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_content()</span></code>&nbsp;对其数据进行迭代。在理想情况下，你的 request 会设置&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream=True</span></code>，这样你就可以通过调用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">iter_content</span></code>&nbsp;并将分块大小参数设为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">None</span></code>，从而进行分块的迭代。如果你要设置分块的最大体积，你可以把分块大小参数设为任意整数。</p></div><div><br></div><h3 id="blogTitle58">POST 多个分块编码的文件</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以在一个请求中发送多个文件。例如，假设你要上传多个图像文件到一个 HTML 表单，使用一个多文件 field 叫做 "images":</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="o" style="color: rgb(88, 40, 0);">&lt;</span><span class="nb" style="color: rgb(0, 68, 97);">input</span> <span class="nb" style="color: rgb(0, 68, 97);">type</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s2" style="color: rgb(78, 154, 6);">"file"</span> <span class="n" style="color: rgb(0, 0, 0);">name</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s2" style="color: rgb(78, 154, 6);">"images"</span> <span class="n" style="color: rgb(0, 0, 0);">multiple</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s2" style="color: rgb(78, 154, 6);">"true"</span> <span class="n" style="color: rgb(0, 0, 0);">required</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="s2" style="color: rgb(78, 154, 6);">"true"</span><span class="o" style="color: rgb(88, 40, 0);">/&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">要实现，只要把文件设到一个元组的列表中，其中元组结构为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">(form_field_name,</span>&nbsp;<span class="pre" style="hyphens: none;">file_info)</span></code>:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/post'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">multiple_files</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span>
<span class="go" style="color: rgb(136, 136, 136);">        ('images', ('foo.png', open('foo.png', 'rb'), 'image/png')),</span>
<span class="go" style="color: rgb(136, 136, 136);">        ('images', ('bar.png', open('bar.png', 'rb'), 'image/png'))]</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">files</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">multiple_files</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span>
<span class="go" style="color: rgb(136, 136, 136);">{</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">  'files': {'images': 'data:image/png;base64,iVBORw ....'}</span>
<span class="go" style="color: rgb(136, 136, 136);">  'Content-Type': 'multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a',</span>
<span class="go" style="color: rgb(136, 136, 136);">  ...</span>
<span class="go" style="color: rgb(136, 136, 136);">}</span>
</pre></div></div><div class="admonition warning" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(255, 204, 204); border: 1px solid rgb(255, 170, 170); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">警告</p><p style="hyphens: auto; line-height: 1.4em;">警告</p><p class="last" style="hyphens: auto; line-height: 1.4em; margin-bottom: 0px;">我们强烈建议你用二进制模式（<a class="reference external" href="https://docs.python.org/2/tutorial/inputoutput.html#reading-and-writing-files" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">binary mode</a>）打开文件。这是因为 requests 可能会为你提供 header 中的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Content-Length</span></code>，在这种情况下该值会被设为文件的<strong>字节数</strong>。如果你用<strong>文本模式</strong>打开文件，就可能碰到错误。</p></div></div><div><br></div><h3 id="blogTitle59">事件挂钩</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests有一个钩子系统，你可以用来操控部分请求过程，或信号事件处理。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">可用的钩子:</p><dl class="docutils" style="margin: 0px; padding: 0px; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><dt><code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">response</span></code>:</dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 1.4em;">从一个请求产生的响应</dd></dl><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以通过传递一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">{hook_name:</span>&nbsp;<span class="pre" style="hyphens: none;">callback_function}</span></code>&nbsp;字典给&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">hooks</span></code>&nbsp;请求参数为每个请求分配一个钩子函数：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">hooks</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="nb" style="color: rgb(0, 68, 97);">dict</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">response</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">print_url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">callback_function</span></code>&nbsp;会接受一个数据块作为它的第一个参数。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">def</span> <span class="nf" style="color: rgb(0, 0, 0);">print_url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="o" style="color: rgb(88, 40, 0);">*</span><span class="n" style="color: rgb(0, 0, 0);">args</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="o" style="color: rgb(88, 40, 0);">**</span><span class="n" style="color: rgb(0, 0, 0);">kwargs</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
    <span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">若执行你的回调函数期间发生错误，系统会给出一个警告。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">若回调函数返回一个值，默认以该值替换传进来的数据。若函数未返回任何东西，也没有什么其他的影响。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们来在运行期间打印一些请求方法的参数：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">hooks</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="nb" style="color: rgb(0, 68, 97);">dict</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">response</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">print_url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">http://httpbin.org</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span></pre></div></div></div><div><br></div><h3 id="blogTitle60">自定义身份验证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 允许你使用自己指定的身份验证机制。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">任何传递给请求方法的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">auth</span></code>&nbsp;参数的可调用对象，在请求发出之前都有机会修改请求。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">自定义的身份验证机制是作为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests.auth.AuthBase</span></code>&nbsp;的子类来实现的，也非常容易定义。Requests 在&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests.auth</span></code>&nbsp;中提供了两种常见的的身份验证方案：&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">HTTPBasicAuth</span></code>&nbsp;和&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">HTTPDigestAuth</span></code>&nbsp;。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">假设我们有一个web服务，仅在&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">X-Pizza</span></code>&nbsp;头被设置为一个密码值的情况下才会有响应。虽然这不太可能，但就以它为例好了。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests.auth</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">AuthBase</span>

<span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">class</span> <span class="nc" style="color: rgb(0, 0, 0);">PizzaAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">AuthBase</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
    <span class="sd" style="color: rgb(143, 89, 2); font-style: italic;">"""Attaches HTTP Pizza Authentication to the given Request object."""</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">def</span> <span class="nf" style="color: rgb(0, 0, 0);">__init__</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="bp" style="color: rgb(52, 101, 164);">self</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">username</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
        <span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># setup any auth-related data here</span>
        <span class="bp" style="color: rgb(52, 101, 164);">self</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">username</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">username</span>

    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">def</span> <span class="nf" style="color: rgb(0, 0, 0);">__call__</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="bp" style="color: rgb(52, 101, 164);">self</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
        <span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># modify and return the request</span>
        <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'X-Pizza'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="bp" style="color: rgb(52, 101, 164);">self</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">username</span>
        <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">return</span> <span class="n" style="color: rgb(0, 0, 0);">r</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">然后就可以使用我们的PizzaAuth来进行网络请求:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://pizzabin.org/admin'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">PizzaAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'kenneth'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span></pre></div></div></div><h3 id="blogTitle61">流式请求</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">使用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" title="requests.Response.iter_lines" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_lines()</span></code></a>&nbsp;你可以很方便地对流式 API （例如&nbsp;<a class="reference external" href="https://dev.twittercom/docs/streaming-api" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Twitter 的流式 API</a>&nbsp;） 进行迭代。简单地设置&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">stream</span></code>&nbsp;为&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;便可以使用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" title="requests.Response.iter_lines" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">iter_lines</span></code></a>&nbsp;对相应进行迭代：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">json</span>
<span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>

<span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/stream/20'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">for</span> <span class="n" style="color: rgb(0, 0, 0);">line</span> <span class="ow" style="color: rgb(0, 68, 97); font-weight: bold;">in</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">iter_lines</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">():</span>

    <span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># filter out keep-alive new lines</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">if</span> <span class="n" style="color: rgb(0, 0, 0);">line</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
        <span class="n" style="color: rgb(0, 0, 0);">decoded_line</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">line</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">decode</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'utf-8'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
        <span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">loads</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">decoded_line</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">当使用&nbsp;<cite>decode_unicode=True</cite>&nbsp;在&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" title="requests.Response.iter_lines" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_lines()</span></code></a>&nbsp;或&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_content" title="requests.Response.iter_content" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.iter_content()</span></code></a>&nbsp;中时，你需要提供一个回退编码方式，以防服务器没有提供默认回退编码，从而导致错误：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/stream/20'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">stream</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">if</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">encoding</span> <span class="ow" style="color: rgb(0, 68, 97); font-weight: bold;">is</span> <span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">None</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">encoding</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'utf-8'</span>

<span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">for</span> <span class="n" style="color: rgb(0, 0, 0);">line</span> <span class="ow" style="color: rgb(0, 68, 97); font-weight: bold;">in</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">iter_lines</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">decode_unicode</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="kc" style="color: rgb(0, 68, 97); font-weight: bold;">True</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">if</span> <span class="n" style="color: rgb(0, 0, 0);">line</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
        <span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">loads</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">line</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
</pre></div></div><div class="admonition warning" style="margin: 20px 0px; padding: 10px 30px; background-color: rgb(255, 204, 204); border: 1px solid rgb(255, 170, 170); color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px;"><p class="first admonition-title" style="margin: 0px 0px 10px; display: inline; hyphens: auto; line-height: 1; font-size: 24px; padding: 0px;">警告</p><p style="hyphens: auto; line-height: 1.4em;">警告</p><p style="hyphens: auto; line-height: 1.4em;"><a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" title="requests.Response.iter_lines" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-meth docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(250, 250, 250);"><span class="pre" style="hyphens: none;">iter_lines</span></code></a>&nbsp;不保证重进入时的安全性。多次调用该方法 会导致部分收到的数据丢失。如果你要在多处调用它，就应该使用生成的迭代器对象:</p><div class="last highlight-default"><div class="highlight" style="background: rgb(255, 255, 255);"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">lines</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">iter_lines</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># 保存第一行以供后面使用，或者直接跳过</span>

<span class="n" style="color: rgb(0, 0, 0);">first_line</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="nb" style="color: rgb(0, 68, 97);">next</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">lines</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">for</span> <span class="n" style="color: rgb(0, 0, 0);">line</span> <span class="ow" style="color: rgb(0, 68, 97); font-weight: bold;">in</span> <span class="n" style="color: rgb(0, 0, 0);">lines</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span>
    <span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">line</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span></pre></div></div></div></div><div><br></div><h3 id="blogTitle62">代理</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果需要使用代理，你可以通过为任意请求方法提供&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">proxies</span></code>&nbsp;参数来配置单个请求:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>

<span class="n" style="color: rgb(0, 0, 0);">proxies</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span>
  <span class="s2" style="color: rgb(78, 154, 6);">"http"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s2" style="color: rgb(78, 154, 6);">"http://10.10.1.10:3128"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
  <span class="s2" style="color: rgb(78, 154, 6);">"https"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s2" style="color: rgb(78, 154, 6);">"http://10.10.1.10:1080"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>

<span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s2" style="color: rgb(78, 154, 6);">"http://example.org"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">proxies</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你也可以通过环境变量&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">HTTP_PROXY</span></code>&nbsp;和&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">HTTPS_PROXY</span></code>&nbsp;来配置代理。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;">$ export HTTP_PROXY="http://10.10.1.10:3128"
$ export HTTPS_PROXY="http://10.10.1.10:1080"

$ python
&gt;&gt;&gt; import requests
&gt;&gt;&gt; requests.get("http://example.org")
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">若你的代理需要使用HTTP Basic Auth，可以使用&nbsp;<cite>http://user:password@host/</cite>&nbsp;语法：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">proxies</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span>
    <span class="s2" style="color: rgb(78, 154, 6);">"http"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s2" style="color: rgb(78, 154, 6);">"http://user:pass@10.10.1.10:3128/"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">要为某个特定的连接方式或者主机设置代理，使用&nbsp;<cite>scheme://hostname</cite>&nbsp;作为 key， 它会针对指定的主机和连接方式进行匹配。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">proxies</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span><span class="s1" style="color: rgb(78, 154, 6);">'http://10.20.1.128'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://10.10.1.10:5323'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">注意，代理 URL 必须包含连接方式。</p></div><div><br></div><h3 id="blogTitle63">SOCKS</h3><div><div class="versionadded" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><p style="hyphens: auto; line-height: 1.4em;"><span class="versionmodified" style="font-style: italic;">2.10.0 新版功能.</span></p></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">除了基本的 HTTP 代理，Request 还支持 SOCKS 协议的代理。这是一个可选功能，若要使用， 你需要安装第三方库。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">pip</span></code>&nbsp;获取依赖:</p><div class="highlight-bash" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;">$ pip install requests<span class="o" style="color: rgb(88, 40, 0);">[</span>socks<span class="o" style="color: rgb(88, 40, 0);">]</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">安装好依赖以后，使用 SOCKS 代理和使用 HTTP 代理一样简单：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">proxies</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">{</span>
    <span class="s1" style="color: rgb(78, 154, 6);">'http'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'socks5://user:pass@host:port'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
    <span class="s1" style="color: rgb(78, 154, 6);">'https'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="s1" style="color: rgb(78, 154, 6);">'socks5://user:pass@host:port'</span>
<span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">}</span></pre></div></div></div><h3 id="blogTitle63">合规性</h3><div><span style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 符合所有相关的规范和 RFC，这样不会为用户造成不必要的困难。但这种对规范的考虑导致一些行为对于不熟悉相关规范的人来说看似有点奇怪。</span><br></div><div><br></div><h3 id="blogTitle64">编码方式</h3><div><div class="section" id="compliance"><div class="section" id="id16"><p style="hyphens: auto; line-height: 1.4em;">当你收到一个响应时，Requests 会猜测响应的编码方式，用于在你调用&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.text" title="requests.Response.text" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.text</span></code></a>&nbsp;方法时对响应进行解码。Requests 首先在 HTTP 头部检测是否存在指定的编码方式，如果不存在，则会使用<a class="reference external" href="http://pypi.python.org/pypi/charade" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">charade</a>&nbsp;来尝试猜测编码方式。</p><p style="hyphens: auto; line-height: 1.4em;">只有当 HTTP 头部不存在明确指定的字符集，并且&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">Content-Type</span></code>&nbsp;头部字段包含&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">text</span></code>&nbsp;值之时， Requests 才不去猜测编码方式。在这种情况下，&nbsp;<a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.7.1" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">RFC 2616</a>&nbsp;指定默认字符集必须是&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">ISO-8859-1</span></code>&nbsp;。Requests 遵从这一规范。如果你需要一种不同的编码方式，你可以手动设置&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.encoding" title="requests.Response.encoding" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.encoding</span></code></a>&nbsp;属性，或使用原始的&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.content" title="requests.Response.content" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.content</span></code></a>。</p></div></div><div class="section" id="http"><span id="http-verbs" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"></span></div></div><h3 id="blogTitle64">HTTP动词</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 提供了几乎所有HTTP动词的功能：GET、OPTIONS、HEAD、POST、PUT、PATCH、DELETE。以下内容为使用 Requests 中的这些动词以及 Github API 提供了详细示例。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我将从最常使用的动词 GET 开始。HTTP GET 是一个幂等方法，从给定的 URL 返回一个资源。因而，当你试图从一个 web 位置获取数据之时，你应该使用这个动词。一个使用示例是尝试从 Github 上获取关于一个特定 commit 的信息。假设我们想获取 Requests 的 commit&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">a050faf</span></code>&nbsp;的信息。我们可以这样去做：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/repos/requests/requests/git/commits/a050faf084662f3a352dd1a941f2c7c9f886d4ad'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">我们应该确认 GitHub 是否正确响应。如果正确响应，我们想弄清响应内容是什么类型的。像这样去做：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">if</span> <span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span> <span class="o" style="color: rgb(88, 40, 0);">==</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">codes</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">ok</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
<span class="gp" style="color: rgb(116, 83, 52);">... </span>    <span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'content-type'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="gp" style="color: rgb(116, 83, 52);">...</span>
<span class="go" style="color: rgb(136, 136, 136);">application/json; charset=utf-8</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">可见，GitHub 返回了 JSON 数据，非常好，这样就可以使用&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">r.json</span></code>&nbsp;方法把这个返回的数据解析成 Python 对象。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">commit_data</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">commit_data</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">keys</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="go" style="color: rgb(136, 136, 136);">[u'committer', u'author', u'url', u'tree', u'sha', u'parents', u'message']</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">commit_data</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'committer'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">{u'date': u'2012-05-10T11:10:50-07:00', u'email': u'me@kennethreitz.com', u'name': u'Kenneth Reitz'}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">commit_data</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'message'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">makin' history</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">到目前为止，一切都非常简单。嗯，我们来研究一下 GitHub 的 API。我们可以去看看文档，但如果使用 Requests 来研究也许会更有意思一点。我们可以借助 Requests 的 OPTIONS 动词来看看我们刚使用过的 url 支持哪些 HTTP 方法。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">verbs</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">options</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">verbs</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">500</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">额，这是怎么回事？毫无帮助嘛！原来 GitHub，与许多 API 提供方一样，实际上并未实现 OPTIONS 方法。这是一个恼人的疏忽，但没关系，那我们可以使用枯燥的文档。然而，如果 GitHub 正确实现了 OPTIONS，那么服务器应该在响应头中返回允许用户使用的 HTTP 方法，例如：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">verbs</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">options</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://a-good-website.com/api/cats'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">verbs</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'allow'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">GET,HEAD,POST,OPTIONS</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">转而去查看文档，我们看到对于提交信息，另一个允许的方法是 POST，它会创建一个新的提交。由于我们正在使用 Requests 代码库，我们应尽可能避免对它发送笨拙的 POST。作为替代，我们来玩玩 GitHub 的 Issue 特性。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">本篇文档是回应&nbsp;<a class="reference external" href="https://github.com/requests/requests/issues/482" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Issue #482</a>&nbsp;而添加的。鉴于该问题已经存在，我们就以它为例。先获取它。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/requests/kennethreitz/requests/issues/482'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">issue</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">loads</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">text</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">issue</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'title'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">])</span>
<span class="go" style="color: rgb(136, 136, 136);">Feature any http verb in docs</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">issue</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'comments'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">])</span>
<span class="go" style="color: rgb(136, 136, 136);">3</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Cool，有 3 个评论。我们来看一下最后一个评论。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">+</span> <span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'/comments'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">comments</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">comments</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="mi" style="color: rgb(153, 0, 0);">0</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">keys</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="go" style="color: rgb(136, 136, 136);">[u'body', u'url', u'created_at', u'updated_at', u'user', u'id']</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">comments</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="mi" style="color: rgb(153, 0, 0);">2</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">][</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'body'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">Probably in the "advanced" section</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">嗯，那看起来似乎是个愚蠢之处。我们发表个评论来告诉这个评论者他自己的愚蠢。那么，这个评论者是谁呢？</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">comments</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="mi" style="color: rgb(153, 0, 0);">2</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">][</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">][</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'login'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">kennethreitz</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">好，我们来告诉这个叫 Kenneth 的家伙，这个例子应该放在快速上手指南中。根据 GitHub API 文档，其方法是 POST 到该话题。我们来试试看。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">body</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">dumps</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">({</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"body"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"Sounds great! I'll get right on it!"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"https://api.github.com/repos/requests/requests/issues/482/comments"</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">body</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">404</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">额，这有点古怪哈。可能我们需要验证身份。那就有点纠结了，对吧？不对。Requests 简化了多种身份验证形式的使用，包括非常常见的 Basic Auth。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests.auth</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">HTTPBasicAuth</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">auth</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">HTTPBasicAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'fake@example.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'not_a_real_password'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">post</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">body</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">201</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">content</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">json</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">content</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s1" style="color: rgb(78, 154, 6);">'body'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">])</span>
<span class="go" style="color: rgb(136, 136, 136);">Sounds great! I'll get right on it.</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">太棒了！噢，不！我原本是想说等我一会，因为我得去喂我的猫。如果我能够编辑这条评论那就好了！幸运的是，GitHub 允许我们使用另一个 HTTP 动词 PATCH 来编辑评论。我们来试试。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">content</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"id"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">])</span>
<span class="go" style="color: rgb(136, 136, 136);">5804413</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">body</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">json</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">dumps</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">({</span><span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"body"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">:</span> <span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"Sounds great! I'll get right on it once I feed my cat."</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">})</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="sa" style="color: rgb(78, 154, 6);">u</span><span class="s2" style="color: rgb(78, 154, 6);">"https://api.github.com/repos/requests/requests/issues/comments/5804413"</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">patch</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">body</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">非常好。现在，我们来折磨一下这个叫 Kenneth 的家伙，我决定要让他急得团团转，也不告诉他是我在捣蛋。这意味着我想删除这条评论。GitHub 允许我们使用完全名副其实的 DELETE 方法来删除评论。我们来清除该评论。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">delete</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">204</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'status'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">'204 No Content'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">很好。不见了。最后一件我想知道的事情是我已经使用了多少限额（ratelimit）。查查看，GitHub 在响应头部发送这个信息，因此不必下载整个网页，我将使用一个 HEAD 请求来获取响应头。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">head</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="nb" style="color: rgb(0, 68, 97);">print</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span>
<span class="gp" style="color: rgb(116, 83, 52);">...</span>
<span class="go" style="color: rgb(136, 136, 136);">'x-ratelimit-remaining': '4995'</span>
<span class="go" style="color: rgb(136, 136, 136);">'x-ratelimit-limit': '5000'</span>
<span class="gp" style="color: rgb(116, 83, 52);">...</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">很好。是时候写个 Python 程序以各种刺激的方式滥用 GitHub 的 API，还可以使用 4995 次呢。</p></div><h3 id="blogTitle65">定制动词</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">有时候你会碰到一些服务器，处于某些原因，它们允许或者要求用户使用上述 HTTP 动词之外的定制动词。比如说 WEBDAV 服务器会要求你使用 MKCOL 方法。别担心，Requests 一样可以搞定它们。你可以使用内建的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">.request</span></code>&nbsp;方法，例如：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">request</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'MKCOL'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">data</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">data</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">status_code</span>
<span class="go" style="color: rgb(136, 136, 136);">200 # Assuming your call was correct</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">这样你就可以使用服务器要求的任意方法动词了。</p></div><h3 id="blogTitle66">响应头链接字段</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">许多 HTTP API 都有响应头链接字段的特性，它们使得 API 能够更好地自我描述和自我显露。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">GitHub 在 API 中为&nbsp;<a class="reference external" href="http://developer.github.com/v3/#pagination" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">分页</a>&nbsp;使用这些特性，例如:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/users/kennethreitz/repos?page=1&amp;per_page=10'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">head</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">headers</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s1" style="color: rgb(78, 154, 6);">'link'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">'&lt;https://api.github.com/users/kennethreitz/repos?page=2&amp;per_page=10&gt;; rel="next", &lt;https://api.github.com/users/kennethreitz/repos?page=6&amp;per_page=10&gt;; rel="last"'</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 会自动解析这些响应头链接字段，并使得它们非常易于使用:</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">links</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s2" style="color: rgb(78, 154, 6);">"next"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">{'url': 'https://api.github.com/users/kennethreitz/repos?page=2&amp;per_page=10', 'rel': 'next'}</span>

<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">r</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">links</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">[</span><span class="s2" style="color: rgb(78, 154, 6);">"last"</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">]</span>
<span class="go" style="color: rgb(136, 136, 136);">{'url': 'https://api.github.com/users/kennethreitz/repos?page=7&amp;per_page=10', 'rel': 'last'}</span></pre></div></div></div><h3 id="blogTitle67">传输适配器</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">从 v1.0.0 以后，Requests 的内部采用了模块化设计。部分原因是为了实现传输适配器（Transport Adapter），你可以看看关于它的<a class="reference external" href="http://www.kennethreitz.org/essays/the-future-of-python-http" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">最早描述</a>。传输适配器提供了一个机制，让你可以为 HTTP 服务定义交互方法。尤其是它允许你应用服务前的配置。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 自带了一个传输适配器，也就是&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.adapters.HTTPAdapter" title="requests.adapters.HTTPAdapter" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">HTTPAdapter</span></code></a>。 这个适配器使用了强大的&nbsp;<a class="reference external" href="https://github.com/shazow/urllib3" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">urllib3</a>，为 Requests 提供了默认的 HTTP 和 HTTPS 交互。每当&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session" title="requests.Session" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>&nbsp;被初始化，就会有适配器附着在&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session" title="requests.Session" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>上，其中一个供 HTTP 使用，另一个供 HTTPS 使用。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Request 允许用户创建和使用他们自己的传输适配器，实现他们需要的特殊功能。创建好以后，传输适配器可以被加载到一个会话对象上，附带着一个说明，告诉会话适配器应该应用在哪个 web 服务上。</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">s</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">Session</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">()</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">s</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">mount</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'http://www.github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">MyAdapter</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">())</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">这个 mount 调用会注册一个传输适配器的特定实例到一个前缀上面。加载以后，任何使用该会话的 HTTP 请求，只要其 URL 是以给定的前缀开头，该传输适配器就会被使用到。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">传输适配器的众多实现细节不在本文档的覆盖范围内，不过你可以看看接下来这个简单的 SSL 用例。更多的用法，你也许该考虑为&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.adapters.BaseAdapter" title="requests.adapters.BaseAdapter" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">BaseAdapter</span></code></a>&nbsp;创建子类。</p></div><h3 id="blogTitle68">阻塞和非阻塞</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">使用默认的传输适配器，Requests 不提供任何形式的非阻塞 IO。&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Response.content" title="requests.Response.content" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-attr docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Response.content</span></code></a>&nbsp;属性会阻塞，直到整个响应下载完成。如果你需要更多精细控制，该库的数据流功能（见&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/user/advanced.html#streaming-requests" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><span class="std std-ref">流式请求</span></a>） 允许你每次接受少量的一部分响应，不过这些调用依然是阻塞式的。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你对于阻塞式 IO 有所顾虑，还有很多项目可以供你使用，它们结合了 Requests 和 Python 的某个异步框架。典型的优秀例子是&nbsp;<a class="reference external" href="https://github.com/kennethreitz/grequests" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">grequests</a>&nbsp;和&nbsp;<a class="reference external" href="https://github.com/ross/requests-futures" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">requests-futures</a>。</p></div><h3 id="blogTitle69">Header 排序</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">在某些特殊情况下你也许需要按照次序来提供 header，如果你向&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">headers</span></code>&nbsp;关键字参数传入一个<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">OrderedDict</span></code>，就可以向提供一个带排序的 header。<strong>然而</strong>，Requests 使用的默认 header 的次序会被优先选择，这意味着如果你在&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">headers</span></code>&nbsp;关键字参数中覆盖了默认 header，和关键字参数中别的 header 相比，它们也许看上去会是次序错误的。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果这个对你来说是个问题，那么用户应该考虑在&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session" title="requests.Session" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>&nbsp;对象上面设置默认 header，只要将&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.Session.headers" title="requests.Session.headers" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-data docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">Session</span></code></a>设为一个定制的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">OrderedDict</span></code>&nbsp;即可。这样就会让它成为优选的次序。</p></div><h3 id="blogTitle70">超时（timeout）</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">为防止服务器不能及时响应，大部分发至外部服务器的请求都应该带着 timeout 参数。在默认情况下，除非显式指定了 timeout 值，requests 是不会自动进行超时处理的。如果没有 timeout，你的代码可能会挂起若干分钟甚至更长时间。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><strong>连接</strong>超时指的是在你的客户端实现到远端机器端口的连接时（对应的是`connect()`_），Request 会等待的秒数。一个很好的实践方法是把连接超时设为比 3 的倍数略大的一个数值，因为&nbsp;<a class="reference external" href="http://www.hjp.at/doc/rfc/rfc2988.txt" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">TCP 数据包重传窗口 (TCP packet retransmission window)</a>&nbsp;的默认大小是 3。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">一旦你的客户端连接到了服务器并且发送了 HTTP 请求，<strong>读取</strong>超时指的就是客户端等待服务器发送请求的时间。（特定地，它指的是客户端要等待服务器发送字节<strong>之间</strong>的时间。在 99.9% 的情况下这指的是服务器发送第一个字节之前的时间）。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你制订了一个单一的值作为 timeout，如下所示：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="mi" style="color: rgb(153, 0, 0);">5</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">这一 timeout 值将会用作&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">connect</span></code>&nbsp;和&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">read</span></code>&nbsp;二者的 timeout。如果要分别制定，就传入一个元组：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="mf" style="color: rgb(153, 0, 0);">3.05</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="mi" style="color: rgb(153, 0, 0);">27</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果远端服务器很慢，你可以让 Request 永远等待，传入一个 None 作为 timeout 值，然后就冲咖啡去吧。</p><div class="highlight-python" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="n" style="color: rgb(0, 0, 0);">r</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://github.com'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">timeout</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="bp" style="color: rgb(52, 101, 164);">None</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span></pre></div></div></div><h2 id="blogTitle71">身份认证</h2><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">本篇文档讨论如何配合 Requests 使用多种身份认证方式。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">许多 web 服务都需要身份认证，并且也有多种不同的认证类型。 以下，我们会从简单到复杂概述 Requests 中可用的几种身份认证形式。</p></div><h3 id="blogTitle72">基本身份认证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">许多要求身份认证的web服务都接受 HTTP Basic Auth。这是最简单的一种身份认证，并且 Requests 对这种认证方式的支持是直接开箱即可用。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">以 HTTP Basic Auth 发送请求非常简单：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests.auth</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">HTTPBasicAuth</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">HTTPBasicAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'pass'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">事实上，HTTP Basic Auth 如此常见，Requests 就提供了一种简写的使用方式：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'https://api.github.com/user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'pass'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">像这样在一个元组中提供认证信息与前一个&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">HTTPBasicAuth</span></code>&nbsp;例子是完全相同的。</p><div class="section" id="netrc" style=""><h4 style="margin: 30px 0px 10px; padding: 0px;">netrc 认证</h4><p style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255); hyphens: auto; line-height: 1.4em;">如果认证方法没有收到&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">auth</span></code>&nbsp;参数，Requests 将试图从用户的 netrc 文件中获取 URL 的 hostname 需要的认证身份。The netrc file overrides raw HTTP authentication headers set with&nbsp;<cite>headers=</cite>.</p><p style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255); hyphens: auto; line-height: 1.4em;">如果找到了 hostname 对应的身份，就会以 HTTP Basic Auth 的形式发送请求。</p></div></div><h3 id="blogTitle73">摘要式身份认证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">另一种非常流行的 HTTP 身份认证形式是摘要式身份认证，Requests 对它的支持也是开箱即可用的：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests.auth</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">HTTPDigestAuth</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/digest-auth/auth/user/pass'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">HTTPDigestAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'user'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'pass'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">))</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span></pre></div></div></div><div><br></div><h3 id="blogTitle74">OAuth 1 认证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Oauth 是一种常见的 Web API 认证方式。&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests-oauthlib</span></code>&nbsp;库可以让 Requests 用户简单地创建 OAuth 认证的请求：</p><dl class="docutils" style="margin: 0px; padding: 0px; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><dt>::</dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 1.4em;"><div class="first highlight-default" style="margin-top: 0px !important;"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">from</span> <span class="nn" style="color: rgb(0, 0, 0);">requests_oauthlib</span> <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="n" style="color: rgb(0, 0, 0);">OAuth1</span>
</pre></div></div><div class="highlight-default"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'https://api.twitter.com/1.1/account/verify_credentials.json'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">auth</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="n" style="color: rgb(0, 0, 0);">OAuth1</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="s1" style="color: rgb(78, 154, 6);">'YOUR_APP_KEY'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'YOUR_APP_SECRET'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span>
<span class="gp" style="color: rgb(116, 83, 52);">... </span>              <span class="s1" style="color: rgb(78, 154, 6);">'USER_OAUTH_TOKEN'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="s1" style="color: rgb(78, 154, 6);">'USER_OAUTH_TOKEN_SECRET'</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
</pre></div></div><div class="last highlight-default"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">)</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div></dd></dl><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">关于 OAuth 工作流程的更多信息，请参见&nbsp;<a class="reference external" href="http://oauth.net/" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">OAuth</a>&nbsp;官方网站。 关于 requests-oauthlib 的文档和用例，请参见 GitHub 的&nbsp;<a class="reference external" href="https://github.com/requests/requests-oauthlib" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">requests_oauthlib</a>&nbsp;代码库。</p></div><div><br></div><h3 id="blogTitle75">OAuth 2 与 OpenID 连接认证</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">requests-oauthlib</span></code>&nbsp;库还可以处理 OAuth 2，OAuth 2 是 OpenID 连接的基础机制。 请查看&nbsp;<a class="reference external" href="http://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">requests-oauthlib OAuth2 documentation</a>&nbsp;文档以了解 OAuth 2 的各种认证管理流程：</p><ul class="simple" style="margin: 10px 0px; padding: 0px; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="http://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html#web-application-flow" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Web Application Flow</a></li><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="http://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html#mobile-application-flow" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Mobile Application Flow</a></li><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="http://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html#legacy-application-flow" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Legacy Application Flow</a></li><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="http://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html#backend-application-flow" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Backend Application Flow</a></li></ul></div><div><br></div><h3 id="blogTitle76">其他身份认证形式</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">Requests 的设计允许其他形式的身份认证用简易的方式插入其中。开源社区的成员时常为更复杂或不那么常用的身份认证形式编写认证处理插件。其中一些最优秀的已被收集在&nbsp;<a class="reference external" href="https://github.com/requests" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Requests organization</a>&nbsp;页面中，包括:</p><ul class="simple" style="margin: 10px 0px; padding: 0px; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="https://github.com/requests/requests-kerberos" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Kerberos</a></li><li style="hyphens: auto; line-height: 1.4em;"><a class="reference external" href="https://github.com/requests/requests-ntlm" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">NTLM</a></li></ul><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你想使用其中任何一种身份认证形式，直接去它们的 GitHub 页面，依照说明进行。</p></div><h3 id="blogTitle77">新的身份认证形式&nbsp;</h3><div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">如果你找不到所需要的身份认证形式的一个良好实现，你也可以自己实现它。Requests 非常易于添加你自己的身份认证形式。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">要想自己实现，就从&nbsp;<a class="reference internal" href="http://docs.python-requests.org/zh_CN/latest/api.html#requests.auth.AuthBase" title="requests.auth.AuthBase" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);"><code class="xref py py-class docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(251, 251, 251); color: rgb(34, 34, 34); font-weight: bold; border-bottom: 1px solid rgb(255, 255, 255);"><span class="pre" style="hyphens: none;">AuthBase</span></code></a>&nbsp;继承一个子类，并实现&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">__call__()</span></code>&nbsp;方法：</p><div class="highlight-default" style="color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);"><div class="highlight" style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;"><pre style="overflow-y: hidden; font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(238, 238, 238); padding: 11px 14px; margin-top: 15px; margin-right: -30px; margin-bottom: 15px; line-height: 1.3em;"><span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 68, 97); font-weight: bold;">import</span> <span class="nn" style="color: rgb(0, 0, 0);">requests</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">class</span> <span class="nc" style="color: rgb(0, 0, 0);">MyAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">AuthBase</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
<span class="gp" style="color: rgb(116, 83, 52);">... </span>    <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">def</span> <span class="nf" style="color: rgb(0, 0, 0);">__call__</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="bp" style="color: rgb(52, 101, 164);">self</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">r</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">):</span>
<span class="gp" style="color: rgb(116, 83, 52);">... </span>        <span class="c1" style="color: rgb(143, 89, 2); font-style: italic;"># Implement my authentication</span>
<span class="gp" style="color: rgb(116, 83, 52);">... </span>        <span class="k" style="color: rgb(0, 68, 97); font-weight: bold;">return</span> <span class="n" style="color: rgb(0, 0, 0);">r</span>
<span class="gp" style="color: rgb(116, 83, 52);">...</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">url</span> <span class="o" style="color: rgb(88, 40, 0);">=</span> <span class="s1" style="color: rgb(78, 154, 6);">'http://httpbin.org/get'</span>
<span class="gp" style="color: rgb(116, 83, 52);">&gt;&gt;&gt; </span><span class="n" style="color: rgb(0, 0, 0);">requests</span><span class="o" style="color: rgb(88, 40, 0);">.</span><span class="n" style="color: rgb(0, 0, 0);">get</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">(</span><span class="n" style="color: rgb(0, 0, 0);">url</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">,</span> <span class="n" style="color: rgb(0, 0, 0);">auth</span><span class="o" style="color: rgb(88, 40, 0);">=</span><span class="n" style="color: rgb(0, 0, 0);">MyAuth</span><span class="p" style="color: rgb(0, 0, 0); font-weight: bold;">())</span>
<span class="go" style="color: rgb(136, 136, 136);">&lt;Response [200]&gt;</span>
</pre></div></div><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">当一个身份认证模块被附加到一个请求上，在设置 request 期间就会调用该模块。因此&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">__call__</span></code>&nbsp;方法必须完成使得身份认证生效的所有事情。一些身份认证形式会额外地添加钩子来提供进一步的功能。</p><p style="hyphens: auto; line-height: 1.4em; color: rgb(62, 67, 73); font-family: Georgia, serif; font-size: 17px; background-color: rgb(255, 255, 255);">你可以在&nbsp;<a class="reference external" href="https://github.com/requests" style="color: rgb(0, 75, 107); text-decoration-line: none; border-bottom: 1px dotted rgb(0, 75, 107);">Requests organization</a>&nbsp;页面的&nbsp;<code class="docutils literal" style="font-family: Consolas, Menlo, &quot;Deja Vu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, monospace; font-size: 0.9em; background-color: rgb(236, 240, 243); color: rgb(34, 34, 34);"><span class="pre" style="hyphens: none;">auth.py</span></code>&nbsp;文件中找到更多示例。</p></div><h2 id="blogTitle78">源码组成与分析</h2></div><pre>|-- adapters.py
|-- api.py
|-- auth.py
|-- certs.py
|-- compat.py
|-- cookies.py
|-- exceptions.py
|-- help.py
|-- hooks.py
|-- __init__.py
|-- _internal_utils.py
|-- models.py
|-- packages.py
|-- sessions.py
|-- status_codes.py
|-- structures.py
|-- utils.py
`-- __version__.py<br></pre><div><br></div><div><h3 id="blogTitle79">adapters.py</h3><h3 id="blogTitle80">api.py</h3><div><div>requests.api</div><div>~~~~~~~~~~~~</div><div><br></div><div>This module implements the Requests API.</div></div><div><br></div><pre>from . import sessions

def request(method, url, **kwargs):
    """Constructs and sends a :class:`Request &lt;Request&gt;`."""

    with sessions.Session() as session:
        return session.request(method=method, url=url, **kwargs)

def get(url, params=None, **kwargs):
    r"""Sends a GET request."""

    kwargs.setdefault('allow_redirects', True)
    return request('get', url, params=params, **kwargs)

def options(url, **kwargs):
    r"""Sends an OPTIONS request."""

    kwargs.setdefault('allow_redirects', True)
    return request('options', url, **kwargs)

def head(url, **kwargs):
    r"""Sends a HEAD request."""

    kwargs.setdefault('allow_redirects', False)
    return request('head', url, **kwargs)

def post(url, data=None, json=None, **kwargs):
    r"""Sends a POST request."""

    return request('post', url, data=data, json=json, **kwargs)

def put(url, data=None, **kwargs):
    r"""Sends a PUT request."""

    return request('put', url, data=data, **kwargs)

def patch(url, data=None, **kwargs):
    r"""Sends a PATCH request."""

    return request('patch', url, data=data, **kwargs)

def delete(url, **kwargs):
    r"""Sends a DELETE request."""

    return request('delete', url, **kwargs)
</pre><div><br></div><h4 id="blogTitle81">request</h4><h4 id="blogTitle82">get</h4><h4 id="blogTitle83">options</h4><h4 id="blogTitle84">head</h4><h4 id="blogTitle85">post</h4><h4 id="blogTitle86">put</h4><h4 id="blogTitle87">patch</h4><h4 id="blogTitle88">delete&nbsp;</h4><div><br></div><div><br></div><h3 id="blogTitle89">auth.py</h3><h3 id="blogTitle90">certs.py</h3><h3 id="blogTitle91">compat.py</h3><h3 id="blogTitle92">cookies.py</h3><h3 id="blogTitle93">exceptions.py</h3><h3 id="blogTitle94">help.py</h3><h3 id="blogTitle95">hooks.py</h3><h3 id="blogTitle96">__init__.py</h3><h3 id="blogTitle97">_internal_utils.py</h3><h3 id="blogTitle98">models.py</h3><h3 id="blogTitle99">packages.py</h3><h3 id="blogTitle100">sessions.py</h3><h3 id="blogTitle101">status_codes.py</h3><h3 id="blogTitle102">structures.py</h3><h3 id="blogTitle103">utils.py</h3><h3 id="blogTitle104">__version__.py</h3><div><br></div></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div>
</article>
{% endblock point1 %}
