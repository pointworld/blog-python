{% extends 'c-word.html' %}

{% block title %} threading - Python | standard library | concurrent execution {% endblock title %}

{% block point1 %}
<article contenteditable="true">
  <p><span style="background-color: yellow;"><b>Category: 计算机 | 程序设计语言 | Python | standard library | concurrent execution | threading </b></span></p>
  <h1 id="blogTitle0">threading</h1><div><span style="text-align: justify; background-color: rgb(255, 255, 255);"><font color="#222222" face="Lucida Grande, Arial, sans-serif"><b>--- 基于线程的并发</b></font><br></span></div><div><strong style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);">源代码:</strong><span style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);">&nbsp;</span><a class="reference external" href="https://github.com/python/cpython/tree/3.7/Lib/threading.py" style="color: rgb(99, 99, 187); text-decoration-line: none; font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);">Lib/threading.py</a><br></div><h2 id="blogTitle1">概述</h2><div>在 python 中，由于 GIL（global interpreter lock，GIL 只允许同一时刻，只有一个线程被CPU 使用）的存在，python 中的多线程是假的。</div><div><br></div><div>如果用 python 实现多任务，实际上多线程的优势或性能并没有多进程高，尤其在多核的时候。</div><div><br></div><div>如何克服 python 中多线程存在的 GIL 问题：</div><div><ul><li>能用进程的地方用进程（存在通信问题）</li><li>用 C 语言来解决 GIL 问题（关键的地方用 C 语言实现）</li></ul></div><div><br></div><h3 id="blogTitle2">线程上下文</h3><pre>...
    进程
        线程  -- threading
            Thread
                name: str                           # 线程的名字
                ident: int                          # 线程的唯一标识
                daemon: bool                        # 是否是守护线程
                _target                             #
                _tstate_lock                        # 线程状态锁
                _started                            # 线程是否已开始
                _is_stoped                          # 线程是否已停止
                _initialized                        # 线程是否已初始化
                _exc_info                           # 执行信息

                __init__()                          # None，实例化一个线程实例
                start()                             # None，开始一个进程（被一个线程最多被调用一次）
                run()                               #
                join()                              # None，等待，直到线程终止
                is_alive()                          # bool，线程是否还活着
                isDaemon()                          # bool，判断当前线程是否是守护线程
                setDaemon(daemonic: bool)           # None，设置当先线程是否为守护线程
                getName()                           # str，返回当前线程的名字
                setName()                           # None，设置当前线程的名字

            主线程 -- _MainThread(Thread)            # subclass，每个进程都存在一个主线程
            假线程 -- _DummyThread(Thread)           # subclass，未开始的线程

            current_thread()                        # Thread，返回当前的线程对象
            active_count()                          # int，返回当前状态为 alive 的线程数量
            enumerate()                             # list，返回当前状态为 alive 的线程对象列表
            main_thread()                           # Thread，返回主线程对象
</pre><div><br></div><div><br></div><div><br></div><pre><h3 id="blogTitle3">Help on module threading</h3>
<h4 id="blogTitle4">NAME</h4>    threading - Thread module emulating a subset of Java's threading model.

<h4 id="blogTitle5">MODULE REFERENCE</h4>    https://docs.python.org/3.7/library/threading

    The following documentation is automatically generated from the Python
    source files.  It may be incomplete, incorrect or include features that
    are considered implementation detail and may vary between Python
    implementations.  When in doubt, consult the module reference at the
    location listed above.

<h4 id="blogTitle6">CLASSES</h4>    builtins.Exception(builtins.BaseException)
        builtins.RuntimeError
            BrokenBarrierError
    builtins.object
        _thread._local
        Barrier
        Condition
        Event
        Semaphore
            BoundedSemaphore
        Thread
            Timer

<h5 id="blogTitle7">    class Barrier(builtins.object)</h5>     |  Barrier(parties, action=None, timeout=None)
     |
     |  Implements a Barrier.
     |
     |  Useful for synchronizing a fixed number of threads at known synchronization
     |  points.  Threads block on 'wait()' and are simultaneously once they have all
     |  made that call.
     |
     |  Methods defined here:
     |
     |  __init__(self, parties, action=None, timeout=None)
     |      Create a barrier, initialised to 'parties' threads.
     |
     |      'action' is a callable which, when supplied, will be called by one of
     |      the threads after they have all entered the barrier and just prior to
     |      releasing them all. If a 'timeout' is provided, it is uses as the
     |      default for all subsequent 'wait()' calls.
     |
     |  abort(self)
     |      Place the barrier into a 'broken' state.
     |
     |      Useful in case of error.  Any currently waiting threads and threads
     |      attempting to 'wait()' will have BrokenBarrierError raised.
     |
     |  reset(self)
     |      Reset the barrier to the initial state.
     |
     |      Any threads currently waiting will get the BrokenBarrier exception
     |      raised.
     |
     |  wait(self, timeout=None)
     |      Wait for the barrier.
     |
     |      When the specified number of threads have started waiting, they are all
     |      simultaneously awoken. If an 'action' was provided for the barrier, one
     |      of the threads will have executed that callback prior to returning.
     |      Returns an individual index number from 0 to 'parties-1'.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)
     |
     |  broken
     |      Return True if the barrier is in a broken state.
     |
     |  n_waiting
     |      Return the number of threads currently waiting at the barrier.
     |
     |  parties
     |      Return the number of threads required to trip the barrier.

<h5 id="blogTitle8">    class BoundedSemaphore(Semaphore)</h5>     |  BoundedSemaphore(value=1)
     |
     |  Implements a bounded semaphore.
     |
     |  A bounded semaphore checks to make sure its current value doesn't exceed its
     |  initial value. If it does, ValueError is raised. In most situations
     |  semaphores are used to guard resources with limited capacity.
     |
     |  If the semaphore is released too many times it's a sign of a bug. If not
     |  given, value defaults to 1.
     |
     |  Like regular semaphores, bounded semaphores manage a counter representing
     |  the number of release() calls minus the number of acquire() calls, plus an
     |  initial value. The acquire() method blocks if necessary until it can return
     |  without making the counter negative. If not given, value defaults to 1.
     |
     |  Method resolution order:
     |      BoundedSemaphore
     |      Semaphore
     |      builtins.object
     |
     |  Methods defined here:
     |
     |  __init__(self, value=1)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  release(self)
     |      Release a semaphore, incrementing the internal counter by one.
     |
     |      When the counter is zero on entry and another thread is waiting for it
     |      to become larger than zero again, wake up that thread.
     |
     |      If the number of releases exceeds the number of acquires,
     |      raise a ValueError.
     |
     |  ----------------------------------------------------------------------
     |  Methods inherited from Semaphore:
     |
     |  __enter__ = acquire(self, blocking=True, timeout=None)
     |
     |  __exit__(self, t, v, tb)
     |
     |  acquire(self, blocking=True, timeout=None)
     |      Acquire a semaphore, decrementing the internal counter by one.
     |
     |      When invoked without arguments: if the internal counter is larger than
     |      zero on entry, decrement it by one and return immediately. If it is zero
     |      on entry, block, waiting until some other thread has called release() to
     |      make it larger than zero. This is done with proper interlocking so that
     |      if multiple acquire() calls are blocked, release() will wake exactly one
     |      of them up. The implementation may pick one at random, so the order in
     |      which blocked threads are awakened should not be relied on. There is no
     |      return value in this case.
     |
     |      When invoked with blocking set to true, do the same thing as when called
     |      without arguments, and return true.
     |
     |      When invoked with blocking set to false, do not block. If a call without
     |      an argument would block, return false immediately; otherwise, do the
     |      same thing as when called without arguments, and return true.
     |
     |      When invoked with a timeout other than None, it will block for at
     |      most timeout seconds.  If acquire does not complete successfully in
     |      that interval, return false.  Return true otherwise.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors inherited from Semaphore:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)

<h5 id="blogTitle9">    class BrokenBarrierError(builtins.RuntimeError)</h5>     |  Unspecified run-time error.
     |
     |  Method resolution order:
     |      BrokenBarrierError
     |      builtins.RuntimeError
     |      builtins.Exception
     |      builtins.BaseException
     |      builtins.object
     |
     |  Data descriptors defined here:
     |
     |  __weakref__
     |      list of weak references to the object (if defined)
     |
     |  ----------------------------------------------------------------------
     |  Methods inherited from builtins.RuntimeError:
     |
     |  __init__(self, /, *args, **kwargs)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  ----------------------------------------------------------------------
     |  Static methods inherited from builtins.RuntimeError:
     |
     |  __new__(*args, **kwargs) from builtins.type
     |      Create and return a new object.  See help(type) for accurate signature.
     |
     |  ----------------------------------------------------------------------
     |  Methods inherited from builtins.BaseException:
     |
     |  __delattr__(self, name, /)
     |      Implement delattr(self, name).
     |
     |  __getattribute__(self, name, /)
     |      Return getattr(self, name).
     |
     |  __reduce__(...)
     |      Helper for pickle.
     |
     |  __repr__(self, /)
     |      Return repr(self).
     |
     |  __setattr__(self, name, value, /)
     |      Implement setattr(self, name, value).
     |
     |  __setstate__(...)
     |
     |  __str__(self, /)
     |      Return str(self).
     |
     |  with_traceback(...)
     |      Exception.with_traceback(tb) --
     |      set self.__traceback__ to tb and return self.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors inherited from builtins.BaseException:
     |
     |  __cause__
     |      exception cause
     |
     |  __context__
     |      exception context
     |
     |  __dict__
     |
     |  __suppress_context__
     |
     |  __traceback__
     |
     |  args

    class Condition(builtins.object)
     |  Condition(lock=None)
     |
     |  Class that implements a condition variable.
     |
     |  A condition variable allows one or more threads to wait until they are
     |  notified by another thread.
     |
     |  If the lock argument is given and not None, it must be a Lock or RLock
     |  object, and it is used as the underlying lock. Otherwise, a new RLock object
     |  is created and used as the underlying lock.
     |
     |  Methods defined here:
     |
     |  __enter__(self)
     |
     |  __exit__(self, *args)
     |
     |  __init__(self, lock=None)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  __repr__(self)
     |      Return repr(self).
     |
     |  notify(self, n=1)
     |      Wake up one or more threads waiting on this condition, if any.
     |
     |      If the calling thread has not acquired the lock when this method is
     |      called, a RuntimeError is raised.
     |
     |      This method wakes up at most n of the threads waiting for the condition
     |      variable; it is a no-op if no threads are waiting.
     |
     |  notifyAll = notify_all(self)
     |
     |  notify_all(self)
     |      Wake up all threads waiting on this condition.
     |
     |      If the calling thread has not acquired the lock when this method
     |      is called, a RuntimeError is raised.
     |
     |  wait(self, timeout=None)
     |      Wait until notified or until a timeout occurs.
     |
     |      If the calling thread has not acquired the lock when this method is
     |      called, a RuntimeError is raised.
     |
     |      This method releases the underlying lock, and then blocks until it is
     |      awakened by a notify() or notify_all() call for the same condition
     |      variable in another thread, or until the optional timeout occurs. Once
     |      awakened or timed out, it re-acquires the lock and returns.
     |
     |      When the timeout argument is present and not None, it should be a
     |      floating point number specifying a timeout for the operation in seconds
     |      (or fractions thereof).
     |
     |      When the underlying lock is an RLock, it is not released using its
     |      release() method, since this may not actually unlock the lock when it
     |      was acquired multiple times recursively. Instead, an internal interface
     |      of the RLock class is used, which really unlocks it even when it has
     |      been recursively acquired several times. Another internal interface is
     |      then used to restore the recursion level when the lock is reacquired.
     |
     |  wait_for(self, predicate, timeout=None)
     |      Wait until a condition evaluates to True.
     |
     |      predicate should be a callable which result will be interpreted as a
     |      boolean value.  A timeout may be provided giving the maximum time to
     |      wait.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)

<h5 id="blogTitle10">    class Event(builtins.object)</h5>     |  Class implementing event objects.
     |
     |  Events manage a flag that can be set to true with the set() method and reset
     |  to false with the clear() method. The wait() method blocks until the flag is
     |  true.  The flag is initially false.
     |
     |  Methods defined here:
     |
     |  __init__(self)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  clear(self)
     |      Reset the internal flag to false.
     |
     |      Subsequently, threads calling wait() will block until set() is called to
     |      set the internal flag to true again.
     |
     |  isSet = is_set(self)
     |
     |  is_set(self)
     |      Return true if and only if the internal flag is true.
     |
     |  set(self)
     |      Set the internal flag to true.
     |
     |      All threads waiting for it to become true are awakened. Threads
     |      that call wait() once the flag is true will not block at all.
     |
     |  wait(self, timeout=None)
     |      Block until the internal flag is true.
     |
     |      If the internal flag is true on entry, return immediately. Otherwise,
     |      block until another thread calls set() to set the flag to true, or until
     |      the optional timeout occurs.
     |
     |      When the timeout argument is present and not None, it should be a
     |      floating point number specifying a timeout for the operation in seconds
     |      (or fractions thereof).
     |
     |      This method returns the internal flag on exit, so it will always return
     |      True except if a timeout is given and the operation times out.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)

<h5 id="blogTitle11">    class Semaphore(builtins.object)</h5>     |  Semaphore(value=1)
     |
     |  This class implements semaphore objects.
     |
     |  Semaphores manage a counter representing the number of release() calls minus
     |  the number of acquire() calls, plus an initial value. The acquire() method
     |  blocks if necessary until it can return without making the counter
     |  negative. If not given, value defaults to 1.
     |
     |  Methods defined here:
     |
     |  __enter__ = acquire(self, blocking=True, timeout=None)
     |
     |  __exit__(self, t, v, tb)
     |
     |  __init__(self, value=1)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  acquire(self, blocking=True, timeout=None)
     |      Acquire a semaphore, decrementing the internal counter by one.
     |
     |      When invoked without arguments: if the internal counter is larger than
     |      zero on entry, decrement it by one and return immediately. If it is zero
     |      on entry, block, waiting until some other thread has called release() to
     |      make it larger than zero. This is done with proper interlocking so that
     |      if multiple acquire() calls are blocked, release() will wake exactly one
     |      of them up. The implementation may pick one at random, so the order in
     |      which blocked threads are awakened should not be relied on. There is no
     |      return value in this case.
     |
     |      When invoked with blocking set to true, do the same thing as when called
     |      without arguments, and return true.
     |
     |      When invoked with blocking set to false, do not block. If a call without
     |      an argument would block, return false immediately; otherwise, do the
     |      same thing as when called without arguments, and return true.
     |
     |      When invoked with a timeout other than None, it will block for at
     |      most timeout seconds.  If acquire does not complete successfully in
     |      that interval, return false.  Return true otherwise.
     |
     |  release(self)
     |      Release a semaphore, incrementing the internal counter by one.
     |
     |      When the counter is zero on entry and another thread is waiting for it
     |      to become larger than zero again, wake up that thread.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)

<h5 id="blogTitle12">    class Thread(builtins.object)</h5>     |  Thread(group=None, target=None, name=None, args=(), kwargs=None, *, daemon=None)
     |
     |  A class that represents a thread of control.
     |
     |  This class can be safely subclassed in a limited fashion. There are two ways
     |  to specify the activity: by passing a callable object to the constructor, or
     |  by overriding the run() method in a subclass.
     |
     |  Methods defined here:
     |
     |  __init__(self, group=None, target=None, name=None, args=(), kwargs=None, *, daemon=None)
     |      This constructor should always be called with keyword arguments. Arguments are:
     |
     |      *group* should be None; reserved for future extension when a ThreadGroup
     |      class is implemented.
     |
     |      *target* is the callable object to be invoked by the run()
     |      method. Defaults to None, meaning nothing is called.
     |
     |      *name* is the thread name. By default, a unique name is constructed of
     |      the form "Thread-N" where N is a small decimal number.
     |
     |      *args* is the argument tuple for the target invocation. Defaults to ().
     |
     |      *kwargs* is a dictionary of keyword arguments for the target
     |      invocation. Defaults to {}.
     |
     |      If a subclass overrides the constructor, it must make sure to invoke
     |      the base class constructor (Thread.__init__()) before doing anything
     |      else to the thread.
     |
     |  __repr__(self)
     |      Return repr(self).
     |
     |  getName(self)
     |
     |  isAlive = is_alive(self)
     |
     |  isDaemon(self)
     |
     |  is_alive(self)
     |      Return whether the thread is alive.
     |
     |      This method returns True just before the run() method starts until just
     |      after the run() method terminates. The module function enumerate()
     |      returns a list of all alive threads.
     |
     |  join(self, timeout=None)
     |      Wait until the thread terminates.
     |
     |      This blocks the calling thread until the thread whose join() method is
     |      called terminates -- either normally or through an unhandled exception
     |      or until the optional timeout occurs.
     |
     |      When the timeout argument is present and not None, it should be a
     |      floating point number specifying a timeout for the operation in seconds
     |      (or fractions thereof). As join() always returns None, you must call
     |      isAlive() after join() to decide whether a timeout happened -- if the
     |      thread is still alive, the join() call timed out.
     |
     |      When the timeout argument is not present or None, the operation will
     |      block until the thread terminates.
     |
     |      A thread can be join()ed many times.
     |
     |      join() raises a RuntimeError if an attempt is made to join the current
     |      thread as that would cause a deadlock. It is also an error to join() a
     |      thread before it has been started and attempts to do so raises the same
     |      exception.
     |
     |  run(self)
     |      Method representing the thread's activity.
     |
     |      You may override this method in a subclass. The standard run() method
     |      invokes the callable object passed to the object's constructor as the
     |      target argument, if any, with sequential and keyword arguments taken
     |      from the args and kwargs arguments, respectively.
     |
     |  setDaemon(self, daemonic)
     |
     |  setName(self, name)
     |
     |  start(self)
     |      Start the thread's activity.
     |
     |      It must be called at most once per thread object. It arranges for the
     |      object's run() method to be invoked in a separate thread of control.
     |
     |      This method will raise a RuntimeError if called more than once on the
     |      same thread object.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors defined here:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)
     |
     |  daemon
     |      A boolean value indicating whether this thread is a daemon thread.
     |
     |      This must be set before start() is called, otherwise RuntimeError is
     |      raised. Its initial value is inherited from the creating thread; the
     |      main thread is not a daemon thread and therefore all threads created in
     |      the main thread default to daemon = False.
     |
     |      The entire Python program exits when no alive non-daemon threads are
     |      left.
     |
     |  ident
     |      Thread identifier of this thread or None if it has not been started.
     |
     |      This is a nonzero integer. See the get_ident() function. Thread
     |      identifiers may be recycled when a thread exits and another thread is
     |      created. The identifier is available even after the thread has exited.
     |
     |  name
     |      A string used for identification purposes only.
     |
     |      It has no semantics. Multiple threads may be given the same name. The
     |      initial name is set by the constructor.

<h5 id="blogTitle13">    ThreadError = class RuntimeError(Exception)</h5>     |  Unspecified run-time error.
     |
     |  Method resolution order:
     |      RuntimeError
     |      Exception
     |      BaseException
     |      object
     |
     |  Methods defined here:
     |
     |  __init__(self, /, *args, **kwargs)
     |      Initialize self.  See help(type(self)) for accurate signature.
     |
     |  ----------------------------------------------------------------------
     |  Static methods defined here:
     |
     |  __new__(*args, **kwargs) from builtins.type
     |      Create and return a new object.  See help(type) for accurate signature.
     |
     |  ----------------------------------------------------------------------
     |  Methods inherited from BaseException:
     |
     |  __delattr__(self, name, /)
     |      Implement delattr(self, name).
     |
     |  __getattribute__(self, name, /)
     |      Return getattr(self, name).
     |
     |  __reduce__(...)
     |      Helper for pickle.
     |
     |  __repr__(self, /)
     |      Return repr(self).
     |
     |  __setattr__(self, name, value, /)
     |      Implement setattr(self, name, value).
     |
     |  __setstate__(...)
     |
     |  __str__(self, /)
     |      Return str(self).
     |
     |  with_traceback(...)
     |      Exception.with_traceback(tb) --
     |      set self.__traceback__ to tb and return self.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors inherited from BaseException:
     |
     |  __cause__
     |      exception cause
     |
     |  __context__
     |      exception context
     |
     |  __dict__
     |
     |  __suppress_context__
     |
     |  __traceback__
     |
     |  args

<h5 id="blogTitle14">    class Timer(Thread)</h5>     |  Timer(interval, function, args=None, kwargs=None)
     |
     |  Call a function after a specified number of seconds:
     |
     |  t = Timer(30.0, f, args=None, kwargs=None)
     |  t.start()
     |  t.cancel()     # stop the timer's action if it's still waiting
     |
     |  Method resolution order:
     |      Timer
     |      Thread
     |      builtins.object
     |
     |  Methods defined here:
     |
     |  __init__(self, interval, function, args=None, kwargs=None)
     |      This constructor should always be called with keyword arguments. Arguments are:
     |
     |      *group* should be None; reserved for future extension when a ThreadGroup
     |      class is implemented.
     |
     |      *target* is the callable object to be invoked by the run()
     |      method. Defaults to None, meaning nothing is called.
     |
     |      *name* is the thread name. By default, a unique name is constructed of
     |      the form "Thread-N" where N is a small decimal number.
     |
     |      *args* is the argument tuple for the target invocation. Defaults to ().
     |
     |      *kwargs* is a dictionary of keyword arguments for the target
     |      invocation. Defaults to {}.
     |
     |      If a subclass overrides the constructor, it must make sure to invoke
     |      the base class constructor (Thread.__init__()) before doing anything
     |      else to the thread.
     |
     |  cancel(self)
     |      Stop the timer if it hasn't finished yet.
     |
     |  run(self)
     |      Method representing the thread's activity.
     |
     |      You may override this method in a subclass. The standard run() method
     |      invokes the callable object passed to the object's constructor as the
     |      target argument, if any, with sequential and keyword arguments taken
     |      from the args and kwargs arguments, respectively.
     |
     |  ----------------------------------------------------------------------
     |  Methods inherited from Thread:
     |
     |  __repr__(self)
     |      Return repr(self).
     |
     |  getName(self)
     |
     |  isAlive = is_alive(self)
     |
     |  isDaemon(self)
     |
     |  is_alive(self)
     |      Return whether the thread is alive.
     |
     |      This method returns True just before the run() method starts until just
     |      after the run() method terminates. The module function enumerate()
     |      returns a list of all alive threads.
     |
     |  join(self, timeout=None)
     |      Wait until the thread terminates.
     |
     |      This blocks the calling thread until the thread whose join() method is
     |      called terminates -- either normally or through an unhandled exception
     |      or until the optional timeout occurs.
     |
     |      When the timeout argument is present and not None, it should be a
     |      floating point number specifying a timeout for the operation in seconds
     |      (or fractions thereof). As join() always returns None, you must call
     |      isAlive() after join() to decide whether a timeout happened -- if the
     |      thread is still alive, the join() call timed out.
     |
     |      When the timeout argument is not present or None, the operation will
     |      block until the thread terminates.
     |
     |      A thread can be join()ed many times.
     |
     |      join() raises a RuntimeError if an attempt is made to join the current
     |      thread as that would cause a deadlock. It is also an error to join() a
     |      thread before it has been started and attempts to do so raises the same
     |      exception.
     |
     |  setDaemon(self, daemonic)
     |
     |  setName(self, name)
     |
     |  start(self)
     |      Start the thread's activity.
     |
     |      It must be called at most once per thread object. It arranges for the
     |      object's run() method to be invoked in a separate thread of control.
     |
     |      This method will raise a RuntimeError if called more than once on the
     |      same thread object.
     |
     |  ----------------------------------------------------------------------
     |  Data descriptors inherited from Thread:
     |
     |  __dict__
     |      dictionary for instance variables (if defined)
     |
     |  __weakref__
     |      list of weak references to the object (if defined)
     |
     |  daemon
     |      A boolean value indicating whether this thread is a daemon thread.
     |
     |      This must be set before start() is called, otherwise RuntimeError is
     |      raised. Its initial value is inherited from the creating thread; the
     |      main thread is not a daemon thread and therefore all threads created in
     |      the main thread default to daemon = False.
     |
     |      The entire Python program exits when no alive non-daemon threads are
     |      left.
     |
     |  ident
     |      Thread identifier of this thread or None if it has not been started.
     |
     |      This is a nonzero integer. See the get_ident() function. Thread
     |      identifiers may be recycled when a thread exits and another thread is
     |      created. The identifier is available even after the thread has exited.
     |
     |  name
     |      A string used for identification purposes only.
     |
     |      It has no semantics. Multiple threads may be given the same name. The
     |      initial name is set by the constructor.

    local = class _local(builtins.object)
     |  Thread-local data
     |
     |  Methods defined here:
     |
     |  __delattr__(self, name, /)
     |      Implement delattr(self, name).
     |
     |  __getattribute__(self, name, /)
     |      Return getattr(self, name).
     |
     |  __setattr__(self, name, value, /)
     |      Implement setattr(self, name, value).
     |
     |  ----------------------------------------------------------------------
     |  Static methods defined here:
     |
     |  __new__(*args, **kwargs) from builtins.type
     |      Create and return a new object.  See help(type) for accurate signature.

<h4 id="blogTitle15">FUNCTIONS</h4><h5 id="blogTitle16">    Lock = allocate_lock(...)</h5>        allocate_lock() -&gt; lock object
        (allocate() is an obsolete synonym)

        Create a new lock object. See help(type(threading.Lock())) for
        information about locks.

<h5 id="blogTitle17">    RLock(*args, **kwargs)</h5>        Factory function that returns a new reentrant lock.

        A reentrant lock must be released by the thread that acquired it. Once a
        thread has acquired a reentrant lock, the same thread may acquire it again
        without blocking; the thread must release it once for each time it has
        acquired it.

<h5 id="blogTitle18">    active_count()</h5>        Return the number of Thread objects currently alive.

        The returned count is equal to the length of the list returned by
        enumerate().

<h5 id="blogTitle19">    current_thread()</h5>        Return the current Thread object, corresponding to the caller's thread of control.

        If the caller's thread of control was not created through the threading
        module, a dummy thread object with limited functionality is returned.

<h5 id="blogTitle20">    enumerate()</h5>        Return a list of all Thread objects currently alive.

        The list includes daemonic threads, dummy thread objects created by
        current_thread(), and the main thread. It excludes terminated threads and
        threads that have not yet been started.

<h5 id="blogTitle21">    get_ident(...)</h5>        get_ident() -&gt; integer

        Return a non-zero integer that uniquely identifies the current thread
        amongst other threads that exist simultaneously.
        This may be used to identify per-thread resources.
        Even though on some platforms threads identities may appear to be
        allocated consecutive numbers starting at 1, this behavior should not
        be relied upon, and the number should be seen purely as a magic cookie.
        A thread's identity may be reused for another thread after it exits.

<h5 id="blogTitle22">    main_thread()</h5>        Return the main thread object.

        In normal conditions, the main thread is the thread from which the
        Python interpreter was started.

<h5 id="blogTitle23">    setprofile(func)</h5>        Set a profile function for all threads started from the threading module.

        The func will be passed to sys.setprofile() for each thread, before its
        run() method is called.

<h5 id="blogTitle24">    settrace(func)</h5>        Set a trace function for all threads started from the threading module.

        The func will be passed to sys.settrace() for each thread, before its run()
        method is called.

<h5 id="blogTitle25">    stack_size(...)</h5>        stack_size([size]) -&gt; size

        Return the thread stack size used when creating new threads.  The
        optional size argument specifies the stack size (in bytes) to be used
        for subsequently created threads, and must be 0 (use platform or
        configured default) or a positive integer value of at least 32,768 (32k).
        If changing the thread stack size is unsupported, a ThreadError
        exception is raised.  If the specified size is invalid, a ValueError
        exception is raised, and the stack size is unmodified.  32k bytes
         currently the minimum supported stack size value to guarantee
        sufficient stack space for the interpreter itself.

        Note that some platforms may have particular restrictions on values for
        the stack size, such as requiring a minimum stack size larger than 32 KiB or
        requiring allocation in multiples of the system memory page size
        - platform documentation should be referred to for more information
        (4 KiB pages are common; using multiples of 4096 for the stack size is
        the suggested approach in the absence of more specific information).

<h4 id="blogTitle26">DATA</h4>    TIMEOUT_MAX = 9223372036.0
    __all__ = ['get_ident', 'active_count', 'Condition', 'current_thread',...

<h4 id="blogTitle27">FILE</h4>    /usr/local/Cellar/python/3.7.2_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/threading.py
<br></pre><div><br></div><h2 id="blogTitle28">threading</h2><div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">这个模块在较低级的模块&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/_thread.html#module-_thread" title="_thread: Low-level threading API." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">_thread</span></code></a>&nbsp;基础上建立较高级的线程接口。参见：&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/queue.html#module-queue" title="queue: A synchronized queue class." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">queue</span></code></a>&nbsp;模块。</p><div class="versionchanged" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="hyphens: auto; text-align: justify; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.7 版更改:&nbsp;</span>这个模块曾经为可选项，但现在总是可用。</p></div><div class="admonition note" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); border-radius: 3px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">注解</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">虽然他们没有在下面列出，这个模块仍然支持Python 2.x系列的这个模块下以&nbsp;<code class="docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">camelCase</span></code>（驼峰法）命名的方法和函数。</p></div><h3 style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);" id="blogTitle29">函数</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">这个模块定义了以下函数：</p><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle30"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">active_count</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.active_count"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.active_count" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回当前存活的线程类&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;对象。返回的计数等于&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.enumerate" title="threading.enumerate" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">enumerate()</span></code></a>&nbsp;返回的列表长度。</p></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle31"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">current_thread</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.current_thread"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.current_thread" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回当前对应调用者的控制线程的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;对象。如果调用者的控制线程不是利用&nbsp;<code class="xref py py-mod docutils literal notranslate" style="color: rgb(99, 99, 187); text-decoration-line: none; background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;"><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#module-threading" title="threading: Thread-based parallelism." style="color: rgb(99, 99, 187); text-decoration-line: none;">threading</a>&nbsp;</span></code>创建，会返回一个功能受限的虚拟线程对象。</p></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle32"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">get_ident</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.get_ident"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.get_ident" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回当前线程的 “线程标识符”。它是一个非零的整数。它的值没有直接含义，主要是用作 magic cookie，比如作为含有线程相关数据的字典的索引。线程标识符可能会在线程退出，新线程创建时被复用。</p><div class="versionadded"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.3 新版功能.</span></p></div></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle33"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">enumerate</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.enumerate"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.enumerate" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">以列表形式返回当前所有存活的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;对象。该列表包含守护线程，&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.current_thread" title="threading.current_thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">current_thread()</span></code></a>&nbsp;创建的虚拟线程对象和主线程。它包含了已终结的线程和尚未开始的线程。</p></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle34"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">main_thread</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.main_thread"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.main_thread" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回主&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;对象。一般情况下，主线程是Python解释器开始时创建的线程。</p><div class="versionadded"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.4 新版功能.</span></p></div></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle35"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">settrace</code><span class="sig-paren" style="font-size: larger;">(</span><em>func</em><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.settrace"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.settrace" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p id="index-0" style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">为所有&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#module-threading" title="threading: Thread-based parallelism." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">threading</span></code></a>&nbsp;模块开始的线程设置追踪函数。在每个线程的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法被调用前，<em>func</em>会被传递给&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/sys.html#sys.settrace" title="sys.settrace" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">sys.settrace()</span></code></a>&nbsp;。</p></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle36"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">setprofile</code><span class="sig-paren" style="font-size: larger;">(</span><em>func</em><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.setprofile"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.setprofile" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p id="index-1" style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">为所有&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#module-threading" title="threading: Thread-based parallelism." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">threading</span></code></a>&nbsp;模块开始的线程设置性能测试函数。在每个线程的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法被调用前，<em>func</em>&nbsp;会被传递给&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/sys.html#sys.setprofile" title="sys.setprofile" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">sys.setprofile()</span></code></a>&nbsp;。</p></dd></dl><dl class="function" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle37"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">stack_size</code><span class="sig-paren" style="font-size: larger;">(</span><span class="optional" style="font-size: 1.3em;">[</span><em>size</em><span class="optional" style="font-size: 1.3em;">]</span><span class="sig-paren" style="font-size: larger;">)</span></h4><dt id="threading.stack_size"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.stack_size" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回创建线程时用的堆栈大小。可选参数&nbsp;<em>size</em>&nbsp;指定之后新建的线程的堆栈大小，而且一定要是0（根据平台或者默认配置）或者最小是32,768(32KiB)的一个正整数。如果&nbsp;<em>size</em>&nbsp;没有指定，默认是0。如果不支持改变线程堆栈大小，会抛出&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;错误。如果指定的堆栈大小不合法，会抛出&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#ValueError" title="ValueError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">ValueError</span></code></a>&nbsp;错误并且不会修改堆栈大小。32KiB是当前最小的能保证解释器有足够堆栈空间的堆栈大小。需要注意的是部分平台对于堆栈大小会有特定的限制，例如要求大于32KiB的堆栈大小或者需要根据系统内存页面的整数倍进行分配 - 应当查阅平台文档有关详细信息（4KiB页面比较普遍，在没有更具体信息的情况下，建议的方法是使用4096的倍数作为堆栈大小）。</p><p class="availability" style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/intro.html#availability" style="color: rgb(99, 99, 187); text-decoration-line: none;">可用性</a>: Windows，具有 POSIX 线程的系统。</p></dd></dl><h3 style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);" id="blogTitle38">常量</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">这个模块同时定义了以下常量：</p><dl class="data" style="margin-bottom: 15px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><h4 id="blogTitle39"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">TIMEOUT_MAX</code></h4><dt id="threading.TIMEOUT_MAX"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.TIMEOUT_MAX" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">阻塞函数（&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Lock.acquire()</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock.acquire" title="threading.RLock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock.acquire()</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Condition.wait()</span></code></a>, ...）中形参&nbsp;<em>timeout</em>允许的最大值。传入超过这个值的 timeout 会抛出&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#OverflowError" title="OverflowError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">OverflowError</span></code></a>&nbsp;异常。</p><div class="versionadded"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.2 新版功能.</span></p></div></dd></dl><h3 style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);" id="blogTitle40">类</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">这个模块定义了许多类，详见以下部分。</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">这个模块的设计大部分基于Java的线程模型。Java令锁和条件变量成为每个对象基本行为，但是在Python中它们是独立的对象。Python的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;类支持Java的线程类的行为子集；目前没有优先级，没有线程组而且线程不能被销毁，停止，暂停，回复或者中断。当实现Java的线程静态方法时，映射到模块级别的函数。</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">下列描述的方法都是自动执行的。</p><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px; background-color: rgb(255, 255, 255);" id="blogTitle41"><font color="#222222" face="Lucida Grande, Arial, sans-serif">线程本地数据</font></h4><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">线程本地数据是特定线程的数据。管理线程本地数据，只需要创建一个&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.local" title="threading.local" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">local</span></code></a>&nbsp;（或者一个子类型）的实例并在实例中储存属性：</p><div class="section" id="thread-local-data" style=""><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">mydata</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">threading</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">local</span><span class="p">()</span>
<span class="n">mydata</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">x</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="mi" style="color: rgb(32, 128, 80);">1</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); hyphens: auto; text-align: justify; line-height: 22.4px;">在不同的线程中，实例的值会不同。</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); margin-bottom: 15px;"><h5 id="blogTitle42"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">local</code></h5><dt id="threading.local"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.local" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">一个代表线程本地数据的类。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">更多相关细节和大量示例，参见&nbsp;<code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">_threading_local</span></code>&nbsp;模块的文档字符串。</p></dd></dl></div><div class="section" id="thread-objects" style=""><h4 style="background-color: rgb(255, 255, 255); hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle43"><font color="#222222" face="Lucida Grande, Arial, sans-serif">线程对象</font></h4><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;class represents an activity that is run in a separate thread of control. There are two ways to specify the activity: by passing a callable object to the constructor, or by overriding the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;method in a subclass. No other methods (except for the constructor) should be overridden in a subclass. In other words,&nbsp;<em>only</em>&nbsp;override the&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__init__()</span></code>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;methods of this class.</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">当线程对象一但被创建，其活动一定会因调用线程的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.start" title="threading.Thread.start" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">start()</span></code></a>&nbsp;方法开始。这会在独立的控制线程调用&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法。</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">一旦线程活动开始，该线程会被认为是 '存活的' 。当它的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法终结了（不管是正常的还是抛出未被处理的异常），就不是'存活的'。&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.is_alive" title="threading.Thread.is_alive" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">is_alive()</span></code></a>&nbsp;方法用于检查线程是否存活。</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">其他线程可以调用一个线程的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;方法。这会阻塞调用该方法的线程，直到被调用&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;方法的线程终结。</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">线程有名字。名字可以传递给构造函数，也可以通过&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.name" title="threading.Thread.name" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">name</span></code></a>&nbsp;属性读取或者修改。</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">一个线程可以被标记成一个 "守护线程" 。这个标志的意义是，只有守护线程都终结，整个Python程序才会退出。初始值继承于创建线程。这个标志可以通过&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">daemon</span></code></a>&nbsp;特征属性或者&nbsp;<em>守护</em>&nbsp;构造函数参数来设置。</p><div class="admonition note" style="background-color: rgb(238, 238, 238); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-top: 10px; margin-bottom: 10px; padding: 7px; border: 1px solid rgb(204, 204, 204); border-radius: 3px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">注解</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">守护线程在程序关闭时会突然关闭。他们的资源（例如已经打开的文档，数据库事务等等）可能没有被正确释放。如果你想你的线程正常停止，设置他们成为非守护模式并且使用合适的信号机制，例如：&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event" title="threading.Event" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Event</span></code></a>。</p></div><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">有个 "主线程" 对象；这对应Python程序里面初始的控制线程。它不是一个守护线程。</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">"虚拟线程对象" 是可以被创建的。这些是对应于“外部线程”的线程对象，它们是在线程模块外部启动的控制线程，例如直接来自C代码。虚拟线程对象功能受限；他们总是被认为是存活的和守护模式，不能被&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;。因为无法检测外来线程的终结，它们永远不会被删除。</p><dl class="class" style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><h5 id="blogTitle44"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Thread</code><span class="sig-paren" style="font-size: larger;">(</span><em>group=None</em>,&nbsp;<em>target=None</em>,&nbsp;<em>name=None</em>,&nbsp;<em>args=()</em>,&nbsp;<em>kwargs={}</em>,&nbsp;<em>*</em>,&nbsp;<em>daemon=None</em><span class="sig-paren" style="font-size: larger;">)</span></h5><dt id="threading.Thread"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">调用这个构造函数时，必需带有关键字参数。参数如下：</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><em>group</em>&nbsp;应该为&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>；为了日后扩展&nbsp;<code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">ThreadGroup</span></code>&nbsp;类实现而保留。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><em>target</em>&nbsp;是用于&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法调用的可调用对象。默认是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>，表示不需要调用任何方法。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><em>name</em>&nbsp;是线程名称。默认情况下，由 "Thread-<em>N</em>" 格式构成一个唯一的名称，其中&nbsp;<em>N</em>&nbsp;是小的十进制数。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><em>args</em>&nbsp;是用于调用目标函数的参数元组。默认是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">()</span></code>。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><em>kwargs</em>&nbsp;是用于调用目标函数的关键字参数字典。默认是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">{}</span></code>。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">如果不是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>，不管当前线程是否守护模式，显式设置成&nbsp;<em>守护模式</em>&nbsp;。如果是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;（默认），守护模式特征属性继承自当前线程。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">如果子类型重载了构造函数，它一定要确保在做任何事前，先发起调用基类构造器(<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread.__init__()</span></code>)。</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>加入&nbsp;<em>daemon</em>&nbsp;参数。</p></div><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle45"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">start</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.start"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.start" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">开始线程活动。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">它在一个线程里最多只能被调用一次。它安排对象的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法在一个独立的控制进程中调用。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">如果同一个线程对象中调用这个方法的次数大于一次，会抛出&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;。</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle46"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">run</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.run"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">代表线程活动的方法。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">你可以在子类型里重载这个方法。标准的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;方法调用一个传递给对象构造函数的可调用对象，如果有，分别从&nbsp;<em>args</em>&nbsp;和&nbsp;<em>kwargs</em>&nbsp;参数中获取顺序和关键字参数。</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle47"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">join</code><span class="sig-paren" style="font-size: larger;">(</span><em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.join"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">等待，直到线程终结。这会阻塞调用这个方法的线程，直到被调用&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;的线程终结 -- 不管是正常终结还是抛出未处理异常 -- 或者直到发生超时，超时选项是可选的。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">当&nbsp;<em>timeout</em>&nbsp;参数存在而且不是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;时，它应该是一个用于指定操作超时的以秒为单位的浮点数（或者分数）。因为&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;总是返回&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;，所以你一定要在&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;后调用&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.is_alive" title="threading.Thread.is_alive" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">is_alive()</span></code></a>&nbsp;才能判断是否发生超时 -- 如果线程仍然存货，则&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;超时。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">当&nbsp;<em>timeout</em>&nbsp;参数不存在或者是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;，这个操作会阻塞直到线程终结。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">一个线程可以被&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;很多次。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">如果尝试加入当前线程会导致死锁，&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>&nbsp;会抛出&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;。如果尝试&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.join" title="threading.Thread.join" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">join()</span></code></a>一个尚未开始的线程，也会抛出相同的异常。</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><h6 id="blogTitle48"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">name</code></h6><dt id="threading.Thread.name"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.name" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">只用于识别的字符串。它没有语义。多个线程可以赋予相同的名称。 初始名称由构造函数设置。</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle49"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">getName</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.getName"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.getName" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><h6 id="blogTitle50"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">setName</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.setName"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.setName" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">旧的&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.name" title="threading.Thread.name" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">name</span></code></a>&nbsp;取值/设值 API；直接当做特征属性使用它。</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><h6 id="blogTitle51"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">ident</code></h6><dt id="threading.Thread.ident"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.ident" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The 'thread identifier' of this thread or&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;if the thread has not been started. This is a nonzero integer. See the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.get_ident" title="threading.get_ident" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">get_ident()</span></code></a>&nbsp;function. Thread identifiers may be recycled when a thread exits and another thread is created. The identifier is available even after the thread has exited.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle52"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">is_alive</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.is_alive"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.is_alive" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">返回线程是否存活。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method returns&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;just before the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;method starts until just after the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.run" title="threading.Thread.run" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">run()</span></code></a>&nbsp;method terminates. The module function&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.enumerate" title="threading.enumerate" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">enumerate()</span></code></a>&nbsp;returns a list of all alive threads.</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><h6 id="blogTitle53"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">daemon</code></h6><dt id="threading.Thread.daemon"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.daemon" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">A boolean value indicating whether this thread is a daemon thread (True) or not (False). This must be set before&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.start" title="threading.Thread.start" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">start()</span></code></a>&nbsp;is called, otherwise&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised. Its initial value is inherited from the creating thread; the main thread is not a daemon thread and therefore all threads created in the main thread default to<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">daemon</span></code></a>&nbsp;=&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The entire Python program exits when no alive non-daemon threads are left.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle54"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">isDaemon</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.isDaemon"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.isDaemon" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><h6 id="blogTitle55"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">setDaemon</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Thread.setDaemon"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.setDaemon" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Old getter/setter API for&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">daemon</span></code></a>; use it directly as a property instead.</p></dd></dl></dd></dl><div class="impl-detail compound" style="border-radius: 3px;"><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); hyphens: auto; text-align: justify; line-height: 22.4px; margin: 0px;"><strong>CPython implementation detail:</strong>&nbsp;In CPython, due to the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-global-interpreter-lock" style="color: rgb(99, 99, 187); text-decoration-line: none;">Global Interpreter Lock</a>, only one thread can execute Python code at once (even though certain performance-oriented libraries might overcome this limitation). If you want your application to make better use of the computational resources of multi-core machines, you are advised to use<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">multiprocessing</span></code></a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">concurrent.futures.ProcessPoolExecutor</span></code></a>. However, threading is still an appropriate model if you want to run multiple I/O-bound tasks simultaneously.</p><p style="hyphens: auto; line-height: 22.4px; margin: 0px;"><br></p><h4 style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); hyphens: auto; text-align: justify; line-height: 22.4px; margin: 0px;" id="blogTitle56">锁对象</h4></div></div><div class="section" id="lock-objects" style="background-color: rgb(255, 255, 255);"><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A primitive lock is a synchronization primitive that is not owned by a particular thread when locked. In Python, it is currently the lowest level synchronization primitive available, implemented directly by the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/_thread.html#module-_thread" title="_thread: Low-level threading API." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">_thread</span></code></a>&nbsp;extension module.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A primitive lock is in one of two states, "locked" or "unlocked". It is created in the unlocked state. It has two basic methods,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>. When the state is unlocked,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;changes the state to locked and returns immediately. When the state is locked,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;blocks until a call to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;in another thread changes it to unlocked, then the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;call resets it to locked and returns. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;method should only be called in the locked state; it changes the state to unlocked and returns immediately. If an attempt is made to release an unlocked lock, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;will be raised.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Locks also support the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#with-locks" style="color: rgb(99, 99, 187); text-decoration-line: none;">context management protocol</a>.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">When more than one thread is blocked in&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;waiting for the state to turn to unlocked, only one thread proceeds when a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;call resets the state to unlocked; which one of the waiting threads proceeds is not defined, and may vary across implementations.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">所有方法都是自动运行的。</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><h5 id="blogTitle57"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Lock</code></h5><dt id="threading.Lock"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The class implementing primitive lock objects. Once a thread has acquired a lock, subsequent attempts to acquire it block, until it is released; any thread may release it.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">需要注意的是&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Lock</span></code>&nbsp;其实是一个工厂函数，返回平台支持的具体锁类中最有效的版本的实例。<br><br><br><br><br><br></p><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle58"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">acquire</code><span class="sig-paren" style="font-size: larger;">(</span><em>blocking=True</em>,&nbsp;<em>timeout=-1</em><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Lock.acquire"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">获得锁，阻塞或非阻塞的。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the&nbsp;<em>blocking</em>&nbsp;argument set to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;(the default), block until the lock is unlocked, then set it to locked and return&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the&nbsp;<em>blocking</em>&nbsp;argument set to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>, do not block. If a call with&nbsp;<em>blocking</em>&nbsp;set to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;would block, return&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>&nbsp;immediately; otherwise, set the lock to locked and return&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the floating-point&nbsp;<em>timeout</em>&nbsp;argument set to a positive value, block for at most the number of seconds specified by&nbsp;<em>timeout</em>&nbsp;and as long as the lock cannot be acquired. A&nbsp;<em>timeout</em>&nbsp;argument of&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">-1</span></code>&nbsp;specifies an unbounded wait. It is forbidden to specify a&nbsp;<em>timeout</em>&nbsp;when&nbsp;<em>blocking</em>&nbsp;is false.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The return value is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;if the lock is acquired successfully,&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>&nbsp;if not (for example if the&nbsp;<em>timeout</em>&nbsp;expired).</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.2 版更改:&nbsp;</span>新的&nbsp;<em>timeout</em>&nbsp;形参。</p></div><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.2 版更改:&nbsp;</span>Lock acquisition can now be interrupted by signals on POSIX if the underlying threading implementation supports it.</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><h6 id="blogTitle59"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">release</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span></h6><dt id="threading.Lock.release"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Release a lock. This can be called from any thread, not only the thread which has acquired the lock.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When the lock is locked, reset it to unlocked, and return. If any other threads are blocked waiting for the lock to become unlocked, allow exactly one of them to proceed.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked on an unlocked lock, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">没有返回值。</p></dd></dl></dd></dl></div><div class="section" id="rlock-objects" style="background-color: rgb(255, 255, 255);"><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle60"><font color="#222222" face="Lucida Grande, Arial, sans-serif">递归锁对象</font></h4><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A reentrant lock is a synchronization primitive that may be acquired multiple times by the same thread. Internally, it uses the concepts of "owning thread" and "recursion level" in addition to the locked/unlocked state used by primitive locks. In the locked state, some thread owns the lock; in the unlocked state, no thread owns it.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">To lock the lock, a thread calls its&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock.acquire" title="threading.RLock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;method; this returns once the thread owns the lock. To unlock the lock, a thread calls its&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;method.&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>/<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>call pairs may be nested; only the final&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;(the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.release" title="threading.Lock.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;of the outermost pair) resets the lock to unlocked and allows another thread blocked in&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock.acquire" title="threading.Lock.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;to proceed.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Reentrant locks also support the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#with-locks" style="color: rgb(99, 99, 187); text-decoration-line: none;">context management protocol</a>.</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.RLock"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">RLock</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This class implements reentrant lock objects. A reentrant lock must be released by the thread that acquired it. Once a thread has acquired a reentrant lock, the same thread may acquire it again without blocking; the thread must release it once for each time it has acquired it.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Note that&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code>&nbsp;is actually a factory function which returns an instance of the most efficient version of the concrete RLock class that is supported by the platform.</p><dl class="method" style="margin-bottom: 15px;"><dt id="threading.RLock.acquire"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">acquire</code><span class="sig-paren" style="font-size: larger;">(</span><em>blocking=True</em>,&nbsp;<em>timeout=-1</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock.acquire" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">获得锁，阻塞或非阻塞的。</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked without arguments: if this thread already owns the lock, increment the recursion level by one, and return immediately. Otherwise, if another thread owns the lock, block until the lock is unlocked. Once the lock is unlocked (not owned by any thread), then grab ownership, set the recursion level to one, and return. If more than one thread is blocked waiting until the lock is unlocked, only one at a time will be able to grab ownership of the lock. There is no return value in this case.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the&nbsp;<em>blocking</em>&nbsp;argument set to true, do the same thing as when called without arguments, and return true.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the&nbsp;<em>blocking</em>&nbsp;argument set to false, do not block. If a call without an argument would block, return false immediately; otherwise, do the same thing as when called without arguments, and return true.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with the floating-point&nbsp;<em>timeout</em>&nbsp;argument set to a positive value, block for at most the number of seconds specified by&nbsp;<em>timeout</em>&nbsp;and as long as the lock cannot be acquired. Return true if the lock has been acquired, false if the timeout has elapsed.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.2 版更改:&nbsp;</span>新的&nbsp;<em>timeout</em>&nbsp;形参。</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.RLock.release"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">release</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock.release" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Release a lock, decrementing the recursion level. If after the decrement it is zero, reset the lock to unlocked (not owned by any thread), and if any other threads are blocked waiting for the lock to become unlocked, allow exactly one of them to proceed. If after the decrement the recursion level is still nonzero, the lock remains locked and owned by the calling thread.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Only call this method when the calling thread owns the lock. A&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised if this method is called when the lock is unlocked.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">没有返回值。</p></dd></dl></dd></dl></div><div class="section" id="condition-objects" style="background-color: rgb(255, 255, 255);"><h2 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle61"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#condition-objects" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle62"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Condition Objects</font></h4><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A condition variable is always associated with some kind of lock; this can be passed in or one will be created by default. Passing one in is useful when several condition variables must share the same lock. The lock is part of the condition object: you don't have to track it separately.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A condition variable obeys the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#with-locks" style="color: rgb(99, 99, 187); text-decoration-line: none;">context management protocol</a>: using the&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">with</span></code>&nbsp;statement acquires the associated lock for the duration of the enclosed block. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.acquire" title="threading.Condition.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;and<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.release" title="threading.Condition.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;methods also call the corresponding methods of the associated lock.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Other methods must be called with the associated lock held. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;method releases the lock, and then blocks until another thread awakens it by calling&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;or<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>. Once awakened,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;re-acquires the lock and returns. It is also possible to specify a timeout.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;method wakes up one of the threads waiting for the condition variable, if any are waiting. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>&nbsp;method wakes up all threads waiting for the condition variable.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Note: the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>&nbsp;methods don't release the lock; this means that the thread or threads awakened will not return from their&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;call immediately, but only when the thread that called&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>&nbsp;finally relinquishes ownership of the lock.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The typical programming style using condition variables uses the lock to synchronize access to some shared state; threads that are interested in a particular change of state call&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;repeatedly until they see the desired state, while threads that modify the state call<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>&nbsp;when they change the state in such a way that it could possibly be a desired state for one of the waiters. For example, the following code is a generic producer-consumer situation with unlimited buffer capacity:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Consume one item</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="n">cv</span><span class="p">:</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">while</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">not</span> <span class="n">an_item_is_available</span><span class="p">():</span>
        <span class="n">cv</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">get_an_available_item</span><span class="p">()</span>

<span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Produce one item</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="n">cv</span><span class="p">:</span>
    <span class="n">make_an_item_available</span><span class="p">()</span>
    <span class="n">cv</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">notify</span><span class="p">()</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">while</span></code>&nbsp;loop checking for the application's condition is necessary because&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;can return after an arbitrary long time, and the condition which prompted the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;call may no longer hold true. This is inherent to multi-threaded programming. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait_for" title="threading.Condition.wait_for" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait_for()</span></code></a>method can be used to automate the condition checking, and eases the computation of timeouts:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Consume an item</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="n">cv</span><span class="p">:</span>
    <span class="n">cv</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">an_item_is_available</span><span class="p">)</span>
    <span class="n">get_an_available_item</span><span class="p">()</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">To choose between&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>, consider whether one state change can be interesting for only one or several waiting threads. E.g. in a typical producer-consumer situation, adding one item to the buffer only needs to wake up one consumer thread.</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.Condition"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Condition</code><span class="sig-paren" style="font-size: larger;">(</span><em>lock=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This class implements condition variable objects. A condition variable allows one or more threads to wait until they are notified by another thread.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If the&nbsp;<em>lock</em>&nbsp;argument is given and not&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>, it must be a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock" title="threading.Lock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Lock</span></code></a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="threading.RLock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code></a>&nbsp;object, and it is used as the underlying lock. Otherwise, a new&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="threading.RLock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code></a>&nbsp;object is created and used as the underlying lock.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>changed from a factory function to a class.</p></div><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.acquire"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">acquire</code><span class="sig-paren" style="font-size: larger;">(</span><em>*args</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.acquire" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Acquire the underlying lock. This method calls the corresponding method on the underlying lock; the return value is whatever that method returns.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.release"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">release</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.release" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Release the underlying lock. This method calls the corresponding method on the underlying lock; there is no return value.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.wait"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">wait</code><span class="sig-paren" style="font-size: larger;">(</span><em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Wait until notified or until a timeout occurs. If the calling thread has not acquired the lock when this method is called, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method releases the underlying lock, and then blocks until it is awakened by a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify_all()</span></code></a>&nbsp;call for the same condition variable in another thread, or until the optional timeout occurs. Once awakened or timed out, it re-acquires the lock and returns.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When the&nbsp;<em>timeout</em>&nbsp;argument is present and not&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>, it should be a floating point number specifying a timeout for the operation in seconds (or fractions thereof).</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When the underlying lock is an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="threading.RLock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code></a>, it is not released using its&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.release" title="threading.Condition.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>method, since this may not actually unlock the lock when it was acquired multiple times recursively. Instead, an internal interface of the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="threading.RLock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code></a>&nbsp;class is used, which really unlocks it even when it has been recursively acquired several times. Another internal interface is then used to restore the recursion level when the lock is reacquired.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The return value is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;unless a given&nbsp;<em>timeout</em>&nbsp;expired, in which case it is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.2 版更改:&nbsp;</span>Previously, the method always returned&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>.</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.wait_for"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">wait_for</code><span class="sig-paren" style="font-size: larger;">(</span><em>predicate</em>,&nbsp;<em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait_for" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Wait until a condition evaluates to true.&nbsp;<em>predicate</em>&nbsp;should be a callable which result will be interpreted as a boolean value. A&nbsp;<em>timeout</em>&nbsp;may be provided giving the maximum time to wait.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This utility method may call&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;repeatedly until the predicate is satisfied, or until a timeout occurs. The return value is the last return value of the predicate and will evaluate to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code>&nbsp;if the method timed out.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Ignoring the timeout feature, calling this method is roughly equivalent to writing:</p><div class="highlight-python3 notranslate" style="position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">while</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">not</span> <span class="n">predicate</span><span class="p">():</span>
    <span class="n">cv</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div></div><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Therefore, the same rules apply as with&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>: The lock must be held when called and is re-acquired on return. The predicate is evaluated with the lock held.</p><div class="versionadded"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.2 新版功能.</span></p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.notify"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">notify</code><span class="sig-paren" style="font-size: larger;">(</span><em>n=1</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">By default, wake up one thread waiting on this condition, if any. If the calling thread has not acquired the lock when this method is called, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method wakes up at most&nbsp;<em>n</em>&nbsp;of the threads waiting for the condition variable; it is a no-op if no threads are waiting.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The current implementation wakes up exactly&nbsp;<em>n</em>&nbsp;threads, if at least&nbsp;<em>n</em>&nbsp;threads are waiting. However, it's not safe to rely on this behavior. A future, optimized implementation may occasionally wake up more than&nbsp;<em>n</em>&nbsp;threads.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Note: an awakened thread does not actually return from its&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.wait" title="threading.Condition.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;call until it can reacquire the lock. Since&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>&nbsp;does not release the lock, its caller should.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Condition.notify_all"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">notify_all</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify_all" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Wake up all threads waiting on this condition. This method acts like&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition.notify" title="threading.Condition.notify" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">notify()</span></code></a>, but wakes up all waiting threads instead of one. If the calling thread has not acquired the lock when this method is called, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>&nbsp;is raised.</p></dd></dl></dd></dl></div><div class="section" id="semaphore-objects" style="background-color: rgb(255, 255, 255);"><h2 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle63"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#semaphore-objects" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle64"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Semaphore Objects</font></h4><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">This is one of the oldest synchronization primitives in the history of computer science, invented by the early Dutch computer scientist Edsger W. Dijkstra (he used the names&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">P()</span></code>and&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">V()</span></code>&nbsp;instead of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>).</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">A semaphore manages an internal counter which is decremented by each&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;call and incremented by each&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;call. The counter can never go below zero; when&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;finds that it is zero, it blocks, waiting until some other thread calls&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Semaphores also support the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#with-locks" style="color: rgb(99, 99, 187); text-decoration-line: none;">context management protocol</a>.</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.Semaphore"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Semaphore</code><span class="sig-paren" style="font-size: larger;">(</span><em>value=1</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This class implements semaphore objects. A semaphore manages an atomic counter representing the number of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>&nbsp;calls minus the number of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;calls, plus an initial value. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="threading.Semaphore.acquire" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code></a>&nbsp;method blocks if necessary until it can return without making the counter negative. If not given,&nbsp;<em>value</em>&nbsp;defaults to 1.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The optional argument gives the initial&nbsp;<em>value</em>&nbsp;for the internal counter; it defaults to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">1</span></code>. If the&nbsp;<em>value</em>&nbsp;given is less than 0,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#ValueError" title="ValueError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">ValueError</span></code></a>&nbsp;is raised.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>changed from a factory function to a class.</p></div><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Semaphore.acquire"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">acquire</code><span class="sig-paren" style="font-size: larger;">(</span><em>blocking=True</em>,&nbsp;<em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.acquire" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Acquire a semaphore.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked without arguments:</p><ul class="simple" style="margin-bottom: 10px;"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">If the internal counter is larger than zero on entry, decrement it by one and return true immediately.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">If the internal counter is zero on entry, block until awoken by a call to<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>. Once awoken (and the counter is greater than 0), decrement the counter by 1 and return true. Exactly one thread will be awoken by each call to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="threading.Semaphore.release" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code></a>. The order in which threads are awoken should not be relied on.</li></ul><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with&nbsp;<em>blocking</em>&nbsp;set to false, do not block. If a call without an argument would block, return false immediately; otherwise, do the same thing as when called without arguments, and return true.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When invoked with a&nbsp;<em>timeout</em>&nbsp;other than&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>, it will block for at most&nbsp;<em>timeout</em>seconds. If acquire does not complete successfully in that interval, return false. Return true otherwise.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.2 版更改:&nbsp;</span>新的&nbsp;<em>timeout</em>&nbsp;形参。</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Semaphore.release"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">release</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore.release" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Release a semaphore, incrementing the internal counter by one. When it was zero on entry and another thread is waiting for it to become larger than zero again, wake up that thread.</p></dd></dl></dd></dl><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.BoundedSemaphore"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">BoundedSemaphore</code><span class="sig-paren" style="font-size: larger;">(</span><em>value=1</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BoundedSemaphore" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Class implementing bounded semaphore objects. A bounded semaphore checks to make sure its current value doesn't exceed its initial value. If it does,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#ValueError" title="ValueError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">ValueError</span></code></a>&nbsp;is raised. In most situations semaphores are used to guard resources with limited capacity. If the semaphore is released too many times it's a sign of a bug. If not given,&nbsp;<em>value</em>&nbsp;defaults to 1.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>changed from a factory function to a class.</p></div></dd></dl><div class="section" id="semaphore-example" style=""><h3 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 22.4px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle65"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#semaphore-example" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h3><h5 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle66"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Semaphore Example</font></h5><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Semaphores are often used to guard resources with limited capacity, for example, a database server. In any situation where the size of the resource is fixed, you should use a bounded semaphore. Before spawning any worker threads, your main thread would initialize the semaphore:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">maxconnections</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="mi" style="color: rgb(32, 128, 80);">5</span>
<span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># ...</span>
<span class="n">pool_sema</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">BoundedSemaphore</span><span class="p">(</span><span class="n">value</span><span class="o" style="color: rgb(102, 102, 102);">=</span><span class="n">maxconnections</span><span class="p">)</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Once spawned, worker threads call the semaphore's acquire and release methods when they need to connect to the server:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="n">pool_sema</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">connectdb</span><span class="p">()</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">try</span><span class="p">:</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># ... use connection ...</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">finally</span><span class="p">:</span>
        <span class="n">conn</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">close</span><span class="p">()</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The use of a bounded semaphore reduces the chance that a programming error which causes the semaphore to be released more than it's acquired will go undetected.</p></div></div><div class="section" id="event-objects" style="background-color: rgb(255, 255, 255);"><h2 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle67"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#event-objects" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle68"><font color="#222222" face="Lucida Grande, Arial, sans-serif">事件对象</font></h4><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">This is one of the simplest mechanisms for communication between threads: one thread signals an event and other threads wait for it.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">An event object manages an internal flag that can be set to true with the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.set" title="threading.Event.set" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">set()</span></code></a>&nbsp;method and reset to false with the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.clear" title="threading.Event.clear" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">clear()</span></code></a>&nbsp;method. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.wait" title="threading.Event.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;method blocks until the flag is true.</p><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.Event"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Event</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Class implementing event objects. An event manages a flag that can be set to true with the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.set" title="threading.Event.set" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">set()</span></code></a>&nbsp;method and reset to false with the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.clear" title="threading.Event.clear" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">clear()</span></code></a>&nbsp;method. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.wait" title="threading.Event.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;method blocks until the flag is true. The flag is initially false.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>changed from a factory function to a class.</p></div><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Event.is_set"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">is_set</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.is_set" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Return true if and only if the internal flag is true.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Event.set"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">set</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.set" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Set the internal flag to true. All threads waiting for it to become true are awakened. Threads that call&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.wait" title="threading.Event.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;once the flag is true will not block at all.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Event.clear"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">clear</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.clear" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Reset the internal flag to false. Subsequently, threads calling&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.wait" title="threading.Event.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;will block until&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.set" title="threading.Event.set" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">set()</span></code></a>&nbsp;is called to set the internal flag to true again.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Event.wait"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">wait</code><span class="sig-paren" style="font-size: larger;">(</span><em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.wait" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Block until the internal flag is true. If the internal flag is true on entry, return immediately. Otherwise, block until another thread calls&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Event.set" title="threading.Event.set" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">set()</span></code></a>&nbsp;to set the flag to true, or until the optional timeout occurs.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When the timeout argument is present and not&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>, it should be a floating point number specifying a timeout for the operation in seconds (or fractions thereof).</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method returns true if and only if the internal flag has been set to true, either before the wait call or after the wait starts, so it will always return&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;except if a timeout is given and the operation times out.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.1 版更改:&nbsp;</span>Previously, the method always returned&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>.</p></div></dd></dl></dd></dl></div><div class="section" id="timer-objects" style="background-color: rgb(255, 255, 255);"><h2 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle69"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#timer-objects" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><h4 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle70"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Timer Objects</font></h4><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">This class represents an action that should be run only after a certain amount of time has passed --- a timer.&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Timer" title="threading.Timer" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Timer</span></code></a>&nbsp;is a subclass of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Thread" title="threading.Thread" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Thread</span></code></a>&nbsp;and as such also functions as an example of creating custom threads.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Timers are started, as with threads, by calling their&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">start()</span></code>&nbsp;method. The timer can be stopped (before its action has begun) by calling the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Timer.cancel" title="threading.Timer.cancel" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">cancel()</span></code></a>&nbsp;method. The interval the timer will wait before executing its action may not be exactly the same as the interval specified by the user.</p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">例如:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">hello</span><span class="p">():</span>
    <span class="nb" style="color: rgb(0, 112, 32);">print</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"hello, world"</span><span class="p">)</span>

<span class="n">t</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">Timer</span><span class="p">(</span><span class="mf" style="color: rgb(32, 128, 80);">30.0</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
<span class="n">t</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># after 30 seconds, "hello, world" will be printed</span>
</pre></div></div><dl class="class" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.Timer"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Timer</code><span class="sig-paren" style="font-size: larger;">(</span><em>interval</em>,&nbsp;<em>function</em>,&nbsp;<em>args=None</em>,&nbsp;<em>kwargs=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Timer" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Create a timer that will run&nbsp;<em>function</em>&nbsp;with arguments&nbsp;<em>args</em>&nbsp;and keyword arguments&nbsp;<em>kwargs</em>, after&nbsp;<em>interval</em>&nbsp;seconds have passed. If&nbsp;<em>args</em>&nbsp;is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;(the default) then an empty list will be used. If&nbsp;<em>kwargs</em>&nbsp;is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;(the default) then an empty dict will be used.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.3 版更改:&nbsp;</span>changed from a factory function to a class.</p></div><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Timer.cancel"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">cancel</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Timer.cancel" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Stop the timer, and cancel the execution of the timer's action. This will only work if the timer is still in its waiting stage.</p></dd></dl></dd></dl></div><div class="section" id="barrier-objects" style=""><h2 style="background-color: rgb(255, 255, 255); color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle71"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#barrier-objects" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><div class="versionadded" style=""><h4 style="hyphens: auto; line-height: 22.4px;" id="blogTitle72"><span class="versionmodified" style="">壁垒对象</span></h4><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.2 新版功能.</span></p></div><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">This class provides a simple synchronization primitive for use by a fixed number of threads that need to wait for each other. Each of the threads tries to pass the barrier by calling the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.wait" title="threading.Barrier.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;method and will block until all of the threads have made their&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.wait" title="threading.Barrier.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;calls. At this point, the threads are released simultaneously.</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">The barrier can be reused any number of times for the same number of threads.</p><p style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">As an example, here is a simple way to synchronize a client and server thread:</p><div class="highlight-python3 notranslate" style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">b</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">Barrier</span><span class="p">(</span><span class="mi" style="color: rgb(32, 128, 80);">2</span><span class="p">,</span> <span class="n">timeout</span><span class="o" style="color: rgb(102, 102, 102);">=</span><span class="mi" style="color: rgb(32, 128, 80);">5</span><span class="p">)</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">server</span><span class="p">():</span>
    <span class="n">start_server</span><span class="p">()</span>
    <span class="n">b</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">while</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">True</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">accept_connection</span><span class="p">()</span>
        <span class="n">process_server_connection</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">client</span><span class="p">():</span>
    <span class="n">b</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">while</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">True</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">make_connection</span><span class="p">()</span>
        <span class="n">process_client_connection</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
</pre></div></div><dl class="class" style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.Barrier"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Barrier</code><span class="sig-paren" style="font-size: larger;">(</span><em>parties</em>,&nbsp;<em>action=None</em>,&nbsp;<em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Create a barrier object for&nbsp;<em>parties</em>&nbsp;number of threads. An&nbsp;<em>action</em>, when provided, is a callable to be called by one of the threads when they are released.&nbsp;<em>timeout</em>&nbsp;is the default timeout value if none is specified for the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.wait" title="threading.Barrier.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>&nbsp;method.</p><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Barrier.wait"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">wait</code><span class="sig-paren" style="font-size: larger;">(</span><em>timeout=None</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.wait" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Pass the barrier. When all the threads party to the barrier have called this function, they are all released simultaneously. If a&nbsp;<em>timeout</em>&nbsp;is provided, it is used in preference to any that was supplied to the class constructor.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The return value is an integer in the range 0 to&nbsp;<em>parties</em>&nbsp;-- 1, different for each thread. This can be used to select a thread to do some special housekeeping, e.g.:</p><div class="highlight-python3 notranslate" style="position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">i</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">barrier</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">wait</span><span class="p">()</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="n">i</span> <span class="o" style="color: rgb(102, 102, 102);">==</span> <span class="mi" style="color: rgb(32, 128, 80);">0</span><span class="p">:</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Only one thread needs to print this</span>
    <span class="nb" style="color: rgb(0, 112, 32);">print</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"passed the barrier"</span><span class="p">)</span>
</pre></div></div><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If an&nbsp;<em>action</em>&nbsp;was provided to the constructor, one of the threads will have called it prior to being released. Should this call raise an error, the barrier is put into the broken state.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If the call times out, the barrier is put into the broken state.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method may raise a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BrokenBarrierError" title="threading.BrokenBarrierError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">BrokenBarrierError</span></code></a>&nbsp;exception if the barrier is broken or reset while a thread is waiting.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Barrier.reset"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">reset</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.reset" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Return the barrier to the default, empty state. Any threads waiting on it will receive the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BrokenBarrierError" title="threading.BrokenBarrierError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">BrokenBarrierError</span></code></a>&nbsp;exception.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Note that using this function may can require some external synchronization if there are other threads whose state is unknown. If a barrier is broken it may be better to just leave it and create a new one.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="threading.Barrier.abort"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">abort</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.abort" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Put the barrier into a broken state. This causes any active or future calls to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.wait" title="threading.Barrier.wait" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">wait()</span></code></a>to fail with the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BrokenBarrierError" title="threading.BrokenBarrierError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">BrokenBarrierError</span></code></a>. Use this for example if one of the needs to abort, to avoid deadlocking the application.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">It may be preferable to simply create the barrier with a sensible&nbsp;<em>timeout</em>&nbsp;value to automatically guard against one of the threads going awry.</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><dt id="threading.Barrier.parties"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">parties</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.parties" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The number of threads required to pass the barrier.</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><dt id="threading.Barrier.n_waiting"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">n_waiting</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.n_waiting" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The number of threads currently waiting in the barrier.</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><dt id="threading.Barrier.broken"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">broken</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier.broken" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">A boolean that is&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>&nbsp;if the barrier is in the broken state.</p></dd></dl></dd></dl><dl class="exception" style="background-color: rgb(255, 255, 255); color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; margin-bottom: 15px;"><dt id="threading.BrokenBarrierError"><em class="property">exception&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">threading.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">BrokenBarrierError</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BrokenBarrierError" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This exception, a subclass of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RuntimeError" title="RuntimeError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RuntimeError</span></code></a>, is raised when the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Barrier" title="threading.Barrier" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Barrier</span></code></a>&nbsp;object is reset or broken.</p></dd></dl></div><div class="section" id="using-locks-conditions-and-semaphores-in-the-with-statement" style="background-color: rgb(255, 255, 255);"><h2 style="color: rgb(26, 26, 26); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 25.6px; font-weight: normal; border: 0px; margin: 0px; padding: 0.3em 0px;" id="blogTitle73"><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/threading.html#using-locks-conditions-and-semaphores-in-the-with-statement" title="永久链接至标题" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></h2><h3 style="hyphens: auto; text-align: justify; line-height: 22.4px;" id="blogTitle74"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Using locks, conditions, and semaphores in the with statement</font></h3><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">All of the objects provided by this module that have&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code>&nbsp;and&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code>&nbsp;methods can be used as context managers for a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/compound_stmts.html#with" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref std std-keyword docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">with</span></code></a>&nbsp;statement. The&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">acquire()</span></code>&nbsp;method will be called when the block is entered, and&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">release()</span></code>&nbsp;will be called when the block is exited. Hence, the following snippet:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="n">some_lock</span><span class="p">:</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># do something...</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">相当于:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">some_lock</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">try</span><span class="p">:</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># do something...</span>
<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">finally</span><span class="p">:</span>
    <span class="n">some_lock</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">release</span><span class="p">()</span>
</pre></div></div><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 22.4px;">Currently,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Lock" title="threading.Lock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Lock</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.RLock" title="threading.RLock" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RLock</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Condition" title="threading.Condition" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Condition</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.Semaphore" title="threading.Semaphore" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Semaphore</span></code></a>, and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/threading.html#threading.BoundedSemaphore" title="threading.BoundedSemaphore" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">BoundedSemaphore</span></code></a>&nbsp;objects may be used as&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/compound_stmts.html#with" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref std std-keyword docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">with</span></code></a>&nbsp;statement context managers.</p></div></div><h2 id="blogTitle75">多线程开发可能遇到的问题</h2><h3 id="blogTitle76">线程不安全现象</h3><div><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">假设两个线程t1和t2都要对num=0进行增1运算，t1和t2都各对num修改10次，num的最终的结果应该为20。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">但是由于是多线程访问，有可能出现下面情况：</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">在num=0时，t1取得num=0。此时系统把t1调度为”sleeping”状态，把t2转换为”running”状态，t2也获得num=0。然后t2对得到的值进行加1并赋给num，使得num=1。然后系统又把t2调度为”sleeping”，把t1转为”running”。线程t1又把它之前得到的0加1后赋值给num。这样，明明t1和t2都完成了1次加1工作，但结果仍然是num=1。</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); white-space: pre-wrap; letter-spacing: 0.2px; font-size: 16px; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; color: rgb(157, 190, 216);"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> threading <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> Thread
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time

g_num = <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0</span>

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> g_num
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000000</span>):
        g_num += <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>

    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---test1---g_num=%d"</span>%g_num)

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> g_num
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000000</span>):
        g_num += <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>

    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---test2---g_num=%d"</span>%g_num)


p1 = Thread(target=test1)
p1.start()

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># time.sleep(3) #取消屏蔽之后 再次运行程序，结果会不一样，，，为啥呢？</span>

p2 = Thread(target=test2)
p2.start()

print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---g_num=%d---"</span>%g_num)
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em; letter-spacing: 0.2px; font-size: 16px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: rgb(189, 202, 219); widows: 3; orphans: 3;"><br></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">运行结果(可能不一样，但是结果往往不是2000000)：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">284672</span>---
---test1---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1166544</span>
---test2---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1406832</span>
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px;"><br></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">取消屏蔽之后，再次运行结果如下：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); white-space: pre-wrap; letter-spacing: 0.2px; font-size: 16px; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; color: rgb(157, 190, 216);"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">---test1---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000000</span>
---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1041802</span>---
---test2---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2000000</span>
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em; letter-spacing: 0.2px; font-size: 16px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: rgb(189, 202, 219); widows: 3; orphans: 3;"><br></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">问题产生的原因就是没有控制多个线程对同一资源的访问，对数据造成破坏，使得线程运行的结果不可预期。这种现象称为“线程不安全”。</p></div><div><br></div><div><br></div><h3 id="blogTitle77">同步</h3><pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><span class="pg-emphasize pg-emphasize-yellow" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border-radius: 2px; background: rgb(255, 247, 0); padding: 1px; font-size: inherit;">同步就是协同步调，按预定的先后次序进行运行</span>。如:你说完，我再说。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">"同"字从字面上容易理解为一起动作</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">其实不是，"同"字应是指协同、协助、互相配合。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">如进程、线程同步，可理解为进程或线程A和B一块配合，A执行到一定程度时要依靠B的某个结果，于是停下来，示意B运行;B依言执行，再将结果给A;A再继续操作。</p></pre><div><br></div><h4 id="blogTitle78">同步应用</h4><pre><h5 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle79">多个线程有序执行</h5><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> threading <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> Thread, Lock
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> time <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> sleep

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">Task1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">while</span> <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>:
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> lock1.acquire():
                print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"------Task 1 -----"</span>)
                sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0.5</span>)
                lock2.release()

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">Task2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">while</span> <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>:
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> lock2.acquire():
                print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"------Task 2 -----"</span>)
                sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0.5</span>)
                lock3.release()

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">Task3</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">while</span> <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>:
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> lock3.acquire():
                print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"------Task 3 -----"</span>)
                sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0.5</span>)
                lock1.release()

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#使用Lock创建出的锁默认没有“锁上”</span>
lock1 = Lock()
<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#创建另外一把锁，并且“锁上”</span>
lock2 = Lock()
lock2.acquire()
<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#创建另外一把锁，并且“锁上”</span>
lock3 = Lock()
lock3.acquire()

t1 = Task1()
t2 = Task2()
t3 = Task3()

t1.start()
t2.start()
t3.start()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">运行结果:</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span> -----
------Task <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span> -----
...省略...
</code></pre><h5 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.25em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle80">总结</h5><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin-top: 0px; padding: 0px 0px 0px 2em; margin-right: 0px; margin-left: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">可以使用互斥锁完成多个任务，有序的进程工作，这就是线程的同步</li></ul></pre><div><br></div><div><br></div><div><br></div><div><br></div><h3 id="blogTitle81">互斥锁</h3><div><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;"><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none;">当多个线程几乎同时修改某一个共享数据的时候，需要进行同步控制</span></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">线程同步能够保证多个线程安全访问竞争资源，最简单的同步机制是引入互斥锁。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">互斥锁为资源引入一个状态：锁定/非锁定。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; margin-top: 0px; margin-bottom: 0.85em;">某个线程要更改共享数据时，先将其锁定，此时资源的状态为“锁定”，其他线程不能更改；直到该线程释放资源，将资源的状态变成“非锁定”，其他的线程才能再次锁定该资源。互斥锁保证了每次只有一个线程进行写入操作，从而保证了多线程情况下数据的正确性。</p></div><div><br></div><pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">threading模块中定义了Lock类，可以方便的处理锁定：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">#创建锁
mutex = threading.Lock()
#锁定
mutex.acquire([blocking])
#释放
mutex.release()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">其中，锁定方法acquire可以有一个blocking参数。</p><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">如果设定blocking为True，则当前线程会堵塞，直到获取到这个锁为止（如果没有指定，那么默认为True）</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">如果设定blocking为False，则当前线程不会堵塞</li></ul><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">使用互斥锁实现上面的例子的代码如下：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> threading <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> Thread, Lock
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time

g_num = <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0</span>

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> g_num
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000000</span>):
        <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#True表示堵塞 即如果这个锁在上锁之前已经被上锁了，那么这个线程会在这里一直等待到解锁为止 </span>
        <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#False表示非堵塞，即不管本次调用能够成功上锁，都不会卡在这,而是继续执行下面的代码</span>
        mutexFlag = mutex.acquire(<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>)
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexFlag:
            g_num += <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
            mutex.release()

    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---test1---g_num=%d"</span>%g_num)

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> g_num
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000000</span>):
        mutexFlag = mutex.acquire(<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>) <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#True表示堵塞</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexFlag:
            g_num += <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
            mutex.release()

    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---test2---g_num=%d"</span>%g_num)

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#创建一个互斥锁</span>
<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#这个所默认是未上锁的状态</span>
mutex = Lock()

p1 = Thread(target=test1)
p1.start()


p2 = Thread(target=test2)
p2.start()

print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---g_num=%d---"</span>%g_num)
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">运行结果：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">61866</span>---
---test1---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1861180</span>
---test2---g_num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2000000</span>
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">可以看到，加入互斥锁后，运行结果与预期相符。<br><br></p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle82">上锁解锁过程</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">当一个线程调用锁的acquire()方法获得锁时，锁就进入“locked”状态。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">每次只有一个线程可以获得锁。如果此时另一个线程试图获得这个锁，该线程就会变为“blocked”状态，称为“阻塞”，直到拥有锁的线程调用锁的release()方法释放锁之后，锁进入“unlocked”状态。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">线程调度程序从处于同步阻塞状态的线程中选择一个来获得锁，并使得该线程进入运行（running）状态。</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle83">总结</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">锁的好处：</p><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">确保了某段关键代码只能由一个线程从头到尾完整地执行</li></ul><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">锁的坏处：</p><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin-top: 0px; padding: 0px 0px 0px 2em; margin-right: 0px; margin-left: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下降了</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">由于可以存在多个锁，不同的线程持有不同的锁，并试图获取对方持有的锁时，可能会造成死锁</li></ul></pre><div><br></div><h3 id="blogTitle84">非共享数据</h3><pre><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle85">非全局变量不需要加锁</h4><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#coding=utf-8</span>
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> threading
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time

    <span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">MyThread</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(threading.Thread)</span>:</span>
        <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 重写 构造方法</span>
        <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">__init__</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self,num,sleepTime)</span>:</span>
            threading.Thread.__init__(self)
            self.num = num
            self.sleepTime = sleepTime

        <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
            self.num += <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
            time.sleep(self.sleepTime)
            print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'线程(%s),num=%d'</span>%(self.name, self.num))

    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> __name__ == <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'__main__'</span>:
        mutex = threading.Lock()
        t1 = MyThread(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">100</span>,<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">5</span>)
        t1.start()
        t2 = MyThread(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">200</span>,<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>)
        t2.start()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">运行结果:</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/22.gif" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> threading
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> time <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> sleep

    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(sleepTime)</span>:</span>
        num=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
        sleep(sleepTime)
        num+=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
        print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'---(%s)--num=%d'</span>%(threading.current_thread(), num))


    t1 = threading.Thread(target = test,args=(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">5</span>,))
    t2 = threading.Thread(target = test,args=(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>,))

    t1.start()
    t2.start()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/28.gif" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle86">总结</h4><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin-top: 0px; padding: 0px 0px 0px 2em; margin-right: 0px; margin-left: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">在多线程开发中，全局变量是多个线程都共享的数据，而局部变量等是各自线程的，是非共享的</li></ul></pre><h3 id="blogTitle87">死锁</h3><pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">现实社会中，男女双方都在等待对方先道歉</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/Snip20160828_4.png" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">如果双方都这样固执的等待对方先开口，弄不好，就分搜了</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle88">1. 死锁</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">在线程间共享多个资源的时候，如果两个线程分别占有一部分资源并且同时等待对方的资源，就会造成死锁。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">尽管死锁很少发生，但一旦发生就会造成应用的停止响应。下面看一个死锁的例子</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#coding=utf-8</span>
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> threading
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">MyThread1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(threading.Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexA.acquire():
            print(self.name+<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'----do1---up----'</span>)
            time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>)

            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexB.acquire():
                print(self.name+<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'----do1---down----'</span>)
                mutexB.release()
            mutexA.release()

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">MyThread2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(threading.Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexB.acquire():
            print(self.name+<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'----do2---up----'</span>)
            time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>)
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> mutexA.acquire():
                print(self.name+<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'----do2---down----'</span>)
                mutexA.release()
            mutexB.release()

mutexA = threading.Lock()
mutexB = threading.Lock()

<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> __name__ == <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'__main__'</span>:
    t1 = MyThread1()
    t2 = MyThread2()
    t1.start()
    t2.start()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">运行结果：&nbsp;<img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/2.gif" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">此时已经进入到了死锁状态，可以使用ctrl-z退出</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle89">3. 避免死锁</h4><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">程序设计时要尽量避免（银行家算法）</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">添加超时时间等</li></ul><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle90">附录-银行家算法</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">[背景知识]</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">一个银行家如何将一定数目的资金安全地借给若干个客户，使这些客户既能借到钱完成要干的事，同时银行家又能收回全部资金而不至于破产，这就是银行家问题。这个问题同操作系统中资源分配问题十分相似：银行家就像一个操作系统，客户就像运行的进程，银行家的资金就是系统的资源。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">[问题的描述]</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">一个银行家拥有一定数量的资金，有若干个客户要贷款。每个客户须在一开始就声明他所需贷款的总额。若该客户贷款总额不超过银行家的资金总数，银行家可以接收客户的要求。客户贷款是以每次一个资金单位（如1万RMB等）的方式进行的，客户在借满所需的全部单位款额之前可能会等待，但银行家须保证这种等待是有限的，可完成的。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">例如：有三个客户C1，C2，C3，向银行家借款，该银行家的资金总额为10个资金单位，其中C1客户要借9各资金单位，C2客户要借3个资金单位，C3客户要借8个资金单位，总计20个资金单位。某一时刻的状态如图所示。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/Snip20170319_9.png" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">对于a图的状态，按照安全序列的要求，我们选的第一个客户应满足该客户所需的贷款小于等于银行家当前所剩余的钱款，可以看出只有C2客户能被满足：C2客户需1个资金单位，小银行家手中的2个资金单位，于是银行家把1个资金单位借给C2客户，使之完成工作并归还所借的3个资金单位的钱，进入b图。同理，银行家把4个资金单位借给C3客户，使其完成工作，在c图中，只剩一个客户C1，它需7个资金单位，这时银行家有8个资金单位，所以C1也能顺利借到钱并完成工作。最后（见图d）银行家收回全部10个资金单位，保证不赔本。那麽客户序列{C1，C2，C3}就是个安全序列，按照这个序列贷款，银行家才是安全的。否则的话，若在图b状态时，银行家把手中的4个资金单位借给了C1，则出现不安全状态：这时C1，C3均不能完成工作，而银行家手中又没有钱了，系统陷入僵持局面，银行家也不能收回投资。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;">综上所述，银行家算法是从当前状态出发，逐个按安全序列检查各客户谁能完成其工作，然后假定其完成工作且归还全部贷款，再进而检查下一个能完成工作的客户，......。如果所有客户都能完成工作，则找到一个安全序列，银行家才是安全的。</p></pre><div><br></div><h3 id="blogTitle91">生产者与消费者模式</h3><pre><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle92">1. 队列</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">先进先出</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/113992901.jpg" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle93">2. 栈</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">先进后出</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><img src="file:///D:/%E8%AF%BE%E4%BB%B6/Python%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/html%E7%89%88/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B-%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6/Images/476e440adf9a0b538b45e.jpeg" alt="" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border: 0px; font-size: inherit; break-inside: avoid; max-width: 100%;"></p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">Python的Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先入先出)队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue。这些队列都实现了锁原语（可以理解为原子操作，即要么不做，要么就做完），能够在多线程中直接使用。可以使用队列来实现线程间的同步。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">用FIFO队列实现上述生产者与消费者问题的代码如下：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#encoding=utf-8</span>
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> threading
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#python2中</span>
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> Queue <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> Queue

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">#python3中</span>
<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># from queue import Queue</span>

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">Producer</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(threading.Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> queue
        count = <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">while</span> <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>:
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> queue.qsize() &lt; <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1000</span>:
                <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">100</span>):
                    count = count +<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>
                    msg = <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'生成产品'</span>+str(count)
                    queue.put(msg)
                    print(msg)
            time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0.5</span>)

<span class="hljs-class" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">class</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">Consumer</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(threading.Thread)</span>:</span>
    <span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">run</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(self)</span>:</span>
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">global</span> queue
        <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">while</span> <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">True</span>:
            <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> queue.qsize() &gt; <span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">100</span>:
                <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span>):
                    msg = self.name + <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'消费了 '</span>+queue.get()
                    print(msg)
            time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>)


<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">if</span> __name__ == <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'__main__'</span>:
    queue = Queue()

    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">500</span>):
        queue.put(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'初始产品'</span>+str(i))
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span>):
        p = Producer()
        p.start()
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">5</span>):
        c = Consumer()
        c.start()
</code></pre><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle94">3. Queue的说明</h4><ol style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">对于Queue，在多线程通信之间扮演重要的角色</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">添加数据到队列中，使用put()方法</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">从队列中取数据，使用get()方法</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">判断队列中是否还有数据，使用qsize()方法</li></ol><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle95">4. 生产者消费者模式的说明</h4><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">为什么要使用生产者和消费者模式</li></ul><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">在线程世界里，生产者就是生产数据的线程，消费者就是消费数据的线程。在多线程开发当中，如果生产者处理速度很快，而消费者处理速度很慢，那么生产者就必须等待消费者处理完，才能继续生产数据。同样的道理，如果消费者的处理能力大于生产者，那么消费者就必须等待生产者。为了解决这个问题于是引入了生产者和消费者模式。</p><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">什么是生产者消费者模式</li></ul><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">生产者消费者模式是通过一个容器来解决生产者和消费者的强耦合问题。生产者和消费者彼此之间不直接通讯，而通过阻塞队列来进行通讯，所以生产者生产完数据之后不用等待消费者处理，直接扔给阻塞队列，消费者不找生产者要数据，而是直接从阻塞队列里取，阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;">这个阻塞<span class="pg-emphasize pg-emphasize-yellow" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; border-radius: 2px; background: rgb(255, 247, 0); padding: 1px; font-size: inherit;">队列就是用来给生产者和消费者解耦的</span>。纵观大多数设计模式，都会找一个第三者出来进行解耦</p></pre><div><br></div><h3 id="blogTitle96">ThreadLocal</h3><pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">在多线程环境下，每个线程都有自己的数据。一个线程使用自己的局部变量比使用全局变量好，因为局部变量只有线程自己能看见，不会影响其他线程，而全局变量的修改必须加锁。</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle97">1. 使用函数传参的方法</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">但是局部变量也有问题，就是在函数调用的时候，传递起来很麻烦：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">process_student</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(name)</span>:</span>
    std = Student(name)
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># std是局部变量，但是每个函数都要用它，因此必须传进去：</span>
    do_task_1(std)
    do_task_2(std)

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">do_task_1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(std)</span>:</span>
    do_subtask_1(std)
    do_subtask_2(std)

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">do_task_2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(std)</span>:</span>
    do_subtask_2(std)
    do_subtask_2(std)
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">每个函数一层一层调用都这么传参数那还得了？用全局变量？也不行，因为每个线程处理不同的Student对象，不能共享。</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle98">2. 使用全局字典的方法</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">如果用一个全局dict存放所有的Student对象，然后以thread自身作为key获得线程对应的Student对象如何？</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">global_dict = {}

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">std_thread</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(name)</span>:</span>
    std = Student(name)
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 把std放到全局变量global_dict中：</span>
    global_dict[threading.current_thread()] = std
    do_task_1()
    do_task_2()

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">do_task_1</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 不传入std，而是根据当前线程查找：</span>
    std = global_dict[threading.current_thread()]
    ...

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">do_task_2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 任何函数都可以查找出当前线程的std变量：</span>
    std = global_dict[threading.current_thread()]
    ...
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">这种方式理论上是可行的，它最大的优点是消除了std对象在每层函数中的传递问题，但是，每个函数获取std的代码有点low。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">有没有更简单的方式？</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle99">3. 使用ThreadLocal的方法</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">ThreadLocal应运而生，不用查找dict，ThreadLocal帮你自动做这件事：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> threading

<span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 创建全局ThreadLocal对象:</span>
local_school = threading.local()

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">process_student</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 获取当前线程关联的student:</span>
    std = local_school.student
    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'Hello, %s (in %s)'</span> % (std, threading.current_thread().name))

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">process_thread</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(name)</span>:</span>
    <span class="hljs-comment" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);"># 绑定ThreadLocal的student:</span>
    local_school.student = name
    process_student()

t1 = threading.Thread(target= process_thread, args=(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'dongGe'</span>,), name=<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'Thread-A'</span>)
t2 = threading.Thread(target= process_thread, args=(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'老王'</span>,), name=<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">'Thread-B'</span>)
t1.start()
t2.start()
t1.join()
t2.join()
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">执行结果：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">Hello, dongGe (in Thread-A)
Hello, 老王 (in Thread-B)
</code></pre><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.5em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle100">说明</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">全局变量local_school就是一个ThreadLocal对象，每个Thread对它都可以读写student属性，但互不影响。你可以把local_school看成全局变量，但每个属性如local_school.student都是线程的局部变量，可以任意读写而互不干扰，也不用管理锁的问题，ThreadLocal内部会处理。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">可以理解为全局变量local_school是一个dict，不但可以用local_school.student，还可以绑定其他变量，如local_school.teacher等等。</p><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">ThreadLocal最常用的地方就是为每个线程绑定一个数据库连接，HTTP请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源。</p><h4 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 1.75em; orphans: 3; widows: 3; break-after: avoid; margin-top: 1.275em; margin-bottom: 0.85em; color: rgb(255, 255, 250); border-color: rgb(55, 59, 78); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;" id="blogTitle101">4. 小结</h4><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal; margin-bottom: 0px !important;">一个ThreadLocal变量虽然是全局变量，但每个线程都只能读写自己线程的独立副本，互不干扰。ThreadLocal解决了参数在一个线程中各个函数之间互相传递的问题</p></pre><h3>异步</h3><pre><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">同步调用就是你 喊 你朋友吃饭 ，你朋友在忙 ，你就一直在那等，等你朋友忙完了 ，你们一起去</li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;">异步调用就是你 喊 你朋友吃饭 ，你朋友说知道了 ，待会忙完去找你 ，你就去做别的了。</li></ul><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; margin-bottom: 1.275em; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">from</span> multiprocessing <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> Pool
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> time
<span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">import</span> os

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">()</span>:</span>
    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---进程池中的进程---pid=%d,ppid=%d--"</span>%(os.getpid(),os.getppid()))
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">for</span> i <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">in</span> range(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span>):
        print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"----%d---"</span>%i)
        time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>)
    <span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">return</span> <span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"hahah"</span>

<span class="hljs-function" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(122, 166, 218);"><span class="hljs-keyword" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(195, 151, 216);">def</span> <span class="hljs-title" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(150, 152, 150);">test2</span><span class="hljs-params" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">(args)</span>:</span>
    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---callback func--pid=%d"</span>%os.getpid())
    print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"---callback func--args=%s"</span>%args)

pool = Pool(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">3</span>)
pool.apply_async(func=test,callback=test2)

time.sleep(<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">5</span>)

print(<span class="hljs-string" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(185, 202, 74);">"----主进程-pid=%d----"</span>%os.getpid())
</code></pre><p style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em; color: rgb(189, 202, 219); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; letter-spacing: 0.2px; white-space: normal;">运行结果：</p><pre style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 16px; white-space: pre-wrap; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); color: rgb(157, 190, 216); overflow-wrap: normal; margin-top: 0px; padding-top: 0.85em; padding-bottom: 0.85em; background-color: rgb(45, 49, 67); letter-spacing: 0.2px; margin-bottom: 0px !important;"><code class="lang-python" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; break-inside: avoid; direction: ltr; border: none rgb(45, 49, 67); padding: 0px; margin: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; display: inline; max-width: initial; overflow: initial; line-height: inherit; white-space: pre;">---进程池中的进程---pid=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">9401</span>,ppid=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">9400</span>--
----<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">0</span>---
----<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">1</span>---
----<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">2</span>---
---callback func--pid=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">9400</span>
---callback func--args=hahah
----主进程-pid=<span class="hljs-number" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; color: rgb(231, 140, 69);">9400</span>----</code></pre></pre><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div><div><br></div>
</article>
{% endblock point1 %}
