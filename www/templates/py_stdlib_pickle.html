{% extends 'c-word.html' %}

{% block title %} pickle - Python | standard library | data persistence {% endblock title %}

{% block point1 %}
<article contenteditable="true">
  <p><span style="background-color: yellow;"><b>Category: 计算机 | 程序设计语言 | Python | standard library | data persistence | pickle</b></span></p>
  <h1 id="blogTitle0">pickle</h1><h2 id="blogTitle1">概述</h2><p>pickle 模块实现了基本的数据序列化和反序列化。通过 pickle 模块的序列化操作我们能够将程序中运行的对象信息保存到文件中去，永久存储；通过 pickle 模块的反序列化操作，我们能够从文件中创建上一次程序保存的对象。</p><p>在官方的介绍中，序列化操作的英文描述有好几个单词，如 ”serializing”, “pickling”, “serialization”,&nbsp; “marshalling”&nbsp; 或者 ”flattening” 等，它们都代表的是序列化的意思。相应的，反序列化操作的英文单词也有好多个，如 ”de-serializing”, “unpickling”, “deserailization” 等。为了避免混淆，一般用 ”pickling”/“unpickling”, 或者 ”serialization”/“deserailization”。</p><p>pickle 模块是以二进制的形式序列化后保存到文件中（保存文件的后缀为 ”.pkl”），不能直接打开进行预览。而 python 的另一个序列化标准模块 json，则是 human-readable 的，可以直接打开查看（例如在 notepad++ 中查看）。</p><p>pickle 模块实现了用于序列化和反序列化 Python 对象结构的二进制协议。 “Pickling” 是将 Python 对象层次结构转换为字节流的过程，“unpickling” 是相反的操作，即字节流（来自二进制文件或类似字节的对象）被转换回对象层次结构。 picking（unpickle）可替代地被称为“序列”，“marshalling”&nbsp; 或 “flattening”; 然而，为了避免混淆，这里使用的术语是 “pickling” 和 “unpickling”。</p><p>注意：pickle 模块对于错误或恶意构建的数据不安全，切记，不要 unpickle 从不可信或未经认证的来源收到的数据。</p><div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module implements binary protocols for serializing and de-serializing a Python object structure.&nbsp;<em>"Pickling"</em>&nbsp;is the process whereby a Python object hierarchy is converted into a byte stream, and&nbsp;<em>"unpickling"</em>&nbsp;is the inverse operation, whereby a byte stream (from a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-binary-file" style="color: rgb(99, 99, 187); text-decoration-line: none;">binary file</a>&nbsp;or&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-bytes-like-object" style="color: rgb(99, 99, 187); text-decoration-line: none;">bytes-like object</a>) is converted back into an object hierarchy. Pickling (and unpickling) is alternatively known as "serialization", "marshalling,"&nbsp;<a class="footnote-reference" href="https://docs.python.org/zh-cn/3/library/pickle.html#id6" id="id1" style="color: rgb(99, 99, 187); text-decoration-line: none;">[1]</a>&nbsp;or "flattening"; however, to avoid confusion, the terms used here are "pickling" and "unpickling".</p><div class="admonition warning" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(255, 228, 228); border: 1px solid rgb(255, 102, 102); border-radius: 3px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">警告</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background: rgb(239, 194, 194); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module is not secure against erroneous or maliciously constructed data. Never unpickle data received from an untrusted or unauthenticated source.</p></div></div><h3 id="blogTitle2">Data Persistence</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The modules described in this chapter support storing Python data in a persistent form on disk. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a>&nbsp;modules can turn many Python data types into a stream of bytes and then recreate the objects from the bytes. The various DBM-related modules support a family of hash-based file formats that store a mapping of strings to other strings.</p><h3 id="blogTitle3">Relationship to other Python modules</h3><h4 id="blogTitle4">Comparison with marshal</h4><p style="hyphens: auto; text-align: justify; line-height: 22.4px; background-color: rgb(255, 255, 255);"><font color="#222222" face="Lucida Grande, Arial, sans-serif">Python has a more primitive serialization module called&nbsp;</font><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a><font color="#222222" face="Lucida Grande, Arial, sans-serif">, but in general&nbsp;</font><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a><font color="#222222" face="Lucida Grande, Arial, sans-serif">&nbsp;should always be the preferred way to serialize Python objects.&nbsp;</font><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a><font color="#222222" face="Lucida Grande, Arial, sans-serif">&nbsp;exists primarily to support Python's&nbsp;</font><code class="file docutils literal notranslate" style="color: rgb(34, 34, 34); font-family: monospace, sans-serif; font-size: 15.44px; background-color: rgb(236, 240, 243); padding: 0px 1px; border-radius: 3px;"><span class="pre" style="hyphens: none;">.pyc</span></code><font color="#222222" face="Lucida Grande, Arial, sans-serif">&nbsp;files.</font><br><br><font color="#222222" face="Lucida Grande, Arial, sans-serif">Python 有一个更原始的序列化模块 marshal，但通常 pickle 应该是序列化 Python 对象的首选方式。marshal 主要是为了支持 Python 的 .pyc 文件。</font><br></p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module differs from&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a>&nbsp;in several significant ways:</p><ul style="background-color: rgb(255, 255, 255);"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;"><p class="first" style="hyphens: auto; line-height: 22.4px; margin-top: 0px !important;"><font color="#222222" face="Lucida Grande, Arial, sans-serif">The&nbsp;</font><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a><font color="#222222" face="Lucida Grande, Arial, sans-serif">&nbsp;module keeps track of the objects it has already serialized, so that later references to the same object won't be serialized again.&nbsp;</font><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a><font color="#222222" face="Lucida Grande, Arial, sans-serif">&nbsp;doesn't do this.</font><br><br><font color="#222222" face="Lucida Grande, Arial, sans-serif">该 pickle 模块跟踪它已经序列化的对象，以便以后对同一对象的引用不会再次序列化。marshal&nbsp; 不这样做。</font><br></p><p style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; line-height: 22.4px;">This has implications both for recursive objects and object sharing. Recursive objects are objects that contain references to themselves. These are not handled by marshal, and in fact, attempting to marshal recursive objects will crash your Python interpreter. Object sharing happens when there are multiple references to the same object in different places in the object hierarchy being serialized.&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;stores such objects only once, and ensures that all other references point to the master copy. Shared objects remain shared, which can be very important for mutable objects.<br></p><p style="hyphens: auto; line-height: 22.4px;"><font color="#222222" face="Lucida Grande, Arial, sans-serif">这对递归对象和对象共享都有影响。递归对象是包含对自己的引用的对象。这些不是由编组处理的，实际上，尝试编组递归对象会导致Python解释器崩溃。如果在被序列化的对象层次结构中的不同位置存在多个对同一对象的引用，则会发生对象共享。pickle 只存储一次这样的对象，并确保所有其他引用指向主副本。共享对象保持共享，这对于可变对象非常重要。</font></p></li><li style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p class="first" style="hyphens: auto; line-height: 22.4px; margin-top: 0px !important;"><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a>&nbsp;cannot be used to serialize user-defined classes and their instances.&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;can save and restore class instances transparently, however the class definition must be importable and live in the same module as when the object was stored.</p></li><li style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p class="first" style="hyphens: auto; line-height: 22.4px; margin-top: 0px !important;">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/marshal.html#module-marshal" title="marshal: Convert Python objects to streams of bytes and back (with different constraints)." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">marshal</span></code></a>&nbsp;serialization format is not guaranteed to be portable across Python versions. Because its primary job in life is to support&nbsp;<code class="file docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">.pyc</span></code>&nbsp;files, the Python implementers reserve the right to change the serialization format in non-backwards compatible ways should the need arise. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;serialization format is guaranteed to be backwards compatible across Python releases provided a compatible pickle protocol is chosen and pickling and unpickling code deals with Python 2 to Python 3 type differences if your data is crossing that unique breaking change language boundary.</p></li></ul><h4 id="blogTitle5">Comparison with json</h4><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">There are fundamental differences between the pickle protocols and&nbsp;<a class="reference external" href="http://json.org/" style="color: rgb(99, 99, 187); text-decoration-line: none;">JSON (JavaScript Object Notation)</a>:</p><ul class="simple" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">JSON is a text serialization format (it outputs unicode text, although most of the time it is then encoded to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">utf-8</span></code>), while pickle is a binary serialization format;</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">JSON is human-readable, while pickle is not;</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">JSON is interoperable and widely used outside of the Python ecosystem, while pickle is Python-specific;</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">JSON, by default, can only represent a subset of the Python built-in types, and no custom classes; pickle can represent an extremely large number of Python types (many of them automatically, by clever usage of Python's introspection facilities; complex cases can be tackled by implementing&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-inst" style="color: rgb(99, 99, 187); text-decoration-line: none;">specific object APIs</a>).</li></ul><div class="admonition seealso" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(255, 255, 204); border: 1px solid rgb(221, 221, 102); border-radius: 3px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">参见</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/json.html#module-json" title="json: Encode and decode the JSON format." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">json</span></code></a>&nbsp;module: a standard library module allowing JSON serialization and deserialization.</p></div><h3 id="blogTitle6">Data stream format</h3><p id="index-1" style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The data format used by&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;is Python-specific. This has the advantage that there are no restrictions imposed by external standards such as JSON or XDR (which can't represent pointer sharing); however it means that non-Python programs may not be able to reconstruct pickled Python objects.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">By default, the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;data format uses a relatively compact binary representation. If you need optimal size characteristics, you can efficiently&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/archiving.html" style="color: rgb(99, 99, 187); text-decoration-line: none;">compress</a>&nbsp;pickled data.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The module&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickletools.html#module-pickletools" title="pickletools: Contains extensive comments about the pickle protocols and pickle-machine opcodes, as well as some useful functions." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickletools</span></code></a>&nbsp;contains tools for analyzing data streams generated by&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>.&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickletools.html#module-pickletools" title="pickletools: Contains extensive comments about the pickle protocols and pickle-machine opcodes, as well as some useful functions." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickletools</span></code></a>&nbsp;source code has extensive comments about opcodes used by pickle protocols.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">There are currently 5 different protocols which can be used for pickling. The higher the protocol used, the more recent the version of Python needed to read the pickle produced.</p><ul class="simple" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Protocol version 0 is the original "human-readable" protocol and is backwards compatible with earlier versions of Python.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Protocol version 1 is an old binary format which is also compatible with earlier versions of Python.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Protocol version 2 was introduced in Python 2.3. It provides much more efficient pickling of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-new-style-class" style="color: rgb(99, 99, 187); text-decoration-line: none;">new-style class</a>es. Refer to&nbsp;<span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0307" style="color: rgb(99, 99, 187); text-decoration-line: none;"><strong>PEP 307</strong></a>&nbsp;for information about improvements brought by protocol 2.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Protocol version 3 was added in Python 3.0. It has explicit support for&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">bytes</span></code></a>&nbsp;objects and cannot be unpickled by Python 2.x. This is the default protocol, and the recommended protocol when compatibility with other Python 3 versions is required.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Protocol version 4 was added in Python 3.4. It adds support for very large objects, pickling more kinds of objects, and some data format optimizations. Refer to&nbsp;<span class="target" id="index-3"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3154" style="color: rgb(99, 99, 187); text-decoration-line: none;"><strong>PEP 3154</strong></a>&nbsp;for information about improvements brought by protocol 4.</li></ul><div class="admonition note" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); border-radius: 3px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">注解</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">Serialization is a more primitive notion than persistence; although&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;reads and writes file objects, it does not handle the issue of naming persistent objects, nor the (even more complicated) issue of concurrent access to persistent objects. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module can transform a complex object into a byte stream and it can transform the byte stream into an object with the same internal structure. Perhaps the most obvious thing to do with these byte streams is to write them onto a file, but it is also conceivable to send them across a network or store them in a database. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/shelve.html#module-shelve" title="shelve: Python object persistence." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">shelve</span></code></a>&nbsp;module provides a simple interface to pickle and unpickle objects on DBM-style database files.</p></div><h2 id="blogTitle7">pickle</h2><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">To serialize an object hierarchy, you simply call the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dumps" title="pickle.dumps" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dumps()</span></code></a>&nbsp;function. Similarly, to de-serialize a data stream, you call the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.loads" title="pickle.loads" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">loads()</span></code></a>&nbsp;function. However, if you want more control over serialization and de-serialization, you can create a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>&nbsp;or an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler" title="pickle.Unpickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Unpickler</span></code></a>&nbsp;object, respectively.</p><h3 style="hyphens: auto; line-height: 22.4px;" id="blogTitle8">constants</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module provides the following constants:</p><h4 id="blogTitle9">HIGHEST_PROTOCOL</h4><dt id="pickle.HIGHEST_PROTOCOL" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">HIGHEST_PROTOCOL</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">An integer, the highest&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-protocols" style="color: rgb(99, 99, 187); text-decoration-line: none;">protocol version</a>&nbsp;available. This value can be passed as a&nbsp;<em>protocol</em>&nbsp;value to functions&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dump" title="pickle.dump" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dump()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dumps" title="pickle.dumps" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dumps()</span></code></a>&nbsp;as well as the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>&nbsp;constructor.</p></dd><h4 id="blogTitle10">DEFAULT_PROTOCOL</h4><dt id="pickle.DEFAULT_PROTOCOL" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">DEFAULT_PROTOCOL</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.DEFAULT_PROTOCOL" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">An integer, the default&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-protocols" style="color: rgb(99, 99, 187); text-decoration-line: none;">protocol version</a>&nbsp;used for pickling. May be less than&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="pickle.HIGHEST_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">HIGHEST_PROTOCOL</span></code></a>. Currently the default protocol is 3, a new protocol designed for Python 3.</p></dd><h3 id="blogTitle11">functions</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module provides the following functions to make the pickling process more convenient:</p><h4 id="blogTitle12">dump</h4><p>该方法实现的是将序列化后的对象 obj 以二进制形式写入文件 file 中，进行保存。它的功能等同于&nbsp; Pickler(file, protocol).dump(obj)。</p><dt id="pickle.dump" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">dump</code><span class="sig-paren" style="font-size: larger;">(</span><em>obj</em>,&nbsp;<em>file</em>,&nbsp;<em>protocol=None</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dump" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Write a pickled representation of&nbsp;<em>obj</em>&nbsp;to the open&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-file-object" style="color: rgb(99, 99, 187); text-decoration-line: none;">file object</a>&nbsp;<em>file</em>. This is equivalent to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler(file,</span>&nbsp;<span class="pre" style="hyphens: none;">protocol).dump(obj)</span></code>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The optional&nbsp;<em>protocol</em>&nbsp;argument, an integer, tells the pickler to use the given protocol; supported protocols are 0 to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="pickle.HIGHEST_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">HIGHEST_PROTOCOL</span></code></a>. If not specified, the default is&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.DEFAULT_PROTOCOL" title="pickle.DEFAULT_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">DEFAULT_PROTOCOL</span></code></a>. If a negative number is specified,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="pickle.HIGHEST_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">HIGHEST_PROTOCOL</span></code></a>&nbsp;is selected.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The&nbsp;<em>file</em>&nbsp;argument must have a write() method that accepts a single bytes argument. It can thus be an on-disk file opened for binary writing, an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/io.html#io.BytesIO" title="io.BytesIO" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">io.BytesIO</span></code></a>&nbsp;instance, or any other custom object that meets this interface.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If&nbsp;<em>fix_imports</em>&nbsp;is true and&nbsp;<em>protocol</em>&nbsp;is less than 3, pickle will try to map the new Python 3 names to the old module names used in Python 2, so that the pickle data stream is readable with Python 2.</p></dd><h4 id="blogTitle13">dumps</h4><p>pickle.dumps() 方法跟 pickle.dump() 方法的区别在于，pickle.dumps() 方法不需要写入文件中，它是直接返回一个序列化的 bytes 对象。</p><dt id="pickle.dumps" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">dumps</code><span class="sig-paren" style="font-size: larger;">(</span><em>obj</em>,&nbsp;<em>protocol=None</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dumps" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Return the pickled representation of the object as a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">bytes</span></code></a>&nbsp;object, instead of writing it to a file.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Arguments&nbsp;<em>protocol</em>&nbsp;and&nbsp;<em>fix_imports</em>&nbsp;have the same meaning as in&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dump" title="pickle.dump" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dump()</span></code></a>.</p></dd><h4 id="blogTitle14">load</h4><div><p>该方法实现的是将序列化的对象从文件file中读取出来。它的功能等同于 Unpickler(file).load()。</p><p>关于参数 file，有一点需要注意，必须是以二进制的形式进行操作（读取）。</p></div><dt id="pickle.load" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">load</code><span class="sig-paren" style="font-size: larger;">(</span><em>file</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em>,&nbsp;<em>encoding="ASCII"</em>,&nbsp;<em>errors="strict"</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.load" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Read a pickled object representation from the open&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/glossary.html#term-file-object" style="color: rgb(99, 99, 187); text-decoration-line: none;">file object</a>&nbsp;<em>file</em>&nbsp;and return the reconstituted object hierarchy specified therein. This is equivalent to&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Unpickler(file).load()</span></code>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The protocol version of the pickle is detected automatically, so no protocol argument is needed. Bytes past the pickled object's representation are ignored.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The argument&nbsp;<em>file</em>&nbsp;must have two methods, a read() method that takes an integer argument, and a readline() method that requires no arguments. Both methods should return bytes. Thus&nbsp;<em>file</em>&nbsp;can be an on-disk file opened for binary reading, an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/io.html#io.BytesIO" title="io.BytesIO" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">io.BytesIO</span></code></a>&nbsp;object, or any other custom object that meets this interface.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Optional keyword arguments are&nbsp;<em>fix_imports</em>,&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>, which are used to control compatibility support for pickle stream generated by Python 2. If&nbsp;<em>fix_imports</em>&nbsp;is true, pickle will try to map the old Python 2 names to the new names used in Python 3. The&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>&nbsp;tell pickle how to decode 8-bit string instances pickled by Python 2; these default to 'ASCII' and 'strict', respectively. The&nbsp;<em>encoding</em>&nbsp;can be 'bytes' to read these 8-bit string instances as bytes objects. Using&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">encoding='latin1'</span></code>&nbsp;is required for unpickling NumPy arrays and instances of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.datetime" title="datetime.datetime" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">datetime</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.date" title="datetime.date" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">date</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.time" title="datetime.time" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">time</span></code></a>&nbsp;pickled by Python 2.</p></dd><h4 id="blogTitle15">loads</h4><p>pickle.loads() 方法跟 pickle.load() 方法的区别在于，pickle.loads() 方法是直接从 bytes 对象中读取序列化的信息，而非从文件中读取。</p><dt id="pickle.loads" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">loads</code><span class="sig-paren" style="font-size: larger;">(</span><em>bytes_object</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em>,&nbsp;<em>encoding="ASCII"</em>,&nbsp;<em>errors="strict"</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.loads" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Read a pickled object hierarchy from a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#bytes" title="bytes" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">bytes</span></code></a>&nbsp;object and return the reconstituted object hierarchy specified therein.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The protocol version of the pickle is detected automatically, so no protocol argument is needed. Bytes past the pickled object's representation are ignored.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Optional keyword arguments are&nbsp;<em>fix_imports</em>,&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>, which are used to control compatibility support for pickle stream generated by Python 2. If&nbsp;<em>fix_imports</em>&nbsp;is true, pickle will try to map the old Python 2 names to the new names used in Python 3. The&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>&nbsp;tell pickle how to decode 8-bit string instances pickled by Python 2; these default to 'ASCII' and 'strict', respectively. The&nbsp;<em>encoding</em>&nbsp;can be 'bytes' to read these 8-bit string instances as bytes objects. Using&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">encoding='latin1'</span></code>&nbsp;is required for unpickling NumPy arrays and instances of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.datetime" title="datetime.datetime" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">datetime</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.date" title="datetime.date" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">date</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/datetime.html#datetime.time" title="datetime.time" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">time</span></code></a>&nbsp;pickled by Python 2.</p></dd><h3 id="blogTitle16">exceptions</h3><div><span style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);">The&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none; font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a><span style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; text-align: justify; background-color: rgb(255, 255, 255);">&nbsp;module defines three exceptions:</span><br></div><h4 id="blogTitle17">PickleError</h4><dt id="pickle.PickleError" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><em class="property">exception&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">PickleError</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.PickleError" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Common base class for the other pickling exceptions. It inherits&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#Exception" title="Exception" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Exception</span></code></a>.</p></dd><h4 id="blogTitle18">PicklingError</h4><dt id="pickle.PicklingError" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><em class="property">exception&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">PicklingError</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.PicklingError" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Error raised when an unpicklable object is encountered by&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>. It inherits&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.PickleError" title="pickle.PickleError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">PickleError</span></code></a>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Refer to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-picklable" style="color: rgb(99, 99, 187); text-decoration-line: none;">What can be pickled and unpickled?</a>&nbsp;to learn what kinds of objects can be pickled.</p></dd><h4 id="blogTitle19">UnpicklingError</h4><dt id="pickle.UnpicklingError" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><em class="property">exception&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">UnpicklingError</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.UnpicklingError" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Error raised when there is a problem unpickling an object, such as a data corruption or a security violation. It inherits&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.PickleError" title="pickle.PickleError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">PickleError</span></code></a>.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Note that other exceptions may also be raised during unpickling, including (but not necessarily limited to) AttributeError, EOFError, ImportError, and IndexError.</p></dd><h3 id="blogTitle20">classes</h3><h4 id="blogTitle21">Pickler</h4><dt id="pickle.Pickler" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Pickler</code><span class="sig-paren" style="font-size: larger;">(</span><em>file</em>,&nbsp;<em>protocol=None</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This takes a binary file for writing a pickle data stream.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The optional&nbsp;<em>protocol</em>&nbsp;argument, an integer, tells the pickler to use the given protocol; supported protocols are 0 to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="pickle.HIGHEST_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">HIGHEST_PROTOCOL</span></code></a>. If not specified, the default is&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.DEFAULT_PROTOCOL" title="pickle.DEFAULT_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">DEFAULT_PROTOCOL</span></code></a>. If a negative number is specified,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.HIGHEST_PROTOCOL" title="pickle.HIGHEST_PROTOCOL" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">HIGHEST_PROTOCOL</span></code></a>&nbsp;is selected.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The&nbsp;<em>file</em>&nbsp;argument must have a write() method that accepts a single bytes argument. It can thus be an on-disk file opened for binary writing, an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/io.html#io.BytesIO" title="io.BytesIO" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">io.BytesIO</span></code></a>&nbsp;instance, or any other custom object that meets this interface.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If&nbsp;<em>fix_imports</em>&nbsp;is true and&nbsp;<em>protocol</em>&nbsp;is less than 3, pickle will try to map the new Python 3 names to the old module names used in Python 2, so that the pickle data stream is readable with Python 2.</p><dl class="method" style="margin-bottom: 15px;"><dt id="pickle.Pickler.dump"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">dump</code><span class="sig-paren" style="font-size: larger;">(</span><em>obj</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.dump" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Write a pickled representation of&nbsp;<em>obj</em>&nbsp;to the open file object given in the constructor.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="pickle.Pickler.persistent_id"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">persistent_id</code><span class="sig-paren" style="font-size: larger;">(</span><em>obj</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.persistent_id" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Do nothing by default. This exists so a subclass can override it.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.persistent_id" title="pickle.Pickler.persistent_id" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_id()</span></code></a>&nbsp;returns&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>,&nbsp;<em>obj</em>&nbsp;is pickled as usual. Any other value causes&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>&nbsp;to emit the returned value as a persistent ID for&nbsp;<em>obj</em>. The meaning of this persistent ID should be defined by&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.persistent_load" title="pickle.Unpickler.persistent_load" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Unpickler.persistent_load()</span></code></a>. Note that the value returned by&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.persistent_id" title="pickle.Pickler.persistent_id" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_id()</span></code></a>&nbsp;cannot itself have a persistent ID.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">See&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-persistent" style="color: rgb(99, 99, 187); text-decoration-line: none;">Persistence of External Objects</a>&nbsp;for details and examples of uses.</p></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><dt id="pickle.Pickler.dispatch_table"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">dispatch_table</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.dispatch_table" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">A pickler object's dispatch table is a registry of&nbsp;<em>reduction functions</em>&nbsp;of the kind which can be declared using&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/copyreg.html#copyreg.pickle" title="copyreg.pickle" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg.pickle()</span></code></a>. It is a mapping whose keys are classes and whose values are reduction functions. A reduction function takes a single argument of the associated class and should conform to the same interface as a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a>method.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">By default, a pickler object will not have a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.dispatch_table" title="pickle.Pickler.dispatch_table" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dispatch_table</span></code></a>&nbsp;attribute, and it will instead use the global dispatch table managed by the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/copyreg.html#module-copyreg" title="copyreg: Register pickle support functions." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg</span></code></a>&nbsp;module. However, to customize the pickling for a specific pickler object one can set the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.dispatch_table" title="pickle.Pickler.dispatch_table" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dispatch_table</span></code></a>&nbsp;attribute to a dict-like object. Alternatively, if a subclass of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>&nbsp;has a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.dispatch_table" title="pickle.Pickler.dispatch_table" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dispatch_table</span></code></a>&nbsp;attribute then this will be used as the default dispatch table for instances of that class.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">See&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-dispatch" style="color: rgb(99, 99, 187); text-decoration-line: none;">Dispatch Tables</a>&nbsp;for usage examples.</p><div class="versionadded"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">3.3 新版功能.</span></p></div></dd></dl><dl class="attribute" style="margin-bottom: 15px;"><dt id="pickle.Pickler.fast"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">fast</code><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.fast" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Deprecated. Enable fast mode if set to a true value. The fast mode disables the usage of memo, therefore speeding the pickling process by not generating superfluous PUT opcodes. It should not be used with self-referential objects, doing otherwise will cause&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Pickler</span></code></a>&nbsp;to recurse infinitely.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Use&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickletools.html#pickletools.optimize" title="pickletools.optimize" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickletools.optimize()</span></code></a>&nbsp;if you need more compact pickles.</p></dd></dl></dd><h4 id="blogTitle22">Unpickler</h4><dt id="pickle.Unpickler" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><em class="property">class&nbsp;</em><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">pickle.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">Unpickler</code><span class="sig-paren" style="font-size: larger;">(</span><em>file</em>,&nbsp;<em>*</em>,&nbsp;<em>fix_imports=True</em>,&nbsp;<em>encoding="ASCII"</em>,&nbsp;<em>errors="strict"</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This takes a binary file for reading a pickle data stream.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The protocol version of the pickle is detected automatically, so no protocol argument is needed.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The argument&nbsp;<em>file</em>&nbsp;must have two methods, a read() method that takes an integer argument, and a readline() method that requires no arguments. Both methods should return bytes. Thus&nbsp;<em>file</em>&nbsp;can be an on-disk file object opened for binary reading, an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/io.html#io.BytesIO" title="io.BytesIO" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">io.BytesIO</span></code></a>&nbsp;object, or any other custom object that meets this interface.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Optional keyword arguments are&nbsp;<em>fix_imports</em>,&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>, which are used to control compatibility support for pickle stream generated by Python 2. If&nbsp;<em>fix_imports</em>&nbsp;is true, pickle will try to map the old Python 2 names to the new names used in Python 3. The&nbsp;<em>encoding</em>&nbsp;and&nbsp;<em>errors</em>&nbsp;tell pickle how to decode 8-bit string instances pickled by Python 2; these default to 'ASCII' and 'strict', respectively. The&nbsp;<em>encoding</em>&nbsp;can be 'bytes' to read these 8-bit string instances as bytes objects.</p><dl class="method" style="margin-bottom: 15px;"><dt id="pickle.Unpickler.load"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">load</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.load" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Read a pickled object representation from the open file object given in the constructor, and return the reconstituted object hierarchy specified therein. Bytes past the pickled object's representation are ignored.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="pickle.Unpickler.persistent_load"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">persistent_load</code><span class="sig-paren" style="font-size: larger;">(</span><em>pid</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.persistent_load" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Raise an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.UnpicklingError" title="pickle.UnpicklingError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">UnpicklingError</span></code></a>&nbsp;by default.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If defined,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.persistent_load" title="pickle.Unpickler.persistent_load" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_load()</span></code></a>&nbsp;should return the object specified by the persistent ID&nbsp;<em>pid</em>. If an invalid persistent ID is encountered, an&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.UnpicklingError" title="pickle.UnpicklingError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">UnpicklingError</span></code></a>&nbsp;should be raised.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">See&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-persistent" style="color: rgb(99, 99, 187); text-decoration-line: none;">Persistence of External Objects</a>&nbsp;for details and examples of uses.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="pickle.Unpickler.find_class"><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">find_class</code><span class="sig-paren" style="font-size: larger;">(</span><em>module</em>,&nbsp;<em>name</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.find_class" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Import&nbsp;<em>module</em>&nbsp;if necessary and return the object called&nbsp;<em>name</em>&nbsp;from it, where the&nbsp;<em>module</em>&nbsp;and&nbsp;<em>name</em>&nbsp;arguments are&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#str" title="str" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">str</span></code></a>&nbsp;objects. Note, unlike its name suggests,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.find_class" title="pickle.Unpickler.find_class" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">find_class()</span></code></a>&nbsp;is also used for finding functions.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Subclasses may override this to gain control over what type of objects and how they can be loaded, potentially reducing security risks. Refer to&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-restrict" style="color: rgb(99, 99, 187); text-decoration-line: none;">Restricting Globals</a>&nbsp;for details.</p></dd></dl></dd><h3 id="blogTitle23">What can be pickled and unpickled?</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The following types can be pickled:</p><ul class="simple" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;"><code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>,&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">True</span></code>, and&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">False</span></code></li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">integers, floating point numbers, complex numbers</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">strings, bytes, bytearrays</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">tuples, lists, sets, and dictionaries containing only picklable objects</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">functions defined at the top level of a module (using&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/compound_stmts.html#def" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref std std-keyword docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">def</span></code></a>, not&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/expressions.html#lambda" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref std std-keyword docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">lambda</span></code></a>)</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">built-in functions defined at the top level of a module</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">classes that are defined at the top level of a module</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">instances of such classes whose&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#object.__dict__" title="object.__dict__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__dict__</span></code></a>&nbsp;or the result of calling&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>&nbsp;is picklable (see section&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-inst" style="color: rgb(99, 99, 187); text-decoration-line: none;">Pickling Class Instances</a>&nbsp;for details).</li></ul><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Attempts to pickle unpicklable objects will raise the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.PicklingError" title="pickle.PicklingError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">PicklingError</span></code></a>&nbsp;exception; when this happens, an unspecified number of bytes may have already been written to the underlying file. Trying to pickle a highly recursive data structure may exceed the maximum recursion depth, a&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/exceptions.html#RecursionError" title="RecursionError" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-exc docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">RecursionError</span></code></a>&nbsp;will be raised in this case. You can carefully raise this limit with<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/sys.html#sys.setrecursionlimit" title="sys.setrecursionlimit" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">sys.setrecursionlimit()</span></code></a>.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Note that functions (built-in and user-defined) are pickled by "fully qualified" name reference, not by value.&nbsp;<a class="footnote-reference" href="https://docs.python.org/zh-cn/3/library/pickle.html#id7" id="id2" style="color: rgb(99, 99, 187); text-decoration-line: none;">[2]</a>&nbsp;This means that only the function name is pickled, along with the name of the module the function is defined in. Neither the function's code, nor any of its function attributes are pickled. Thus the defining module must be importable in the unpickling environment, and the module must contain the named object, otherwise an exception will be raised.&nbsp;<a class="footnote-reference" href="https://docs.python.org/zh-cn/3/library/pickle.html#id8" id="id3" style="color: rgb(99, 99, 187); text-decoration-line: none;">[3]</a></p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Similarly, classes are pickled by named reference, so the same restrictions in the unpickling environment apply. Note that none of the class's code or data is pickled, so in the following example the class attribute&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">attr</span></code>&nbsp;is not restored in the unpickling environment:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">Foo</span><span class="p">:</span>
    <span class="n">attr</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="s1" style="color: rgb(64, 112, 160);">'A class attribute'</span>

<span class="n">picklestring</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">These restrictions are why picklable functions and classes must be defined in the top level of a module.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Similarly, when class instances are pickled, their class's code and data are not pickled along with them. Only the instance data are pickled. This is done on purpose, so you can fix bugs in a class or add methods to the class and still load objects that were created with an earlier version of the class. If you plan to have long-lived objects that will see many versions of a class, it may be worthwhile to put a version number in the objects so that suitable conversions can be made by the class's&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>&nbsp;method.</p><h3 id="blogTitle24">Pickling Class Instances</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">In this section, we describe the general mechanisms available to you to define, customize, and control how class instances are pickled and unpickled.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">In most cases, no additional code is needed to make instances picklable. By default, pickle will retrieve the class and the attributes of an instance via introspection. When a class instance is unpickled, its&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__init__" title="object.__init__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__init__()</span></code></a>&nbsp;method is usually&nbsp;<em>not</em>&nbsp;invoked. The default behaviour first creates an uninitialized instance and then restores the saved attributes. The following code shows an implementation of this behaviour:</p><div class="highlight-python3 notranslate" style="position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">save</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="p">(</span><span class="n">obj</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="vm" style="color: rgb(187, 96, 213);">__class__</span><span class="p">,</span> <span class="n">obj</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="vm" style="color: rgb(187, 96, 213);">__dict__</span><span class="p">)</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">load</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">cls</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="bp" style="color: rgb(0, 112, 32);">cls</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="fm" style="color: rgb(6, 40, 126);">__new__</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">cls</span><span class="p">)</span>
    <span class="n">obj</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="vm" style="color: rgb(187, 96, 213);">__dict__</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="n">obj</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">Classes can alter the default behaviour by providing one or several special methods:</p><dl class="method" style="margin-bottom: 15px;"><dt id="object.__getnewargs_ex__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__getnewargs_ex__</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">In protocols 2 and newer, classes that implements the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>&nbsp;method can dictate the values passed to the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__new__" title="object.__new__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__new__()</span></code></a>&nbsp;method upon unpickling. The method must return a pair&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">(args,</span>&nbsp;<span class="pre" style="hyphens: none;">kwargs)</span></code>&nbsp;where&nbsp;<em>args</em>&nbsp;is a tuple of positional arguments and&nbsp;<em>kwargs</em>&nbsp;a dictionary of named arguments for constructing the object. Those will be passed to the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__new__" title="object.__new__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__new__()</span></code></a>&nbsp;method upon unpickling.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">You should implement this method if the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__new__" title="object.__new__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__new__()</span></code></a>&nbsp;method of your class requires keyword-only arguments. Otherwise, it is recommended for compatibility to implement&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs__" title="object.__getnewargs__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs__()</span></code></a>.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.6 版更改:&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>&nbsp;is now used in protocols 2 and 3.</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="object.__getnewargs__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__getnewargs__</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">This method serves a similar purpose as&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>, but supports only positional arguments. It must return a tuple of arguments&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">args</span></code>&nbsp;which will be passed to the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__new__" title="object.__new__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__new__()</span></code></a>&nbsp;method upon unpickling.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs__" title="object.__getnewargs__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs__()</span></code></a>&nbsp;will not be called if&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>&nbsp;is defined.</p><div class="versionchanged"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;"><span class="versionmodified" style="font-style: italic;">在 3.6 版更改:&nbsp;</span>Before Python 3.6,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs__" title="object.__getnewargs__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs__()</span></code></a>&nbsp;was called instead of<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>&nbsp;in protocols 2 and 3.</p></div></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="object.__getstate__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__getstate__</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Classes can further influence how their instances are pickled; if the class defines the method&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>, it is called and the returned object is pickled as the contents for the instance, instead of the contents of the instance's dictionary. If the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>method is absent, the instance's&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#object.__dict__" title="object.__dict__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__dict__</span></code></a>&nbsp;is pickled as usual.</p></dd></dl><dl class="method" style="margin-bottom: 15px;"><dt id="object.__setstate__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__setstate__</code><span class="sig-paren" style="font-size: larger;">(</span><em>state</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">Upon unpickling, if the class defines&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>, it is called with the unpickled state. In that case, there is no requirement for the state object to be a dictionary. Otherwise, the pickled state must be a dictionary and its items are assigned to the new instance's dictionary.</p><div class="admonition note" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); border-radius: 3px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; line-height: 22.4px;">注解</p>&nbsp;<p class="last" style="margin-top: 0px; hyphens: auto; line-height: 22.4px; margin-bottom: 5px; display: inline;">If&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>&nbsp;returns a false value, the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>&nbsp;method will not be called upon unpickling.</p></div></dd></dl><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">Refer to the section&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle-state" style="color: rgb(99, 99, 187); text-decoration-line: none;">Handling Stateful Objects</a>&nbsp;for more information about how to use the methods&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>.</p><div class="admonition note" style="margin-top: 10px; margin-bottom: 10px; padding: 7px; background-color: rgb(238, 238, 238); border: 1px solid rgb(204, 204, 204); border-radius: 3px;"><p class="first admonition-title" style="margin: 0px 10px 5px 0px; font-weight: bold; display: inline; hyphens: auto; text-align: justify; line-height: 22.4px;">注解</p>&nbsp;<p class="last" style="hyphens: auto; text-align: justify; line-height: 22.4px; margin-bottom: 5px; display: inline;">At unpickling time, some methods like&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__getattr__" title="object.__getattr__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getattr__()</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__getattribute__" title="object.__getattribute__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getattribute__()</span></code></a>, or<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__setattr__" title="object.__setattr__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setattr__()</span></code></a>&nbsp;may be called upon the instance. In case those methods rely on some internal invariant being true, the type should implement&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs__" title="object.__getnewargs__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs__()</span></code></a>&nbsp;or<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>&nbsp;to establish such an invariant; otherwise, neither&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__new__" title="object.__new__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__new__()</span></code></a>&nbsp;nor<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__init__" title="object.__init__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background: rgb(214, 214, 214); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__init__()</span></code></a>&nbsp;will be called.</p></div><p id="index-4" style="hyphens: auto; text-align: justify; line-height: 22.4px;">As we shall see, pickle does not use directly the methods described above. In fact, these methods are part of the copy protocol which implements the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a>&nbsp;special method. The copy protocol provides a unified interface for retrieving the data necessary for pickling and copying objects.&nbsp;<a class="footnote-reference" href="https://docs.python.org/zh-cn/3/library/pickle.html#id9" id="id4" style="color: rgb(99, 99, 187); text-decoration-line: none;">[4]</a></p><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">Although powerful, implementing&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a>&nbsp;directly in your classes is error prone. For this reason, class designers should use the high-level interface (i.e.,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getnewargs_ex__" title="object.__getnewargs_ex__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getnewargs_ex__()</span></code></a>,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>) whenever possible. We will show, however, cases where using&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a>&nbsp;is the only option or leads to more efficient pickling or both.</p><dl class="method" style="margin-bottom: 15px;"><dt id="object.__reduce__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__reduce__</code><span class="sig-paren" style="font-size: larger;">(</span><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration-line: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">The interface is currently defined as follows. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a>&nbsp;method takes no argument and shall return either a string or preferably a tuple (the returned object is often referred to as the "reduce value").</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">If a string is returned, the string should be interpreted as the name of a global variable. It should be the object's local name relative to its module; the pickle module searches the module namespace to determine the object's module. This behaviour is typically useful for singletons.</p><p style="margin-top: 0px; hyphens: auto; line-height: 22.4px;">When a tuple is returned, it must be between two and five items long. Optional items can either be omitted, or&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;can be provided as their value. The semantics of each item are in order:</p><ul class="simple" style="margin-bottom: 10px;"><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">A callable object that will be called to create the initial version of the object.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">A tuple of arguments for the callable object. An empty tuple must be given if the callable does not accept any argument.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Optionally, the object's state, which will be passed to the object's&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>method as previously described. If the object has no such method then, the value must be a dictionary and it will be added to the object's&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#object.__dict__" title="object.__dict__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-attr docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__dict__</span></code></a>&nbsp;attribute.</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Optionally, an iterator (and not a sequence) yielding successive items. These items will be appended to the object either using&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">obj.append(item)</span></code>&nbsp;or, in batch, using&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">obj.extend(list_of_items)</span></code>. This is primarily used for list subclasses, but may be used by other classes as long as they have&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">append()</span></code>&nbsp;and&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">extend()</span></code>&nbsp;methods with the appropriate signature. (Whether&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">append()</span></code>&nbsp;or&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">extend()</span></code>&nbsp;is used depends on which pickle protocol version is used as well as the number of items to append, so both must be supported.)</li><li style="hyphens: auto; text-align: justify; line-height: 20.8px;">Optionally, an iterator (not a sequence) yielding successive key-value pairs. These items will be stored to the object using&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">obj[key]</span>&nbsp;<span class="pre" style="hyphens: none;">=</span>&nbsp;<span class="pre" style="hyphens: none;">value</span></code>. This is primarily used for dictionary subclasses, but may be used by other classes as long as they implement&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/reference/datamodel.html#object.__setitem__" title="object.__setitem__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setitem__()</span></code></a>.</li></ul></dd></dl><p></p><div class="section" id="persistence-of-external-objects"><span id="pickle-persistent" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);"></span></div><p></p><dl class="method" style="margin-bottom: 15px;"><dt id="object.__reduce_ex__"><code class="descclassname" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;">object.</code><code class="descname" style="background-color: transparent; padding: 0px 1px; font-size: 19.2px; font-family: monospace, sans-serif; font-weight: bold; border-radius: 3px;">__reduce_ex__</code><span class="sig-paren" style="font-size: larger;">(</span><em>protocol</em><span class="sig-paren" style="font-size: larger;">)</span><a class="headerlink" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce_ex__" title="永久链接至目标" style="color: rgb(99, 99, 187); text-decoration: none; visibility: hidden; font-size: 0.8em; padding: 0px 4px;"></a></dt><dd style="margin-top: 3px; margin-bottom: 10px; margin-left: 30px; hyphens: auto; text-align: justify; line-height: 20.8px;"><p style="margin-top: 0px; hyphens: auto; text-align: justify; line-height: 22.4px;">Alternatively, a<span>&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce_ex__" title="object.__reduce_ex__" style="color: rgb(99, 99, 187); text-decoration: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; font-weight: normal; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce_ex__()</span></code></a><span>&nbsp;</span>method may be defined. The only difference is this method should take a single integer argument, the protocol version. When defined, pickle will prefer it over the<span>&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; font-weight: normal; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a><span>&nbsp;</span>method. In addition,<span>&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__reduce__" title="object.__reduce__" style="color: rgb(99, 99, 187); text-decoration: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; font-weight: normal; border-radius: 3px;"><span class="pre" style="hyphens: none;">__reduce__()</span></code></a><span>&nbsp;</span>automatically becomes a synonym for the extended version. The main use for this method is to provide backwards-compatible reduce values for older Python releases.</p></dd></dl><h3 id="blogTitle25">Persistence of External Objects</h3><p id="index-5" style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">For the benefit of object persistence, the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module supports the notion of a reference to an object outside the pickled data stream. Such objects are referenced by a persistent ID, which should be either a string of alphanumeric characters (for protocol 0)&nbsp;<a class="footnote-reference" href="https://docs.python.org/zh-cn/3/library/pickle.html#id10" id="id5" style="color: rgb(99, 99, 187); text-decoration-line: none;">[5]</a>&nbsp;or just an arbitrary object (for any newer protocol).</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The resolution of such persistent IDs is not defined by the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a>&nbsp;module; it will delegate this resolution to the user defined methods on the pickler and unpickler,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.persistent_id" title="pickle.Pickler.persistent_id" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_id()</span></code></a>&nbsp;and<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.persistent_load" title="pickle.Unpickler.persistent_load" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_load()</span></code></a>&nbsp;respectively.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">To pickle objects that have an external persistent id, the pickler must have a custom&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler.persistent_id" title="pickle.Pickler.persistent_id" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_id()</span></code></a>&nbsp;method that takes an object as an argument and returns either&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;or the persistent id for that object. When&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">None</span></code>&nbsp;is returned, the pickler simply pickles the object as normal. When a persistent ID string is returned, the pickler will pickle that object, along with a marker so that the unpickler will recognize it as a persistent ID.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">To unpickle external objects, the unpickler must have a custom&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.persistent_load" title="pickle.Unpickler.persistent_load" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">persistent_load()</span></code></a>&nbsp;method that takes a persistent ID object and returns the referenced object.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Here is a comprehensive example presenting how persistent ID can be used to pickle external objects by reference.</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Simple example presenting how persistent ID can be used to pickle</span>
<span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># external objects by reference.</span>

<span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pickle</span>
<span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">sqlite3</span>
<span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">from</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">collections</span> <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="n">namedtuple</span>

<span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Simple class representing a record in our database.</span>
<span class="n">MemoRecord</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"MemoRecord"</span><span class="p">,</span> <span class="s2" style="color: rgb(64, 112, 160);">"key, task"</span><span class="p">)</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">DBPickler</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Pickler</span><span class="p">):</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">persistent_id</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Instead of pickling MemoRecord as a regular class instance, we emit a</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># persistent ID.</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="nb" style="color: rgb(0, 112, 32);">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">MemoRecord</span><span class="p">):</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Here, our persistent ID is simply a tuple, containing a tag and a</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># key, which refers to a specific record in the database.</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"MemoRecord"</span><span class="p">,</span> <span class="n">obj</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">else</span><span class="p">:</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># If obj does not have a persistent ID, return None. This means obj</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># needs to be pickled as usual.</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">None</span>


<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">DBUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Unpickler</span><span class="p">):</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">__init__</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="nb" style="color: rgb(0, 112, 32);">super</span><span class="p">()</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="fm" style="color: rgb(6, 40, 126);">__init__</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">connection</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">connection</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">persistent_load</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># This method is invoked whenever a persistent ID is encountered.</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Here, pid is the tuple returned by DBPickler.</span>
        <span class="n">cursor</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">connection</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">type_tag</span><span class="p">,</span> <span class="n">key_id</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pid</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="n">type_tag</span> <span class="o" style="color: rgb(102, 102, 102);">==</span> <span class="s2" style="color: rgb(64, 112, 160);">"MemoRecord"</span><span class="p">:</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Fetch the referenced record from the database and return it.</span>
            <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">execute</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"SELECT * FROM memos WHERE key=?"</span><span class="p">,</span> <span class="p">(</span><span class="nb" style="color: rgb(0, 112, 32);">str</span><span class="p">(</span><span class="n">key_id</span><span class="p">),))</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">task</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="n">MemoRecord</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">else</span><span class="p">:</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Always raises an error if you cannot return the correct object.</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Otherwise, the unpickler will think None is the object referenced</span>
            <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># by the persistent ID.</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">raise</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">UnpicklingError</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"unsupported persistent object"</span><span class="p">)</span>


<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">main</span><span class="p">():</span>
    <span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">io</span>
    <span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pprint</span>

    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Initialize and populate our database.</span>
    <span class="n">conn</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">sqlite3</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">connect</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">":memory:"</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">conn</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">execute</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"CREATE TABLE memos(key INTEGER PRIMARY KEY, task TEXT)"</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="p">(</span>
        <span class="s1" style="color: rgb(64, 112, 160);">'give food to fish'</span><span class="p">,</span>
        <span class="s1" style="color: rgb(64, 112, 160);">'prepare group meeting'</span><span class="p">,</span>
        <span class="s1" style="color: rgb(64, 112, 160);">'fight with a zebra'</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">for</span> <span class="n">task</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">in</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">execute</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"INSERT INTO memos VALUES(NULL, ?)"</span><span class="p">,</span> <span class="p">(</span><span class="n">task</span><span class="p">,))</span>

    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Fetch the records to be pickled.</span>
    <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">execute</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"SELECT * FROM memos"</span><span class="p">)</span>
    <span class="n">memos</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="p">[</span><span class="n">MemoRecord</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span> <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">task</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">in</span> <span class="n">cursor</span><span class="p">]</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Save the records using our custom DBPickler.</span>
    <span class="n">file</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">io</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">DBPickler</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dump</span><span class="p">(</span><span class="n">memos</span><span class="p">)</span>

    <span class="nb" style="color: rgb(0, 112, 32);">print</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"Pickled records:"</span><span class="p">)</span>
    <span class="n">pprint</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">memos</span><span class="p">)</span>

    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Update a record, just for good measure.</span>
    <span class="n">cursor</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">execute</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"UPDATE memos SET task='learn italian' WHERE key=1"</span><span class="p">)</span>

    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Load the records from the pickle data stream.</span>
    <span class="n">file</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">seek</span><span class="p">(</span><span class="mi" style="color: rgb(32, 128, 80);">0</span><span class="p">)</span>
    <span class="n">memos</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">DBUnpickler</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">load</span><span class="p">()</span>

    <span class="nb" style="color: rgb(0, 112, 32);">print</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"Unpickled records:"</span><span class="p">)</span>
    <span class="n">pprint</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">memos</span><span class="p">)</span>


<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="vm" style="color: rgb(187, 96, 213);">__name__</span> <span class="o" style="color: rgb(102, 102, 102);">==</span> <span class="s1" style="color: rgb(64, 112, 160);">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></pre></div></div><h3 id="blogTitle26">Dispatch Tables</h3><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">If one wants to customize pickling of some classes without disturbing any other code which depends on pickling, then one can create a pickler with a private dispatch table.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The global dispatch table managed by the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/copyreg.html#module-copyreg" title="copyreg: Register pickle support functions." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg</span></code></a>&nbsp;module is available as&nbsp;<code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg.dispatch_table</span></code>. Therefore, one may choose to use a modified copy of&nbsp;<code class="xref py py-data docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg.dispatch_table</span></code>&nbsp;as a private dispatch table.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">For example</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">f</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">io</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">p</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Pickler</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">p</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dispatch_table</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">copyreg</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dispatch_table</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dispatch_table</span><span class="p">[</span><span class="n">SomeClass</span><span class="p">]</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">reduce_SomeClass</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">creates an instance of&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Pickler" title="pickle.Pickler" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle.Pickler</span></code></a>&nbsp;with a private dispatch table which handles the&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">SomeClass</span></code>&nbsp;class specially. Alternatively, the code</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">MyPickler</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Pickler</span><span class="p">):</span>
    <span class="n">dispatch_table</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">copyreg</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dispatch_table</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dispatch_table</span><span class="p">[</span><span class="n">SomeClass</span><span class="p">]</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">reduce_SomeClass</span>
<span class="n">f</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">io</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">p</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">MyPickler</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">does the same, but all instances of&nbsp;<code class="docutils literal notranslate" style="background-color: rgb(236, 240, 243); padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">MyPickler</span></code>&nbsp;will by default share the same dispatch table. The equivalent code using the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/copyreg.html#module-copyreg" title="copyreg: Register pickle support functions." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">copyreg</span></code></a>&nbsp;module is</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="n">copyreg</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">pickle</span><span class="p">(</span><span class="n">SomeClass</span><span class="p">,</span> <span class="n">reduce_SomeClass</span><span class="p">)</span>
<span class="n">f</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">io</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="n">p</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Pickler</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></pre></div></div><h3 id="blogTitle27">Handling Stateful Objects</h3><p id="index-6" style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Here's an example that shows how to modify pickling behavior for a class. The&nbsp;<code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">TextReader</span></code>class opens a text file, and returns the line number and line contents each time its&nbsp;<code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">readline()</span></code>method is called. If a&nbsp;<code class="xref py py-class docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">TextReader</span></code>&nbsp;instance is pickled, all attributes&nbsp;<em>except</em>&nbsp;the file object member are saved. When the instance is unpickled, the file is reopened, and reading resumes from the last location. The&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__setstate__" title="object.__setstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__setstate__()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#object.__getstate__" title="object.__getstate__" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">__getstate__()</span></code></a>&nbsp;methods are used to implement this behavior.</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">TextReader</span><span class="p">:</span>
    <span class="sd" style="color: rgb(64, 112, 160); font-style: italic;">"""Print and number lines in a text file."""</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">__init__</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">filename</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">filename</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">file</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="nb" style="color: rgb(0, 112, 32);">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">lineno</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="mi" style="color: rgb(32, 128, 80);">0</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">readline</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">):</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">lineno</span> <span class="o" style="color: rgb(102, 102, 102);">+=</span> <span class="mi" style="color: rgb(32, 128, 80);">1</span>
        <span class="n">line</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">file</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">None</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="n">line</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1" style="color: rgb(64, 112, 160);">'</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s1" style="color: rgb(64, 112, 160);">'</span><span class="p">):</span>
            <span class="n">line</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">line</span><span class="p">[:</span><span class="o" style="color: rgb(102, 102, 102);">-</span><span class="mi" style="color: rgb(32, 128, 80);">1</span><span class="p">]</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="s2" style="color: rgb(64, 112, 160);">"</span><span class="si" style="color: rgb(112, 160, 208); font-style: italic;">%i</span><span class="s2" style="color: rgb(64, 112, 160);">: </span><span class="si" style="color: rgb(112, 160, 208); font-style: italic;">%s</span><span class="s2" style="color: rgb(64, 112, 160);">"</span> <span class="o" style="color: rgb(102, 102, 102);">%</span> <span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">__getstate__</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">):</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Copy the object's state from self.__dict__ which contains</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># all our instance attributes. Always use the dict.copy()</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># method to avoid modifying the original state.</span>
        <span class="n">state</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="vm" style="color: rgb(187, 96, 213);">__dict__</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Remove the unpicklable entries.</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">del</span> <span class="n">state</span><span class="p">[</span><span class="s1" style="color: rgb(64, 112, 160);">'file'</span><span class="p">]</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="n">state</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">__setstate__</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Restore instance attributes (i.e., filename and lineno).</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="vm" style="color: rgb(187, 96, 213);">__dict__</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Restore the previously opened file's state. To do so, we need to</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># reopen it and read from it until the line count is restored.</span>
        <span class="n">file</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="nb" style="color: rgb(0, 112, 32);">open</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">for</span> <span class="n">_</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">in</span> <span class="nb" style="color: rgb(0, 112, 32);">range</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">lineno</span><span class="p">):</span>
            <span class="n">file</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Finally, save the file.</span>
        <span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">file</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">file</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">A sample usage might be something like this:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><span class="copybutton" title="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(170, 204, 153); border-style: solid; border-width: 1px; color: rgb(170, 204, 153); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; border-radius: 0px 3px 0px 0px;">&gt;&gt;&gt;</span><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">TextReader</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"hello.txt"</span><span class="p">)</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">reader</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">readline</span><span class="p">()</span>
<span class="go">'1: Hello world!'</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">reader</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">readline</span><span class="p">()</span>
<span class="go">'2: I am line number two.'</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">new_reader</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">new_reader</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">readline</span><span class="p">()</span>
<span class="go">'3: Goodbye!'</span></pre></div></div><h3 id="blogTitle28">Restricting Globals</h3><p id="index-7" style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">By default, unpickling will import any class or function that it finds in the pickle data. For many applications, this behaviour is unacceptable as it permits the unpickler to import and invoke arbitrary code. Just consider what this hand-crafted pickle data stream does when loaded:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><span class="copybutton" title="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(170, 204, 153); border-style: solid; border-width: 1px; color: rgb(170, 204, 153); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; border-radius: 0px 3px 0px 0px;">&gt;&gt;&gt;</span><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pickle</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">loads</span><span class="p">(</span><span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s2" style="color: rgb(64, 112, 160);">"cos</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">system</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">(S'echo hello world'</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">tR."</span><span class="p">)</span>
<span class="go">hello world</span>
<span class="go">0</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">In this example, the unpickler imports the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/os.html#os.system" title="os.system" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">os.system()</span></code></a>&nbsp;function and then apply the string argument "echo hello world". Although this example is inoffensive, it is not difficult to imagine one that could damage your system.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">For this reason, you may want to control what gets unpickled by customizing<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.find_class" title="pickle.Unpickler.find_class" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Unpickler.find_class()</span></code></a>. Unlike its name suggests,&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.Unpickler.find_class" title="pickle.Unpickler.find_class" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-meth docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">Unpickler.find_class()</span></code></a>&nbsp;is called whenever a global (i.e., a class or a function) is requested. Thus it is possible to either completely forbid globals or restrict them to a safe subset.</p><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">Here is an example of an unpickler allowing only few safe classes from the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/builtins.html#module-builtins" title="builtins: The module that provides the built-in namespace." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">builtins</span></code></a>&nbsp;module to be loaded:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">builtins</span>
<span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">io</span>
<span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pickle</span>

<span class="n">safe_builtins</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="p">{</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'range'</span><span class="p">,</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'complex'</span><span class="p">,</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'set'</span><span class="p">,</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'frozenset'</span><span class="p">,</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'slice'</span><span class="p">,</span>
<span class="p">}</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">class</span> <span class="nc" style="color: rgb(14, 132, 181); font-weight: bold;">RestrictedUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">Unpickler</span><span class="p">):</span>

    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">find_class</span><span class="p">(</span><span class="bp" style="color: rgb(0, 112, 32);">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Only allow safe classes from builtins.</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">if</span> <span class="n">module</span> <span class="o" style="color: rgb(102, 102, 102);">==</span> <span class="s2" style="color: rgb(64, 112, 160);">"builtins"</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">and</span> <span class="n">name</span> <span class="ow" style="color: rgb(0, 112, 32); font-weight: bold;">in</span> <span class="n">safe_builtins</span><span class="p">:</span>
            <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="nb" style="color: rgb(0, 112, 32);">getattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Forbid everything else.</span>
        <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">raise</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">UnpicklingError</span><span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"global '</span><span class="si" style="color: rgb(112, 160, 208); font-style: italic;">%s</span><span class="s2" style="color: rgb(64, 112, 160);">.</span><span class="si" style="color: rgb(112, 160, 208); font-style: italic;">%s</span><span class="s2" style="color: rgb(64, 112, 160);">' is forbidden"</span> <span class="o" style="color: rgb(102, 102, 102);">%</span>
                                     <span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">def</span> <span class="nf" style="color: rgb(6, 40, 126);">restricted_loads</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd" style="color: rgb(64, 112, 160); font-style: italic;">"""Helper function analogous to pickle.loads()."""</span>
    <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">return</span> <span class="n">RestrictedUnpickler</span><span class="p">(</span><span class="n">io</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">load</span><span class="p">()</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">A sample usage of our unpickler working has intended:</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><span class="copybutton" title="Hide the prompts and output" style="cursor: pointer; position: absolute; top: 0px; right: 0px; border-color: rgb(170, 204, 153); border-style: solid; border-width: 1px; color: rgb(170, 204, 153); font-family: monospace; padding-left: 0.2em; padding-right: 0.2em; border-radius: 0px 3px 0px 0px;">&gt;&gt;&gt;</span><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">restricted_loads</span><span class="p">(</span><span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dumps</span><span class="p">([</span><span class="mi" style="color: rgb(32, 128, 80);">1</span><span class="p">,</span> <span class="mi" style="color: rgb(32, 128, 80);">2</span><span class="p">,</span> <span class="nb" style="color: rgb(0, 112, 32);">range</span><span class="p">(</span><span class="mi" style="color: rgb(32, 128, 80);">15</span><span class="p">)]))</span>
<span class="go">[1, 2, range(0, 15)]</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">restricted_loads</span><span class="p">(</span><span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s2" style="color: rgb(64, 112, 160);">"cos</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">system</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">(S'echo hello world'</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s2" style="color: rgb(64, 112, 160);">tR."</span><span class="p">)</span>
<span class="gt" style="color: rgb(0, 68, 221);">Traceback (most recent call last):</span>
  <span class="c" style="color: rgb(64, 128, 144); font-style: italic;">...</span>
<span class="gr" style="color: rgb(255, 0, 0);">pickle.UnpicklingError</span>: <span class="n">global 'os.system' is forbidden</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">&gt;&gt;&gt; </span><span class="n">restricted_loads</span><span class="p">(</span><span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s1" style="color: rgb(64, 112, 160);">'cbuiltins</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s1" style="color: rgb(64, 112, 160);">eval</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\n</span><span class="s1" style="color: rgb(64, 112, 160);">'</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">... </span>                 <span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s1" style="color: rgb(64, 112, 160);">'(S</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\'</span><span class="s1" style="color: rgb(64, 112, 160);">getattr(__import__("os"), "system")'</span>
<span class="gp" style="color: rgb(198, 93, 9); font-weight: bold;">... </span>                 <span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s1" style="color: rgb(64, 112, 160);">'("echo hello world")</span><span class="se" style="color: rgb(64, 112, 160); font-weight: bold;">\'\n</span><span class="s1" style="color: rgb(64, 112, 160);">tR.'</span><span class="p">)</span>
<span class="gt" style="color: rgb(0, 68, 221);">Traceback (most recent call last):</span>
  <span class="c" style="color: rgb(64, 128, 144); font-style: italic;">...</span>
<span class="gr" style="color: rgb(255, 0, 0);">pickle.UnpicklingError</span>: <span class="n">global 'builtins.eval' is forbidden</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">As our examples shows, you have to be careful with what you allow to be unpickled. Therefore if security is a concern, you may want to consider alternatives such as the marshalling API in&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/xmlrpc.client.html#module-xmlrpc.client" title="xmlrpc.client: XML-RPC client access." style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">xmlrpc.client</span></code></a>&nbsp;or third-party solutions.</p><h3 id="blogTitle29">Performance</h3><p></p><div class="section" id="examples"><span id="pickle-example" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"></span></div><p></p><div class="section" id="performance"><p style="hyphens: auto; text-align: justify; line-height: 22.4px;">Recent versions of the pickle protocol (from protocol 2 and upwards) feature efficient binary encodings for several common features and built-in types. Also, the<span>&nbsp;</span><a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back." style="color: rgb(99, 99, 187); text-decoration: none;"><code class="xref py py-mod docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; font-weight: normal; border-radius: 3px;"><span class="pre" style="hyphens: none;">pickle</span></code></a><span>&nbsp;</span>module has a transparent optimizer written in C.</p></div><h2 id="blogTitle30">示例</h2><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">For the simplest code, use the&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.dump" title="pickle.dump" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">dump()</span></code></a>&nbsp;and&nbsp;<a class="reference internal" href="https://docs.python.org/zh-cn/3/library/pickle.html#pickle.load" title="pickle.load" style="color: rgb(99, 99, 187); text-decoration-line: none;"><code class="xref py py-func docutils literal notranslate" style="background-color: transparent; padding: 0px 1px; font-size: 15.44px; font-family: monospace, sans-serif; border-radius: 3px;"><span class="pre" style="hyphens: none;">load()</span></code></a>&nbsp;functions.</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pickle</span>

<span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># An arbitrary collection of objects supported by pickle.</span>
<span class="n">data</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="p">{</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'a'</span><span class="p">:</span> <span class="p">[</span><span class="mi" style="color: rgb(32, 128, 80);">1</span><span class="p">,</span> <span class="mf" style="color: rgb(32, 128, 80);">2.0</span><span class="p">,</span> <span class="mi" style="color: rgb(32, 128, 80);">3</span><span class="p">,</span> <span class="mi" style="color: rgb(32, 128, 80);">4</span><span class="o" style="color: rgb(102, 102, 102);">+</span><span class="mi" style="color: rgb(32, 128, 80);">6</span><span class="n">j</span><span class="p">],</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'b'</span><span class="p">:</span> <span class="p">(</span><span class="s2" style="color: rgb(64, 112, 160);">"character string"</span><span class="p">,</span> <span class="sa" style="color: rgb(64, 112, 160);">b</span><span class="s2" style="color: rgb(64, 112, 160);">"byte string"</span><span class="p">),</span>
    <span class="s1" style="color: rgb(64, 112, 160);">'c'</span><span class="p">:</span> <span class="p">{</span><span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">None</span><span class="p">,</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">True</span><span class="p">,</span> <span class="kc" style="color: rgb(0, 112, 32); font-weight: bold;">False</span><span class="p">}</span>
<span class="p">}</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="nb" style="color: rgb(0, 112, 32);">open</span><span class="p">(</span><span class="s1" style="color: rgb(64, 112, 160);">'data.pickle'</span><span class="p">,</span> <span class="s1" style="color: rgb(64, 112, 160);">'wb'</span><span class="p">)</span> <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># Pickle the 'data' dictionary using the highest protocol available.</span>
    <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</pre></div></div><p style="hyphens: auto; text-align: justify; line-height: 22.4px; color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255);">The following example reads the resulting pickled data.</p><div class="highlight-python3 notranslate" style="color: rgb(34, 34, 34); font-family: &quot;Lucida Grande&quot;, Arial, sans-serif; font-size: 16px; background-color: rgb(255, 255, 255); position: relative;"><div class="highlight" style="background: rgb(238, 255, 204);"><pre style="overflow-y: hidden; padding: 5px; background-color: rgb(238, 255, 204); color: rgb(51, 51, 51); line-height: 18.528px; border: 1px solid rgb(170, 204, 153); font-family: monospace, sans-serif; font-size: 15.44px;"><span class="kn" style="color: rgb(0, 112, 32); font-weight: bold;">import</span> <span class="nn" style="color: rgb(14, 132, 181); font-weight: bold;">pickle</span>

<span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">with</span> <span class="nb" style="color: rgb(0, 112, 32);">open</span><span class="p">(</span><span class="s1" style="color: rgb(64, 112, 160);">'data.pickle'</span><span class="p">,</span> <span class="s1" style="color: rgb(64, 112, 160);">'rb'</span><span class="p">)</span> <span class="k" style="color: rgb(0, 112, 32); font-weight: bold;">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># The protocol version used is detected automatically, so we do not</span>
    <span class="c1" style="color: rgb(64, 128, 144); font-style: italic;"># have to specify it.</span>
    <span class="n">data</span> <span class="o" style="color: rgb(102, 102, 102);">=</span> <span class="n">pickle</span><span class="o" style="color: rgb(102, 102, 102);">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></pre></div></div><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><div><br></div>
</article>
{% endblock point1 %}
